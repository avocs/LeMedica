/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/ocr-menus/route";
exports.ids = ["app/api/ocr-menus/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/pdf-parse/lib/pdf.js sync recursive ^\\.\\/.*\\/build\\/pdf\\.js$":
/*!**************************************************************************!*\
  !*** ./node_modules/pdf-parse/lib/pdf.js/ sync ^\.\/.*\/build\/pdf\.js$ ***!
  \**************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var map = {
	"./v1.10.100/build/pdf.js": "(rsc)/./node_modules/pdf-parse/lib/pdf.js/v1.10.100/build/pdf.js",
	"./v1.10.88/build/pdf.js": "(rsc)/./node_modules/pdf-parse/lib/pdf.js/v1.10.88/build/pdf.js",
	"./v1.9.426/build/pdf.js": "(rsc)/./node_modules/pdf-parse/lib/pdf.js/v1.9.426/build/pdf.js",
	"./v2.0.550/build/pdf.js": "(rsc)/./node_modules/pdf-parse/lib/pdf.js/v2.0.550/build/pdf.js"
};


function webpackContext(req) {
	var id = webpackContextResolve(req);
	return __webpack_require__(id);
}
function webpackContextResolve(req) {
	if(!__webpack_require__.o(map, req)) {
		var e = new Error("Cannot find module '" + req + "'");
		e.code = 'MODULE_NOT_FOUND';
		throw e;
	}
	return map[req];
}
webpackContext.keys = function webpackContextKeys() {
	return Object.keys(map);
};
webpackContext.resolve = webpackContextResolve;
module.exports = webpackContext;
webpackContext.id = "(rsc)/./node_modules/pdf-parse/lib/pdf.js sync recursive ^\\.\\/.*\\/build\\/pdf\\.js$";

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "tesseract.js":
/*!*******************************!*\
  !*** external "tesseract.js" ***!
  \*******************************/
/***/ ((module) => {

"use strict";
module.exports = require("tesseract.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "http2":
/*!************************!*\
  !*** external "http2" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("http2");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "node:async_hooks":
/*!***********************************!*\
  !*** external "node:async_hooks" ***!
  \***********************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:async_hooks");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:fs");

/***/ }),

/***/ "node:fs/promises":
/*!***********************************!*\
  !*** external "node:fs/promises" ***!
  \***********************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:fs/promises");

/***/ }),

/***/ "node:os":
/*!**************************!*\
  !*** external "node:os" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:os");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:path");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "process":
/*!**************************!*\
  !*** external "process" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("process");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Focr-menus%2Froute&page=%2Fapi%2Focr-menus%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Focr-menus%2Froute.ts&appDir=C%3A%5CUsers%5CUser%5CDocuments%5Cside_quest%5CLeMedica%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CUser%5CDocuments%5Cside_quest%5CLeMedica&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Focr-menus%2Froute&page=%2Fapi%2Focr-menus%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Focr-menus%2Froute.ts&appDir=C%3A%5CUsers%5CUser%5CDocuments%5Cside_quest%5CLeMedica%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CUser%5CDocuments%5Cside_quest%5CLeMedica&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_User_Documents_side_quest_LeMedica_src_app_api_ocr_menus_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/ocr-menus/route.ts */ \"(rsc)/./src/app/api/ocr-menus/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/ocr-menus/route\",\n        pathname: \"/api/ocr-menus\",\n        filename: \"route\",\n        bundlePath: \"app/api/ocr-menus/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\User\\\\Documents\\\\side_quest\\\\LeMedica\\\\src\\\\app\\\\api\\\\ocr-menus\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_User_Documents_side_quest_LeMedica_src_app_api_ocr_menus_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/ocr-menus/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZvY3ItbWVudXMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRm9jci1tZW51cyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRm9jci1tZW51cyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNVc2VyJTVDRG9jdW1lbnRzJTVDc2lkZV9xdWVzdCU1Q0xlTWVkaWNhJTVDc3JjJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNVc2VyJTVDRG9jdW1lbnRzJTVDc2lkZV9xdWVzdCU1Q0xlTWVkaWNhJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNvQztBQUNqSDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2xlbWVkaWNhLWNsaW5pYy1vY3IvP2U2OTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcVXNlclxcXFxEb2N1bWVudHNcXFxcc2lkZV9xdWVzdFxcXFxMZU1lZGljYVxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxvY3ItbWVudXNcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL29jci1tZW51cy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL29jci1tZW51c1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvb2NyLW1lbnVzL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcVXNlcnNcXFxcVXNlclxcXFxEb2N1bWVudHNcXFxcc2lkZV9xdWVzdFxcXFxMZU1lZGljYVxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxvY3ItbWVudXNcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL29jci1tZW51cy9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Focr-menus%2Froute&page=%2Fapi%2Focr-menus%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Focr-menus%2Froute.ts&appDir=C%3A%5CUsers%5CUser%5CDocuments%5Cside_quest%5CLeMedica%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CUser%5CDocuments%5Cside_quest%5CLeMedica&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./bedrock-config.ts/bedrock-config.ts":
/*!*********************************************!*\
  !*** ./bedrock-config.ts/bedrock-config.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CLAUDE_OPUS_MODEL_ID: () => (/* binding */ CLAUDE_OPUS_MODEL_ID),\n/* harmony export */   CLAUDE_OPUS_PROFILE_ARN: () => (/* binding */ CLAUDE_OPUS_PROFILE_ARN),\n/* harmony export */   CLAUDE_SONNET_MODEL_ID: () => (/* binding */ CLAUDE_SONNET_MODEL_ID),\n/* harmony export */   CLAUDE_SONNET_PROFILE_ARN: () => (/* binding */ CLAUDE_SONNET_PROFILE_ARN),\n/* harmony export */   bedrockClient: () => (/* binding */ bedrockClient),\n/* harmony export */   createMedicalProcessingPrompt: () => (/* binding */ createMedicalProcessingPrompt),\n/* harmony export */   deidentifyMedicalRecord: () => (/* binding */ deidentifyMedicalRecord),\n/* harmony export */   processMedicalRecordWithClaude: () => (/* binding */ processMedicalRecordWithClaude)\n/* harmony export */ });\n/* harmony import */ var _aws_sdk_client_bedrock_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @aws-sdk/client-bedrock-runtime */ \"(rsc)/./node_modules/@aws-sdk/client-bedrock-runtime/dist-es/BedrockRuntimeClient.js\");\n/* harmony import */ var _aws_sdk_client_bedrock_runtime__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @aws-sdk/client-bedrock-runtime */ \"(rsc)/./node_modules/@aws-sdk/client-bedrock-runtime/dist-es/commands/InvokeModelCommand.js\");\n// ============================================================================\n// bedrock-config.ts\n// HIPAA-Compliant Claude 3 Medical Processing (AWS Bedrock Runtime)\n// ============================================================================\n\n// ---------------------------------------------------------------------------\n// AWS Bedrock Client\n// ---------------------------------------------------------------------------\nconst bedrockClient = new _aws_sdk_client_bedrock_runtime__WEBPACK_IMPORTED_MODULE_0__.BedrockRuntimeClient({\n    region: process.env.AWS_REGION || process.env.AWS_BEDROCK_REGION || \"us-east-1\",\n    credentials: {\n        accessKeyId: process.env.AWS_BEDROCK_ACCESS_KEY_ID || process.env.AWS_ACCESS_KEY_ID || \"\",\n        secretAccessKey: process.env.AWS_BEDROCK_SECRET_ACCESS_KEY || process.env.AWS_SECRET_ACCESS_KEY || \"\"\n    }\n});\n// ---------------------------------------------------------------------------\n// Model IDs\n// ---------------------------------------------------------------------------\nconst CLAUDE_SONNET_PROFILE_ARN = process.env.BEDROCK_PROFILE_ARN || \"\";\nconst CLAUDE_OPUS_PROFILE_ARN = process.env.BEDROCK_OPUS_PROFILE_ARN || \"\";\nconst CLAUDE_SONNET_MODEL_ID = \"anthropic.claude-sonnet-4-5-20250929-v1:0\";\nconst CLAUDE_OPUS_MODEL_ID = \"anthropic.claude-opus-4-20250514-v1:0\";\n// ---------------------------------------------------------------------------\n// ðŸ”’ De-identification function (HIPAA compliant)\n// ---------------------------------------------------------------------------\nfunction deidentifyMedicalRecord(record) {\n    let deidentified = record;\n    const phiPatterns = [\n        /\\b[A-Z][a-z]+ [A-Z][a-z]+\\b/g,\n        /\\b\\d{3}-\\d{2}-\\d{4}\\b/g,\n        /\\b\\d{3}-\\d{3}-\\d{4}\\b/g,\n        /\\b\\(\\d{3}\\)\\s*\\d{3}-\\d{4}\\b/g,\n        /\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}\\b/g,\n        /\\b\\d+\\s+[A-Za-z\\s]+(?:Street|St|Avenue|Ave|Road|Rd|Drive|Dr|Lane|Ln|Boulevard|Blvd)\\b/g,\n        /\\bMRN\\s*:?\\s*\\d+/gi,\n        /\\bPatient\\s*ID\\s*:?\\s*\\d+/gi,\n        /\\b(?:DOB|Date of Birth|Birth Date|Patient.*Birth)\\s*:?\\s*\\d{1,2}\\/\\d{1,2}\\/\\d{4}\\b/gi // DOB\n    ];\n    phiPatterns.forEach((pattern)=>{\n        deidentified = deidentified.replace(pattern, \"[REDACTED]\");\n    });\n    return deidentified;\n}\n// ---------------------------------------------------------------------------\n// PROMPT BUILDER (Lab reports only)\n// ---------------------------------------------------------------------------\nfunction createMedicalProcessingPrompt(record) {\n    // Lab report: strict JSON with reportDate + categories\n    return `You are a medical lab data processor. Extract lab test results from the medical report and return a clean JSON object with categorized tests.\n\nIMPORTANT GUIDELINES:\n1. Maintain HIPAA compliance - do not extract or infer any personally identifiable information\n2. Focus on medical data, test results, and clinical information\n3. Be precise with numerical values and units\n4. Flag any abnormal or critical values clearly\n5. Provide confidence scores for your extractions\n6. If information is not available, use null or empty arrays/objects\n7. Ensure all extracted data is medically accurate and clinically relevant\n\nCRITICAL: Return ONLY the JSON object. No markdown, no backticks, no explanations. Start with { and end with }.\n\nREQUIRED JSON STRUCTURE:\n{\n  \"reportDate\": \"YYYY-MM-DD format if found, otherwise null\",\n  \"confidence\": 0.95,\n  \"categories\": [\n    {\n      \"categoryName\": \"Complete Blood Count\",\n      \"confidence\": 0.9,\n      \"tests\": [\n        {\n          \"testName\": \"White Blood Cells\",\n          \"value\": \"7.2\",\n          \"unit\": \"K/uL\",\n          \"referenceLow\": \"4.5\",\n          \"referenceHigh\": \"11.0\",\n          \"status\": \"normal\",\n          \"confidence\": 0.9\n        }\n      ]\n    }\n  ]\n}\nRULES:\nDATE EXTRACTION RULES:\n- Look for lab report date, test date, collection date, reported date, specimen date, received date\n- Common date formats: MM/DD/YYYY, DD/MM/YYYY, YYYY-MM-DD, Month DD, YYYY, DD-MMM-YYYY, YYYY/MM/DD\n- If multiple dates found, use the most recent test/collection/specimen date\n- Return null if no date found\n- Format as YYYY-MM-DD (e.g., \"2024-01-15\")\n\nCATEGORY RULES:\n- Create categories dynamically as needed (CBC, Lipid Panel, Liver Function, Kidney Function, Blood Sugar, Thyroid Function, Electrolytes, Vitamins & Minerals, Hormones, CRP/ESR, Autoimmune markers, Urinalysis, Infection panels, Tumor markers, Cardiac markers, Coagulation studies, Toxicology, Genetic tests, others)\n- Do not place unrelated tests together\n- Always categorize every test\n\nSTATUS RULES:\n- Status must be one of: normal, high, low, critical\n- If above referenceHigh â†’ \"high\"\n- If below referenceLow â†’ \"low\"\n- If extremely abnormal â†’ \"critical\"\n- Otherwise â†’ \"normal\"\n\nVALUE RULES:\n- Use exact numeric values from the report\n- Use standardized units (K/uL instead of X10^9/L, mg/dL instead of complex notation)\n- Common unit conversions:\n  * White Blood Cells: \"K/uL\"\n  * Red Blood Cells: \"M/uL\"\n  * Hemoglobin: \"g/dL\"\n  * Platelets: \"K/uL\"\n  * Cholesterol: mg/dL or mmol/L\n  * Glucose: mg/dL or mmol/L\n  * Liver enzymes: U/L\n  * Creatinine: mg/dL or Î¼mol/L\n- Use \"N/A\" for missing values\n- Round numeric values to 1 decimal place\n\nSTATUS RULES:\n- Status MUST be: normal, high, low, critical\n- If above referenceHigh â†’ \"high\"\n- If below referenceLow â†’ \"low\"\n- If extremely abnormal â†’ \"critical\"\n- Otherwise â†’ \"normal\"\n\nLab Report Text:\n${record}\n\nCRITICAL: Return ONLY the JSON object. No markdown, no backticks, no explanations. Start with { and end with }.`;\n}\n// ---------------------------------------------------------------------------\n// CLAUDE INVOCATION\n// ---------------------------------------------------------------------------\n// Main processing function using Claude Sonnet 4.5 (with Opus 4 fallback for complex cases)\nasync function processMedicalRecordWithClaude(request) {\n    try {\n        // ðŸ”’ ALWAYS de-identify if requested\n        const safeRecord = request.deidentifiedData ? deidentifyMedicalRecord(request.medicalRecord) : request.medicalRecord;\n        // ðŸ” Complexity detection MUST use the deidentified version\n        const recordForDetection = safeRecord.toLowerCase();\n        // Create the prompt\n        const prompt = createMedicalProcessingPrompt(safeRecord);\n        // Decide model\n        let modelId = request.modelId || CLAUDE_SONNET_MODEL_ID;\n        let maxTokens = 4000;\n        let temperature = 0.1;\n        // Detect complex mode based on SAFE text (HIPAA-safe)\n        const isComplexCase = !request.modelId && (safeRecord.length > 10000 || recordForDetection.includes(\"complex\") || recordForDetection.includes(\"multiple\") || recordForDetection.includes(\"abnormal\"));\n        if (isComplexCase) {\n            modelId = CLAUDE_OPUS_MODEL_ID;\n            maxTokens = 8000;\n            temperature = 0.05;\n            console.log(\"\\uD83C\\uDFE5 Using Claude Opus 4 for complex medical case\");\n        } else {\n            console.log(\"\\uD83C\\uDFE5 Using model for medical processing:\", modelId);\n        }\n        // Resolve inference profile ARN\n        const resolvedModelId = modelId === CLAUDE_SONNET_MODEL_ID && CLAUDE_SONNET_PROFILE_ARN ? CLAUDE_SONNET_PROFILE_ARN : modelId === CLAUDE_OPUS_MODEL_ID && CLAUDE_OPUS_PROFILE_ARN ? CLAUDE_OPUS_PROFILE_ARN : modelId;\n        const input = {\n            modelId: resolvedModelId,\n            contentType: \"application/json\",\n            accept: \"application/json\",\n            body: JSON.stringify({\n                anthropic_version: \"bedrock-2023-05-31\",\n                max_tokens: maxTokens,\n                temperature: temperature,\n                messages: [\n                    {\n                        role: \"user\",\n                        content: prompt\n                    }\n                ]\n            })\n        };\n        // Invoke model\n        const command = new _aws_sdk_client_bedrock_runtime__WEBPACK_IMPORTED_MODULE_1__.InvokeModelCommand(input);\n        const response = await bedrockClient.send(command);\n        // Convert raw response into text\n        const rawText = await (async ()=>{\n            const body = response.body;\n            if (typeof body?.transformToByteArray === \"function\") {\n                return new TextDecoder().decode(await body.transformToByteArray());\n            }\n            if (body instanceof Uint8Array) {\n                return new TextDecoder().decode(body);\n            }\n            return String(body ?? \"\");\n        })();\n        const responseBody = JSON.parse(rawText || \"{}\");\n        const claudeResponse = responseBody?.content?.[0]?.text || \"\";\n        // Strip markdown\n        let cleaned = claudeResponse.trim().replace(/^```json\\s*/i, \"\").replace(/^```\\s*/i, \"\").replace(/```$/i, \"\").trim();\n        // Parse JSON (lab_report must provide categories JSON)\n        let parsed;\n        try {\n            parsed = JSON.parse(cleaned);\n        } catch (err) {\n            console.error(\"Failed JSON:\", cleaned.substring(0, 500));\n            throw new Error(\"Invalid JSON response from Claude\");\n        }\n        // Lab report required structure\n        if (!parsed.categories || !Array.isArray(parsed.categories)) {\n            throw new Error(\"Invalid lab report JSON: missing categories\");\n        }\n        return {\n            reportDate: parsed.reportDate ?? null,\n            confidence: parsed.confidence ?? 0.95,\n            categories: parsed.categories\n        };\n    } catch (error) {\n        console.error(\"Error processing medical record with Claude:\", error);\n        const msg = error instanceof Error ? error.message : \"Unknown error\";\n        if (msg.includes(\"UnrecognizedClientException\") || msg.includes(\"InvalidSignatureException\")) {\n            throw new Error(\"AWS Bedrock authentication failed.\");\n        }\n        if (msg.includes(\"ValidationException\")) {\n            throw new Error(\"AWS Bedrock validation error: \" + msg);\n        }\n        if (msg.includes(\"ModelNotReadyException\") || msg.includes(\"ThrottlingException\")) {\n            throw new Error(\"AWS Bedrock temporarily unavailable.\");\n        }\n        if (msg.includes(\"AccessDeniedException\")) {\n            throw new Error(\"Permission denied for AWS Bedrock.\");\n        }\n        throw new Error(\"Medical record processing failed: \" + msg);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9iZWRyb2NrLWNvbmZpZy50cy9iZWRyb2NrLWNvbmZpZy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEsK0VBQStFO0FBQy9FLG9CQUFvQjtBQUNwQixvRUFBb0U7QUFDcEUsK0VBQStFO0FBRVk7QUFFM0YsOEVBQThFO0FBQzlFLHFCQUFxQjtBQUNyQiw4RUFBOEU7QUFDdkUsTUFBTUUsZ0JBQWdCLElBQUlGLGlGQUFvQkEsQ0FBQztJQUNwREcsUUFBUUMsUUFBUUMsR0FBRyxDQUFDQyxVQUFVLElBQUlGLFFBQVFDLEdBQUcsQ0FBQ0Usa0JBQWtCLElBQUk7SUFDcEVDLGFBQWE7UUFDWEMsYUFBYUwsUUFBUUMsR0FBRyxDQUFDSyx5QkFBeUIsSUFBSU4sUUFBUUMsR0FBRyxDQUFDTSxpQkFBaUIsSUFBSTtRQUN2RkMsaUJBQWlCUixRQUFRQyxHQUFHLENBQUNRLDZCQUE2QixJQUFJVCxRQUFRQyxHQUFHLENBQUNTLHFCQUFxQixJQUFJO0lBQ3JHO0FBQ0YsR0FBRztBQUVILDhFQUE4RTtBQUM5RSxZQUFZO0FBQ1osOEVBQThFO0FBQ3ZFLE1BQU1DLDRCQUE0QlgsUUFBUUMsR0FBRyxDQUFDVyxtQkFBbUIsSUFBSSxHQUFHO0FBQ3hFLE1BQU1DLDBCQUEwQmIsUUFBUUMsR0FBRyxDQUFDYSx3QkFBd0IsSUFBSSxHQUFHO0FBQzNFLE1BQU1DLHlCQUF5Qiw0Q0FBNEM7QUFDM0UsTUFBTUMsdUJBQXVCLHdDQUF3QztBQWtENUUsOEVBQThFO0FBQzlFLGtEQUFrRDtBQUNsRCw4RUFBOEU7QUFDdkUsU0FBU0Msd0JBQXdCQyxNQUFjO0lBQ3BELElBQUlDLGVBQWVEO0lBRW5CLE1BQU1FLGNBQWM7UUFDbEI7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBLHVGQUF1RixNQUFNO0tBQzlGO0lBRURBLFlBQVlDLE9BQU8sQ0FBQ0MsQ0FBQUE7UUFDbEJILGVBQWVBLGFBQWFJLE9BQU8sQ0FBQ0QsU0FBUztJQUMvQztJQUVB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UUFBUUssU0FBUyxDQUFDLEdBQUc7WUFDbkQsTUFBTSxJQUFJQyxNQUFNO1FBQ2xCO1FBRUEsZ0NBQWdDO1FBQ2hDLElBQUksQ0FBQ0osT0FBT0ssVUFBVSxJQUFJLENBQUNDLE1BQU1DLE9BQU8sQ0FBQ1AsT0FBT0ssVUFBVSxHQUFHO1lBQzNELE1BQU0sSUFBSUQsTUFBTTtRQUNsQjtRQUNBLE9BQU87WUFDTEksWUFBWVIsT0FBT1EsVUFBVSxJQUFJO1lBQ2pDQyxZQUFZVCxPQUFPUyxVQUFVLElBQUk7WUFDakNKLFlBQVlMLE9BQU9LLFVBQVU7UUFDL0I7SUFDRixFQUFFLE9BQU9ILE9BQU87UUFDZC9CLFFBQVErQixLQUFLLENBQUMsZ0RBQWdEQTtRQUM5RCxNQUFNUSxNQUFNUixpQkFBaUJFLFFBQVFGLE1BQU1TLE9BQU8sR0FBRztRQUVyRCxJQUFJRCxJQUFJeEMsUUFBUSxDQUFDLGtDQUFrQ3dDLElBQUl4QyxRQUFRLENBQUMsOEJBQThCO1lBQzVGLE1BQU0sSUFBSWtDLE1BQU07UUFDbEI7UUFDQSxJQUFJTSxJQUFJeEMsUUFBUSxDQUFDLHdCQUF3QjtZQUN2QyxNQUFNLElBQUlrQyxNQUFNLG1DQUFtQ007UUFDckQ7UUFDQSxJQUFJQSxJQUFJeEMsUUFBUSxDQUFDLDZCQUE2QndDLElBQUl4QyxRQUFRLENBQUMsd0JBQXdCO1lBQ2pGLE1BQU0sSUFBSWtDLE1BQU07UUFDbEI7UUFDQSxJQUFJTSxJQUFJeEMsUUFBUSxDQUFDLDBCQUEwQjtZQUN6QyxNQUFNLElBQUlrQyxNQUFNO1FBQ2xCO1FBRUEsTUFBTSxJQUFJQSxNQUFNLHVDQUF1Q007SUFDekQ7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2xlbWVkaWNhLWNsaW5pYy1vY3IvLi9iZWRyb2NrLWNvbmZpZy50cy9iZWRyb2NrLWNvbmZpZy50cz9lYmE3Il0sInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIGJlZHJvY2stY29uZmlnLnRzXG4vLyBISVBBQS1Db21wbGlhbnQgQ2xhdWRlIDMgTWVkaWNhbCBQcm9jZXNzaW5nIChBV1MgQmVkcm9jayBSdW50aW1lKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgeyBCZWRyb2NrUnVudGltZUNsaWVudCwgSW52b2tlTW9kZWxDb21tYW5kIH0gZnJvbSBcIkBhd3Mtc2RrL2NsaWVudC1iZWRyb2NrLXJ1bnRpbWVcIjtcblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBBV1MgQmVkcm9jayBDbGllbnRcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZXhwb3J0IGNvbnN0IGJlZHJvY2tDbGllbnQgPSBuZXcgQmVkcm9ja1J1bnRpbWVDbGllbnQoe1xuICByZWdpb246IHByb2Nlc3MuZW52LkFXU19SRUdJT04gfHwgcHJvY2Vzcy5lbnYuQVdTX0JFRFJPQ0tfUkVHSU9OIHx8IFwidXMtZWFzdC0xXCIsXG4gIGNyZWRlbnRpYWxzOiB7XG4gICAgYWNjZXNzS2V5SWQ6IHByb2Nlc3MuZW52LkFXU19CRURST0NLX0FDQ0VTU19LRVlfSUQgfHwgcHJvY2Vzcy5lbnYuQVdTX0FDQ0VTU19LRVlfSUQgfHwgXCJcIixcbiAgICBzZWNyZXRBY2Nlc3NLZXk6IHByb2Nlc3MuZW52LkFXU19CRURST0NLX1NFQ1JFVF9BQ0NFU1NfS0VZIHx8IHByb2Nlc3MuZW52LkFXU19TRUNSRVRfQUNDRVNTX0tFWSB8fCBcIlwiLFxuICB9XG59KTtcblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBNb2RlbCBJRHNcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZXhwb3J0IGNvbnN0IENMQVVERV9TT05ORVRfUFJPRklMRV9BUk4gPSBwcm9jZXNzLmVudi5CRURST0NLX1BST0ZJTEVfQVJOIHx8IFwiXCI7XG5leHBvcnQgY29uc3QgQ0xBVURFX09QVVNfUFJPRklMRV9BUk4gPSBwcm9jZXNzLmVudi5CRURST0NLX09QVVNfUFJPRklMRV9BUk4gfHwgXCJcIjtcbmV4cG9ydCBjb25zdCBDTEFVREVfU09OTkVUX01PREVMX0lEID0gXCJhbnRocm9waWMuY2xhdWRlLXNvbm5ldC00LTUtMjAyNTA5MjktdjE6MFwiO1xuZXhwb3J0IGNvbnN0IENMQVVERV9PUFVTX01PREVMX0lEID0gXCJhbnRocm9waWMuY2xhdWRlLW9wdXMtNC0yMDI1MDUxNC12MTowXCI7XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gUmVxdWVzdCArIFJlc3BvbnNlIEludGVyZmFjZXMgKENsYXVkZS1sZXZlbClcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZXhwb3J0IGludGVyZmFjZSBNZWRpY2FsUmVjb3JkUHJvY2Vzc2luZ1JlcXVlc3Qge1xuICBtZWRpY2FsUmVjb3JkOiBzdHJpbmc7XG4gIHJlY29yZFR5cGU6IFwibGFiX3JlcG9ydFwiO1xuICBkZWlkZW50aWZpZWREYXRhPzogYm9vbGVhbjtcbiAgbW9kZWxJZD86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNZWRpY2FsUmVjb3JkUHJvY2Vzc2luZ1Jlc3BvbnNlIHtcbiAgcmVwb3J0RGF0ZTogc3RyaW5nIHwgbnVsbDtcbiAgY29uZmlkZW5jZTogbnVtYmVyO1xuICBjYXRlZ29yaWVzOiBBcnJheTx7XG4gICAgY2F0ZWdvcnlOYW1lOiBzdHJpbmc7XG4gICAgY29uZmlkZW5jZTogbnVtYmVyO1xuICAgIHRlc3RzOiBBcnJheTx7XG4gICAgICB0ZXN0TmFtZTogc3RyaW5nO1xuICAgICAgdmFsdWU6IHN0cmluZztcbiAgICAgIHVuaXQ6IHN0cmluZztcbiAgICAgIHJlZmVyZW5jZUxvdzogc3RyaW5nO1xuICAgICAgcmVmZXJlbmNlSGlnaDogc3RyaW5nO1xuICAgICAgc3RhdHVzOiBzdHJpbmc7XG4gICAgICBjb25maWRlbmNlOiBudW1iZXI7XG4gICAgfT47XG4gIH0+O1xufVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIEZpbmFsIFVuaWZpZWQgRm9ybWF0IGZvciBVSSAocG9zdC1wcm9jZXNzaW5nKVxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5leHBvcnQgaW50ZXJmYWNlIExhYlJlcG9ydERhdGEge1xuICByZXBvcnREYXRlOiBzdHJpbmcgfCBudWxsO1xuICBjb25maWRlbmNlOiBudW1iZXI7XG4gIGNhdGVnb3JpZXM6IEFycmF5PHtcbiAgICBjYXRlZ29yeU5hbWU6IHN0cmluZztcbiAgICBjb25maWRlbmNlOiBudW1iZXI7XG4gICAgdGVzdHM6IEFycmF5PHtcbiAgICAgIHRlc3ROYW1lOiBzdHJpbmc7XG4gICAgICB2YWx1ZTogc3RyaW5nO1xuICAgICAgdW5pdDogc3RyaW5nO1xuICAgICAgcmVmZXJlbmNlTG93OiBzdHJpbmc7XG4gICAgICByZWZlcmVuY2VIaWdoOiBzdHJpbmc7XG4gICAgICBzdGF0dXM6IFwibm9ybWFsXCIgfCBcImhpZ2hcIiB8IFwibG93XCIgfCBcImNyaXRpY2FsXCI7XG4gICAgICBjb25maWRlbmNlOiBudW1iZXI7XG4gICAgfT47XG4gIH0+O1xufVxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyDwn5SSIERlLWlkZW50aWZpY2F0aW9uIGZ1bmN0aW9uIChISVBBQSBjb21wbGlhbnQpXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmV4cG9ydCBmdW5jdGlvbiBkZWlkZW50aWZ5TWVkaWNhbFJlY29yZChyZWNvcmQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIGxldCBkZWlkZW50aWZpZWQgPSByZWNvcmQ7XG5cbiAgY29uc3QgcGhpUGF0dGVybnMgPSBbXG4gICAgL1xcYltBLVpdW2Etel0rIFtBLVpdW2Etel0rXFxiL2csICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5hbWVzXG4gICAgL1xcYlxcZHszfS1cXGR7Mn0tXFxkezR9XFxiL2csICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNTTlxuICAgIC9cXGJcXGR7M30tXFxkezN9LVxcZHs0fVxcYi9nLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwaG9uZVxuICAgIC9cXGJcXChcXGR7M31cXClcXHMqXFxkezN9LVxcZHs0fVxcYi9nLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwaG9uZSBhbHRcbiAgICAvXFxiW0EtWmEtejAtOS5fJSstXStAW0EtWmEtejAtOS4tXStcXC5bQS1afGEtel17Mix9XFxiL2csICAgICAgICAgIC8vIGVtYWlsXG4gICAgL1xcYlxcZCtcXHMrW0EtWmEtelxcc10rKD86U3RyZWV0fFN0fEF2ZW51ZXxBdmV8Um9hZHxSZHxEcml2ZXxEcnxMYW5lfExufEJvdWxldmFyZHxCbHZkKVxcYi9nLFxuICAgIC9cXGJNUk5cXHMqOj9cXHMqXFxkKy9naSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1STlxuICAgIC9cXGJQYXRpZW50XFxzKklEXFxzKjo/XFxzKlxcZCsvZ2ksICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJRFxuICAgIC9cXGIoPzpET0J8RGF0ZSBvZiBCaXJ0aHxCaXJ0aCBEYXRlfFBhdGllbnQuKkJpcnRoKVxccyo6P1xccypcXGR7MSwyfVxcL1xcZHsxLDJ9XFwvXFxkezR9XFxiL2dpIC8vIERPQlxuICBdO1xuXG4gIHBoaVBhdHRlcm5zLmZvckVhY2gocGF0dGVybiA9PiB7XG4gICAgZGVpZGVudGlmaWVkID0gZGVpZGVudGlmaWVkLnJlcGxhY2UocGF0dGVybiwgXCJbUkVEQUNURURdXCIpO1xuICB9KTtcblxuICByZXR1cm4gZGVpZGVudGlmaWVkO1xufVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFBST01QVCBCVUlMREVSIChMYWIgcmVwb3J0cyBvbmx5KVxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTWVkaWNhbFByb2Nlc3NpbmdQcm9tcHQocmVjb3JkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAvLyBMYWIgcmVwb3J0OiBzdHJpY3QgSlNPTiB3aXRoIHJlcG9ydERhdGUgKyBjYXRlZ29yaWVzXG4gIHJldHVybiBgWW91IGFyZSBhIG1lZGljYWwgbGFiIGRhdGEgcHJvY2Vzc29yLiBFeHRyYWN0IGxhYiB0ZXN0IHJlc3VsdHMgZnJvbSB0aGUgbWVkaWNhbCByZXBvcnQgYW5kIHJldHVybiBhIGNsZWFuIEpTT04gb2JqZWN0IHdpdGggY2F0ZWdvcml6ZWQgdGVzdHMuXG5cbklNUE9SVEFOVCBHVUlERUxJTkVTOlxuMS4gTWFpbnRhaW4gSElQQUEgY29tcGxpYW5jZSAtIGRvIG5vdCBleHRyYWN0IG9yIGluZmVyIGFueSBwZXJzb25hbGx5IGlkZW50aWZpYWJsZSBpbmZvcm1hdGlvblxuMi4gRm9jdXMgb24gbWVkaWNhbCBkYXRhLCB0ZXN0IHJlc3VsdHMsIGFuZCBjbGluaWNhbCBpbmZvcm1hdGlvblxuMy4gQmUgcHJlY2lzZSB3aXRoIG51bWVyaWNhbCB2YWx1ZXMgYW5kIHVuaXRzXG40LiBGbGFnIGFueSBhYm5vcm1hbCBvciBjcml0aWNhbCB2YWx1ZXMgY2xlYXJseVxuNS4gUHJvdmlkZSBjb25maWRlbmNlIHNjb3JlcyBmb3IgeW91ciBleHRyYWN0aW9uc1xuNi4gSWYgaW5mb3JtYXRpb24gaXMgbm90IGF2YWlsYWJsZSwgdXNlIG51bGwgb3IgZW1wdHkgYXJyYXlzL29iamVjdHNcbjcuIEVuc3VyZSBhbGwgZXh0cmFjdGVkIGRhdGEgaXMgbWVkaWNhbGx5IGFjY3VyYXRlIGFuZCBjbGluaWNhbGx5IHJlbGV2YW50XG5cbkNSSVRJQ0FMOiBSZXR1cm4gT05MWSB0aGUgSlNPTiBvYmplY3QuIE5vIG1hcmtkb3duLCBubyBiYWNrdGlja3MsIG5vIGV4cGxhbmF0aW9ucy4gU3RhcnQgd2l0aCB7IGFuZCBlbmQgd2l0aCB9LlxuXG5SRVFVSVJFRCBKU09OIFNUUlVDVFVSRTpcbntcbiAgXCJyZXBvcnREYXRlXCI6IFwiWVlZWS1NTS1ERCBmb3JtYXQgaWYgZm91bmQsIG90aGVyd2lzZSBudWxsXCIsXG4gIFwiY29uZmlkZW5jZVwiOiAwLjk1LFxuICBcImNhdGVnb3JpZXNcIjogW1xuICAgIHtcbiAgICAgIFwiY2F0ZWdvcnlOYW1lXCI6IFwiQ29tcGxldGUgQmxvb2QgQ291bnRcIixcbiAgICAgIFwiY29uZmlkZW5jZVwiOiAwLjksXG4gICAgICBcInRlc3RzXCI6IFtcbiAgICAgICAge1xuICAgICAgICAgIFwidGVzdE5hbWVcIjogXCJXaGl0ZSBCbG9vZCBDZWxsc1wiLFxuICAgICAgICAgIFwidmFsdWVcIjogXCI3LjJcIixcbiAgICAgICAgICBcInVuaXRcIjogXCJLL3VMXCIsXG4gICAgICAgICAgXCJyZWZlcmVuY2VMb3dcIjogXCI0LjVcIixcbiAgICAgICAgICBcInJlZmVyZW5jZUhpZ2hcIjogXCIxMS4wXCIsXG4gICAgICAgICAgXCJzdGF0dXNcIjogXCJub3JtYWxcIixcbiAgICAgICAgICBcImNvbmZpZGVuY2VcIjogMC45XG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9XG4gIF1cbn1cblJVTEVTOlxuREFURSBFWFRSQUNUSU9OIFJVTEVTOlxuLSBMb29rIGZvciBsYWIgcmVwb3J0IGRhdGUsIHRlc3QgZGF0ZSwgY29sbGVjdGlvbiBkYXRlLCByZXBvcnRlZCBkYXRlLCBzcGVjaW1lbiBkYXRlLCByZWNlaXZlZCBkYXRlXG4tIENvbW1vbiBkYXRlIGZvcm1hdHM6IE1NL0REL1lZWVksIEREL01NL1lZWVksIFlZWVktTU0tREQsIE1vbnRoIERELCBZWVlZLCBERC1NTU0tWVlZWSwgWVlZWS9NTS9ERFxuLSBJZiBtdWx0aXBsZSBkYXRlcyBmb3VuZCwgdXNlIHRoZSBtb3N0IHJlY2VudCB0ZXN0L2NvbGxlY3Rpb24vc3BlY2ltZW4gZGF0ZVxuLSBSZXR1cm4gbnVsbCBpZiBubyBkYXRlIGZvdW5kXG4tIEZvcm1hdCBhcyBZWVlZLU1NLUREIChlLmcuLCBcIjIwMjQtMDEtMTVcIilcblxuQ0FURUdPUlkgUlVMRVM6XG4tIENyZWF0ZSBjYXRlZ29yaWVzIGR5bmFtaWNhbGx5IGFzIG5lZWRlZCAoQ0JDLCBMaXBpZCBQYW5lbCwgTGl2ZXIgRnVuY3Rpb24sIEtpZG5leSBGdW5jdGlvbiwgQmxvb2QgU3VnYXIsIFRoeXJvaWQgRnVuY3Rpb24sIEVsZWN0cm9seXRlcywgVml0YW1pbnMgJiBNaW5lcmFscywgSG9ybW9uZXMsIENSUC9FU1IsIEF1dG9pbW11bmUgbWFya2VycywgVXJpbmFseXNpcywgSW5mZWN0aW9uIHBhbmVscywgVHVtb3IgbWFya2VycywgQ2FyZGlhYyBtYXJrZXJzLCBDb2FndWxhdGlvbiBzdHVkaWVzLCBUb3hpY29sb2d5LCBHZW5ldGljIHRlc3RzLCBvdGhlcnMpXG4tIERvIG5vdCBwbGFjZSB1bnJlbGF0ZWQgdGVzdHMgdG9nZXRoZXJcbi0gQWx3YXlzIGNhdGVnb3JpemUgZXZlcnkgdGVzdFxuXG5TVEFUVVMgUlVMRVM6XG4tIFN0YXR1cyBtdXN0IGJlIG9uZSBvZjogbm9ybWFsLCBoaWdoLCBsb3csIGNyaXRpY2FsXG4tIElmIGFib3ZlIHJlZmVyZW5jZUhpZ2gg4oaSIFwiaGlnaFwiXG4tIElmIGJlbG93IHJlZmVyZW5jZUxvdyDihpIgXCJsb3dcIlxuLSBJZiBleHRyZW1lbHkgYWJub3JtYWwg4oaSIFwiY3JpdGljYWxcIlxuLSBPdGhlcndpc2Ug4oaSIFwibm9ybWFsXCJcblxuVkFMVUUgUlVMRVM6XG4tIFVzZSBleGFjdCBudW1lcmljIHZhbHVlcyBmcm9tIHRoZSByZXBvcnRcbi0gVXNlIHN0YW5kYXJkaXplZCB1bml0cyAoSy91TCBpbnN0ZWFkIG9mIFgxMF45L0wsIG1nL2RMIGluc3RlYWQgb2YgY29tcGxleCBub3RhdGlvbilcbi0gQ29tbW9uIHVuaXQgY29udmVyc2lvbnM6XG4gICogV2hpdGUgQmxvb2QgQ2VsbHM6IFwiSy91TFwiXG4gICogUmVkIEJsb29kIENlbGxzOiBcIk0vdUxcIlxuICAqIEhlbW9nbG9iaW46IFwiZy9kTFwiXG4gICogUGxhdGVsZXRzOiBcIksvdUxcIlxuICAqIENob2xlc3Rlcm9sOiBtZy9kTCBvciBtbW9sL0xcbiAgKiBHbHVjb3NlOiBtZy9kTCBvciBtbW9sL0xcbiAgKiBMaXZlciBlbnp5bWVzOiBVL0xcbiAgKiBDcmVhdGluaW5lOiBtZy9kTCBvciDOvG1vbC9MXG4tIFVzZSBcIk4vQVwiIGZvciBtaXNzaW5nIHZhbHVlc1xuLSBSb3VuZCBudW1lcmljIHZhbHVlcyB0byAxIGRlY2ltYWwgcGxhY2VcblxuU1RBVFVTIFJVTEVTOlxuLSBTdGF0dXMgTVVTVCBiZTogbm9ybWFsLCBoaWdoLCBsb3csIGNyaXRpY2FsXG4tIElmIGFib3ZlIHJlZmVyZW5jZUhpZ2gg4oaSIFwiaGlnaFwiXG4tIElmIGJlbG93IHJlZmVyZW5jZUxvdyDihpIgXCJsb3dcIlxuLSBJZiBleHRyZW1lbHkgYWJub3JtYWwg4oaSIFwiY3JpdGljYWxcIlxuLSBPdGhlcndpc2Ug4oaSIFwibm9ybWFsXCJcblxuTGFiIFJlcG9ydCBUZXh0OlxuJHtyZWNvcmR9XG5cbkNSSVRJQ0FMOiBSZXR1cm4gT05MWSB0aGUgSlNPTiBvYmplY3QuIE5vIG1hcmtkb3duLCBubyBiYWNrdGlja3MsIG5vIGV4cGxhbmF0aW9ucy4gU3RhcnQgd2l0aCB7IGFuZCBlbmQgd2l0aCB9LmA7XG59XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gQ0xBVURFIElOVk9DQVRJT05cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gTWFpbiBwcm9jZXNzaW5nIGZ1bmN0aW9uIHVzaW5nIENsYXVkZSBTb25uZXQgNC41ICh3aXRoIE9wdXMgNCBmYWxsYmFjayBmb3IgY29tcGxleCBjYXNlcylcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcm9jZXNzTWVkaWNhbFJlY29yZFdpdGhDbGF1ZGUoXG4gIHJlcXVlc3Q6IE1lZGljYWxSZWNvcmRQcm9jZXNzaW5nUmVxdWVzdFxuKTogUHJvbWlzZTxNZWRpY2FsUmVjb3JkUHJvY2Vzc2luZ1Jlc3BvbnNlPiB7XG4gIHRyeSB7XG4gICAgLy8g8J+UkiBBTFdBWVMgZGUtaWRlbnRpZnkgaWYgcmVxdWVzdGVkXG4gICAgY29uc3Qgc2FmZVJlY29yZCA9IHJlcXVlc3QuZGVpZGVudGlmaWVkRGF0YVxuICAgICAgPyBkZWlkZW50aWZ5TWVkaWNhbFJlY29yZChyZXF1ZXN0Lm1lZGljYWxSZWNvcmQpXG4gICAgICA6IHJlcXVlc3QubWVkaWNhbFJlY29yZDtcblxuICAgIC8vIPCflI0gQ29tcGxleGl0eSBkZXRlY3Rpb24gTVVTVCB1c2UgdGhlIGRlaWRlbnRpZmllZCB2ZXJzaW9uXG4gICAgY29uc3QgcmVjb3JkRm9yRGV0ZWN0aW9uID0gc2FmZVJlY29yZC50b0xvd2VyQ2FzZSgpO1xuXG4gICAgLy8gQ3JlYXRlIHRoZSBwcm9tcHRcbiAgICBjb25zdCBwcm9tcHQgPSBjcmVhdGVNZWRpY2FsUHJvY2Vzc2luZ1Byb21wdChzYWZlUmVjb3JkKTtcblxuICAgIC8vIERlY2lkZSBtb2RlbFxuICAgIGxldCBtb2RlbElkID0gcmVxdWVzdC5tb2RlbElkIHx8IENMQVVERV9TT05ORVRfTU9ERUxfSUQ7XG4gICAgbGV0IG1heFRva2VucyA9IDQwMDA7XG4gICAgbGV0IHRlbXBlcmF0dXJlID0gMC4xO1xuXG4gICAgLy8gRGV0ZWN0IGNvbXBsZXggbW9kZSBiYXNlZCBvbiBTQUZFIHRleHQgKEhJUEFBLXNhZmUpXG4gICAgY29uc3QgaXNDb21wbGV4Q2FzZSA9XG4gICAgICAhcmVxdWVzdC5tb2RlbElkICYmXG4gICAgICAoXG4gICAgICAgIHNhZmVSZWNvcmQubGVuZ3RoID4gMTAwMDAgfHxcbiAgICAgICAgcmVjb3JkRm9yRGV0ZWN0aW9uLmluY2x1ZGVzKFwiY29tcGxleFwiKSB8fFxuICAgICAgICByZWNvcmRGb3JEZXRlY3Rpb24uaW5jbHVkZXMoXCJtdWx0aXBsZVwiKSB8fFxuICAgICAgICByZWNvcmRGb3JEZXRlY3Rpb24uaW5jbHVkZXMoXCJhYm5vcm1hbFwiKVxuICAgICAgKTtcblxuICAgIGlmIChpc0NvbXBsZXhDYXNlKSB7XG4gICAgICBtb2RlbElkID0gQ0xBVURFX09QVVNfTU9ERUxfSUQ7XG4gICAgICBtYXhUb2tlbnMgPSA4MDAwO1xuICAgICAgdGVtcGVyYXR1cmUgPSAwLjA1O1xuICAgICAgY29uc29sZS5sb2coXCLwn4+lIFVzaW5nIENsYXVkZSBPcHVzIDQgZm9yIGNvbXBsZXggbWVkaWNhbCBjYXNlXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhcIvCfj6UgVXNpbmcgbW9kZWwgZm9yIG1lZGljYWwgcHJvY2Vzc2luZzpcIiwgbW9kZWxJZCk7XG4gICAgfVxuXG4gICAgLy8gUmVzb2x2ZSBpbmZlcmVuY2UgcHJvZmlsZSBBUk5cbiAgICBjb25zdCByZXNvbHZlZE1vZGVsSWQgPVxuICAgICAgbW9kZWxJZCA9PT0gQ0xBVURFX1NPTk5FVF9NT0RFTF9JRCAmJiBDTEFVREVfU09OTkVUX1BST0ZJTEVfQVJOXG4gICAgICAgID8gQ0xBVURFX1NPTk5FVF9QUk9GSUxFX0FSTlxuICAgICAgICA6IG1vZGVsSWQgPT09IENMQVVERV9PUFVTX01PREVMX0lEICYmIENMQVVERV9PUFVTX1BST0ZJTEVfQVJOXG4gICAgICAgICAgPyBDTEFVREVfT1BVU19QUk9GSUxFX0FSTlxuICAgICAgICAgIDogbW9kZWxJZDtcblxuICAgIGNvbnN0IGlucHV0ID0ge1xuICAgICAgbW9kZWxJZDogcmVzb2x2ZWRNb2RlbElkLFxuICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgYWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgYW50aHJvcGljX3ZlcnNpb246IFwiYmVkcm9jay0yMDIzLTA1LTMxXCIsXG4gICAgICAgIG1heF90b2tlbnM6IG1heFRva2VucyxcbiAgICAgICAgdGVtcGVyYXR1cmU6IHRlbXBlcmF0dXJlLFxuICAgICAgICBtZXNzYWdlczogW3sgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IHByb21wdCB9XVxuICAgICAgfSlcbiAgICB9O1xuXG4gICAgLy8gSW52b2tlIG1vZGVsXG4gICAgY29uc3QgY29tbWFuZCA9IG5ldyBJbnZva2VNb2RlbENvbW1hbmQoaW5wdXQpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYmVkcm9ja0NsaWVudC5zZW5kKGNvbW1hbmQpO1xuXG4gICAgLy8gQ29udmVydCByYXcgcmVzcG9uc2UgaW50byB0ZXh0XG4gICAgY29uc3QgcmF3VGV4dCA9IGF3YWl0IChhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBib2R5OiBhbnkgPSAocmVzcG9uc2UgYXMgYW55KS5ib2R5O1xuICAgICAgaWYgKHR5cGVvZiBib2R5Py50cmFuc2Zvcm1Ub0J5dGVBcnJheSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoYXdhaXQgYm9keS50cmFuc2Zvcm1Ub0J5dGVBcnJheSgpKTtcbiAgICAgIH1cbiAgICAgIGlmIChib2R5IGluc3RhbmNlb2YgVWludDhBcnJheSkge1xuICAgICAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGJvZHkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFN0cmluZyhib2R5ID8/IFwiXCIpO1xuICAgIH0pKCk7XG5cbiAgICBjb25zdCByZXNwb25zZUJvZHkgPSBKU09OLnBhcnNlKHJhd1RleHQgfHwgXCJ7fVwiKTtcbiAgICBjb25zdCBjbGF1ZGVSZXNwb25zZSA9IHJlc3BvbnNlQm9keT8uY29udGVudD8uWzBdPy50ZXh0IHx8IFwiXCI7XG5cbiAgICAvLyBTdHJpcCBtYXJrZG93blxuICAgIGxldCBjbGVhbmVkID0gY2xhdWRlUmVzcG9uc2UudHJpbSgpXG4gICAgICAucmVwbGFjZSgvXmBgYGpzb25cXHMqL2ksIFwiXCIpXG4gICAgICAucmVwbGFjZSgvXmBgYFxccyovaSwgXCJcIilcbiAgICAgIC5yZXBsYWNlKC9gYGAkL2ksIFwiXCIpXG4gICAgICAudHJpbSgpO1xuXG5cbiAgICAvLyBQYXJzZSBKU09OIChsYWJfcmVwb3J0IG11c3QgcHJvdmlkZSBjYXRlZ29yaWVzIEpTT04pXG4gICAgbGV0IHBhcnNlZDogYW55O1xuICAgIHRyeSB7XG4gICAgICBwYXJzZWQgPSBKU09OLnBhcnNlKGNsZWFuZWQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCBKU09OOlwiLCBjbGVhbmVkLnN1YnN0cmluZygwLCA1MDApKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgSlNPTiByZXNwb25zZSBmcm9tIENsYXVkZVwiKTtcbiAgICB9XG5cbiAgICAvLyBMYWIgcmVwb3J0IHJlcXVpcmVkIHN0cnVjdHVyZVxuICAgIGlmICghcGFyc2VkLmNhdGVnb3JpZXMgfHwgIUFycmF5LmlzQXJyYXkocGFyc2VkLmNhdGVnb3JpZXMpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGxhYiByZXBvcnQgSlNPTjogbWlzc2luZyBjYXRlZ29yaWVzXCIpO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgcmVwb3J0RGF0ZTogcGFyc2VkLnJlcG9ydERhdGUgPz8gbnVsbCxcbiAgICAgIGNvbmZpZGVuY2U6IHBhcnNlZC5jb25maWRlbmNlID8/IDAuOTUsXG4gICAgICBjYXRlZ29yaWVzOiBwYXJzZWQuY2F0ZWdvcmllc1xuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHByb2Nlc3NpbmcgbWVkaWNhbCByZWNvcmQgd2l0aCBDbGF1ZGU6XCIsIGVycm9yKTtcbiAgICBjb25zdCBtc2cgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiVW5rbm93biBlcnJvclwiO1xuXG4gICAgaWYgKG1zZy5pbmNsdWRlcyhcIlVucmVjb2duaXplZENsaWVudEV4Y2VwdGlvblwiKSB8fCBtc2cuaW5jbHVkZXMoXCJJbnZhbGlkU2lnbmF0dXJlRXhjZXB0aW9uXCIpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBV1MgQmVkcm9jayBhdXRoZW50aWNhdGlvbiBmYWlsZWQuXCIpO1xuICAgIH1cbiAgICBpZiAobXNnLmluY2x1ZGVzKFwiVmFsaWRhdGlvbkV4Y2VwdGlvblwiKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQVdTIEJlZHJvY2sgdmFsaWRhdGlvbiBlcnJvcjogXCIgKyBtc2cpO1xuICAgIH1cbiAgICBpZiAobXNnLmluY2x1ZGVzKFwiTW9kZWxOb3RSZWFkeUV4Y2VwdGlvblwiKSB8fCBtc2cuaW5jbHVkZXMoXCJUaHJvdHRsaW5nRXhjZXB0aW9uXCIpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBV1MgQmVkcm9jayB0ZW1wb3JhcmlseSB1bmF2YWlsYWJsZS5cIik7XG4gICAgfVxuICAgIGlmIChtc2cuaW5jbHVkZXMoXCJBY2Nlc3NEZW5pZWRFeGNlcHRpb25cIikpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlBlcm1pc3Npb24gZGVuaWVkIGZvciBBV1MgQmVkcm9jay5cIik7XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTWVkaWNhbCByZWNvcmQgcHJvY2Vzc2luZyBmYWlsZWQ6IFwiICsgbXNnKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkJlZHJvY2tSdW50aW1lQ2xpZW50IiwiSW52b2tlTW9kZWxDb21tYW5kIiwiYmVkcm9ja0NsaWVudCIsInJlZ2lvbiIsInByb2Nlc3MiLCJlbnYiLCJBV1NfUkVHSU9OIiwiQVdTX0JFRFJPQ0tfUkVHSU9OIiwiY3JlZGVudGlhbHMiLCJhY2Nlc3NLZXlJZCIsIkFXU19CRURST0NLX0FDQ0VTU19LRVlfSUQiLCJBV1NfQUNDRVNTX0tFWV9JRCIsInNlY3JldEFjY2Vzc0tleSIsIkFXU19CRURST0NLX1NFQ1JFVF9BQ0NFU1NfS0VZIiwiQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZIiwiQ0xBVURFX1NPTk5FVF9QUk9GSUxFX0FSTiIsIkJFRFJPQ0tfUFJPRklMRV9BUk4iLCJDTEFVREVfT1BVU19QUk9GSUxFX0FSTiIsIkJFRFJPQ0tfT1BVU19QUk9GSUxFX0FSTiIsIkNMQVVERV9TT05ORVRfTU9ERUxfSUQiLCJDTEFVREVfT1BVU19NT0RFTF9JRCIsImRlaWRlbnRpZnlNZWRpY2FsUmVjb3JkIiwicmVjb3JkIiwiZGVpZGVudGlmaWVkIiwicGhpUGF0dGVybnMiLCJmb3JFYWNoIiwicGF0dGVybiIsInJlcGxhY2UiLCJjcmVhdGVNZWRpY2FsUHJvY2Vzc2luZ1Byb21wdCIsInByb2Nlc3NNZWRpY2FsUmVjb3JkV2l0aENsYXVkZSIsInJlcXVlc3QiLCJzYWZlUmVjb3JkIiwiZGVpZGVudGlmaWVkRGF0YSIsIm1lZGljYWxSZWNvcmQiLCJyZWNvcmRGb3JEZXRlY3Rpb24iLCJ0b0xvd2VyQ2FzZSIsInByb21wdCIsIm1vZGVsSWQiLCJtYXhUb2tlbnMiLCJ0ZW1wZXJhdHVyZSIsImlzQ29tcGxleENhc2UiLCJsZW5ndGgiLCJpbmNsdWRlcyIsImNvbnNvbGUiLCJsb2ciLCJyZXNvbHZlZE1vZGVsSWQiLCJpbnB1dCIsImNvbnRlbnRUeXBlIiwiYWNjZXB0IiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhbnRocm9waWNfdmVyc2lvbiIsIm1heF90b2tlbnMiLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50IiwiY29tbWFuZCIsInJlc3BvbnNlIiwic2VuZCIsInJhd1RleHQiLCJ0cmFuc2Zvcm1Ub0J5dGVBcnJheSIsIlRleHREZWNvZGVyIiwiZGVjb2RlIiwiVWludDhBcnJheSIsIlN0cmluZyIsInJlc3BvbnNlQm9keSIsInBhcnNlIiwiY2xhdWRlUmVzcG9uc2UiLCJ0ZXh0IiwiY2xlYW5lZCIsInRyaW0iLCJwYXJzZWQiLCJlcnIiLCJlcnJvciIsInN1YnN0cmluZyIsIkVycm9yIiwiY2F0ZWdvcmllcyIsIkFycmF5IiwiaXNBcnJheSIsInJlcG9ydERhdGUiLCJjb25maWRlbmNlIiwibXNnIiwibWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./bedrock-config.ts/bedrock-config.ts\n");

/***/ }),

/***/ "(rsc)/./src/app/api/ocr-menus/route.ts":
/*!****************************************!*\
  !*** ./src/app/api/ocr-menus/route.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _services_ocr__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../services/ocr */ \"(rsc)/./src/services/ocr.ts\");\n/* harmony import */ var _services_aiExtractor__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../services/aiExtractor */ \"(rsc)/./src/services/aiExtractor.ts\");\n/* harmony import */ var _services_normalizer__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../services/normalizer */ \"(rsc)/./src/services/normalizer.ts\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_5__);\n// src/app/api/ocr-menus/route.ts\n\n\n\n\n\n\n\nconst OCR_OUTPUT_DIR = (0,path__WEBPACK_IMPORTED_MODULE_5__.join)(process.cwd(), \"ocr_outputs\");\nconst runtime = \"nodejs\";\n/**\r\n * POST /api/ocr-menus\r\n * -------------------\r\n * 1. Accepts PDF / image uploads (FormData: file or files[]).\r\n * 2. Runs OCR + Bedrock extraction.\r\n * 3. Normalizes & validates packages.\r\n * 4. Returns JSON with { success, batch_id, files, packages, summary }.\r\n * 5. âœ… Also saves the same JSON payload as a pretty-printed file:\r\n *      ./ocr_outputs/<batch_id>.json\r\n */ async function POST(req) {\n    try {\n        // 1) Upload + OCR\n        const { batchId, ocrPages, filesMeta } = await (0,_services_ocr__WEBPACK_IMPORTED_MODULE_1__.handleUploadAndExtractOcr)(req);\n        // 2) AI extraction â†’ raw PackageRow[]\n        const extractedPackages = await (0,_services_aiExtractor__WEBPACK_IMPORTED_MODULE_2__.extractPackagesFromOcrText)(ocrPages);\n        // 3) Normalise + validate\n        const normalizedPackages = extractedPackages.map((pkg)=>(0,_services_normalizer__WEBPACK_IMPORTED_MODULE_3__.normalizePackageRow)(pkg));\n        const { validPackages, packagesWithWarnings, invalidPackages } = (0,_services_normalizer__WEBPACK_IMPORTED_MODULE_3__.validatePackageBatch)(normalizedPackages);\n        const summary = {\n            total: normalizedPackages.length,\n            valid: validPackages.length,\n            withWarnings: packagesWithWarnings.length,\n            invalid: invalidPackages.length\n        };\n        const responseBody = {\n            success: true,\n            batch_id: batchId,\n            files: filesMeta,\n            packages: normalizedPackages,\n            summary\n        };\n        // 4) âœ… Persist a pretty-printed JSON snapshot to ./ocr_outputs/<batch_id>.json\n        await persistOcrResult(batchId, responseBody);\n        // 5) Return JSON response as usual\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(responseBody, {\n            status: 200\n        });\n    } catch (error) {\n        console.error(\"OCR menu processing failed:\", error);\n        const message = error?.message || \"OCR / AI extraction failed. Please try again.\";\n        const status = typeof error?.status === \"number\" ? error.status : 500;\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            message\n        }, {\n            status\n        });\n    }\n}\n// ---------------------------------------------------------------------------\n// Helper: Save OCR result as pretty-printed JSON\n// ---------------------------------------------------------------------------\nasync function persistOcrResult(batchId, data) {\n    try {\n        // Ensure ./ocr_outputs exists\n        (0,fs__WEBPACK_IMPORTED_MODULE_4__.mkdirSync)(OCR_OUTPUT_DIR, {\n            recursive: true\n        });\n        // File name: <batch_id>.json\n        const filePath = (0,path__WEBPACK_IMPORTED_MODULE_5__.join)(OCR_OUTPUT_DIR, `${batchId}.json`);\n        // Pretty-printed JSON with 2-space indent\n        const json = JSON.stringify(data, null, 2);\n        await fs__WEBPACK_IMPORTED_MODULE_4__.promises.writeFile(filePath, json, \"utf8\");\n        console.log(`[OCR] Saved JSON snapshot â†’ ${filePath}`);\n    } catch (err) {\n        // Don't crash the request if file writing fails â€“ just log it\n        console.error(\"Failed to persist OCR JSON result:\", err);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9vY3ItbWVudXMvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLGlDQUFpQztBQUN1QjtBQUNVO0FBQ1M7QUFLckM7QUFFRjtBQUNMO0FBQ0g7QUFFNUIsTUFBTVMsaUJBQWlCRCwwQ0FBSUEsQ0FBQ0UsUUFBUUMsR0FBRyxJQUFJO0FBQ3BDLE1BQU1DLFVBQVUsU0FBUztBQUVoQzs7Ozs7Ozs7O0NBU0MsR0FDTSxlQUFlQyxLQUFLQyxHQUFnQjtJQUN6QyxJQUFJO1FBQ0Ysa0JBQWtCO1FBQ2xCLE1BQU0sRUFBRUMsT0FBTyxFQUFFQyxRQUFRLEVBQUVDLFNBQVMsRUFBRSxHQUFHLE1BQU1oQix3RUFBeUJBLENBQUNhO1FBRXpFLHNDQUFzQztRQUN0QyxNQUFNSSxvQkFBb0IsTUFBTWhCLGlGQUEwQkEsQ0FBQ2M7UUFFM0QsMEJBQTBCO1FBQzFCLE1BQU1HLHFCQUFtQ0Qsa0JBQWtCRSxHQUFHLENBQUMsQ0FBQ0MsTUFDOURsQix5RUFBbUJBLENBQUNrQjtRQUd0QixNQUFNLEVBQUVDLGFBQWEsRUFBRUMsb0JBQW9CLEVBQUVDLGVBQWUsRUFBRSxHQUM1RHBCLDBFQUFvQkEsQ0FBQ2U7UUFFdkIsTUFBTU0sVUFBVTtZQUNkQyxPQUFPUCxtQkFBbUJRLE1BQU07WUFDaENDLE9BQU9OLGNBQWNLLE1BQU07WUFDM0JFLGNBQWNOLHFCQUFxQkksTUFBTTtZQUN6Q0csU0FBU04sZ0JBQWdCRyxNQUFNO1FBQ2pDO1FBRUEsTUFBTUksZUFBZTtZQUNuQkMsU0FBUztZQUNUQyxVQUFVbEI7WUFDVm1CLE9BQU9qQjtZQUNQa0IsVUFBVWhCO1lBQ1ZNO1FBQ0Y7UUFFQSwrRUFBK0U7UUFDL0UsTUFBTVcsaUJBQWlCckIsU0FBU2dCO1FBRWhDLG1DQUFtQztRQUNuQyxPQUFPL0IscURBQVlBLENBQUNxQyxJQUFJLENBQUNOLGNBQWM7WUFBRU8sUUFBUTtRQUFJO0lBQ3ZELEVBQUUsT0FBT0MsT0FBWTtRQUNuQkMsUUFBUUQsS0FBSyxDQUFDLCtCQUErQkE7UUFDN0MsTUFBTUUsVUFDSkYsT0FBT0UsV0FBVztRQUVwQixNQUFNSCxTQUFTLE9BQU9DLE9BQU9ELFdBQVcsV0FBV0MsTUFBTUQsTUFBTSxHQUFHO1FBRWxFLE9BQU90QyxxREFBWUEsQ0FBQ3FDLElBQUksQ0FDdEI7WUFDRUwsU0FBUztZQUNUUztRQUNGLEdBQ0E7WUFBRUg7UUFBTztJQUViO0FBQ0Y7QUFFQSw4RUFBOEU7QUFDOUUsaURBQWlEO0FBQ2pELDhFQUE4RTtBQUM5RSxlQUFlRixpQkFBaUJyQixPQUFlLEVBQUUyQixJQUFTO0lBQ3hELElBQUk7UUFDRiw4QkFBOEI7UUFDOUJuQyw2Q0FBU0EsQ0FBQ0UsZ0JBQWdCO1lBQUVrQyxXQUFXO1FBQUs7UUFFNUMsNkJBQTZCO1FBQzdCLE1BQU1DLFdBQVdwQywwQ0FBSUEsQ0FBQ0MsZ0JBQWdCLENBQUMsRUFBRU0sUUFBUSxLQUFLLENBQUM7UUFFdkQsMENBQTBDO1FBQzFDLE1BQU1zQixPQUFPUSxLQUFLQyxTQUFTLENBQUNKLE1BQU0sTUFBTTtRQUV4QyxNQUFNcEMsd0NBQUVBLENBQUN5QyxTQUFTLENBQUNILFVBQVVQLE1BQU07UUFDbkNHLFFBQVFRLEdBQUcsQ0FBQyxDQUFDLDRCQUE0QixFQUFFSixTQUFTLENBQUM7SUFDdkQsRUFBRSxPQUFPSyxLQUFLO1FBQ1osOERBQThEO1FBQzlEVCxRQUFRRCxLQUFLLENBQUMsc0NBQXNDVTtJQUN0RDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGVtZWRpY2EtY2xpbmljLW9jci8uL3NyYy9hcHAvYXBpL29jci1tZW51cy9yb3V0ZS50cz9iMDE2Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9hcHAvYXBpL29jci1tZW51cy9yb3V0ZS50c1xyXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcbmltcG9ydCB7IGhhbmRsZVVwbG9hZEFuZEV4dHJhY3RPY3IgfSBmcm9tIFwiLi4vLi4vLi4vc2VydmljZXMvb2NyXCI7XHJcbmltcG9ydCB7IGV4dHJhY3RQYWNrYWdlc0Zyb21PY3JUZXh0IH0gZnJvbSBcIi4uLy4uLy4uL3NlcnZpY2VzL2FpRXh0cmFjdG9yXCI7XHJcbmltcG9ydCB7IFBhY2thZ2VSb3d9IGZyb20gXCJAL2xpYi90eXBlcy9vY3JcIjtcclxuaW1wb3J0IHtcclxuICBub3JtYWxpemVQYWNrYWdlUm93LFxyXG4gIHZhbGlkYXRlUGFja2FnZUJhdGNoLFxyXG59IGZyb20gXCIuLi8uLi8uLi9zZXJ2aWNlcy9ub3JtYWxpemVyXCI7XHJcblxyXG5pbXBvcnQgeyBwcm9taXNlcyBhcyBmcyB9IGZyb20gXCJmc1wiO1xyXG5pbXBvcnQgeyBta2RpclN5bmMgfSBmcm9tIFwiZnNcIjtcclxuaW1wb3J0IHsgam9pbiB9IGZyb20gXCJwYXRoXCI7XHJcblxyXG5jb25zdCBPQ1JfT1VUUFVUX0RJUiA9IGpvaW4ocHJvY2Vzcy5jd2QoKSwgXCJvY3Jfb3V0cHV0c1wiKTtcclxuZXhwb3J0IGNvbnN0IHJ1bnRpbWUgPSBcIm5vZGVqc1wiO1xyXG5cclxuLyoqXHJcbiAqIFBPU1QgL2FwaS9vY3ItbWVudXNcclxuICogLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gKiAxLiBBY2NlcHRzIFBERiAvIGltYWdlIHVwbG9hZHMgKEZvcm1EYXRhOiBmaWxlIG9yIGZpbGVzW10pLlxyXG4gKiAyLiBSdW5zIE9DUiArIEJlZHJvY2sgZXh0cmFjdGlvbi5cclxuICogMy4gTm9ybWFsaXplcyAmIHZhbGlkYXRlcyBwYWNrYWdlcy5cclxuICogNC4gUmV0dXJucyBKU09OIHdpdGggeyBzdWNjZXNzLCBiYXRjaF9pZCwgZmlsZXMsIHBhY2thZ2VzLCBzdW1tYXJ5IH0uXHJcbiAqIDUuIOKchSBBbHNvIHNhdmVzIHRoZSBzYW1lIEpTT04gcGF5bG9hZCBhcyBhIHByZXR0eS1wcmludGVkIGZpbGU6XHJcbiAqICAgICAgLi9vY3Jfb3V0cHV0cy88YmF0Y2hfaWQ+Lmpzb25cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgLy8gMSkgVXBsb2FkICsgT0NSXHJcbiAgICBjb25zdCB7IGJhdGNoSWQsIG9jclBhZ2VzLCBmaWxlc01ldGEgfSA9IGF3YWl0IGhhbmRsZVVwbG9hZEFuZEV4dHJhY3RPY3IocmVxKTtcclxuXHJcbiAgICAvLyAyKSBBSSBleHRyYWN0aW9uIOKGkiByYXcgUGFja2FnZVJvd1tdXHJcbiAgICBjb25zdCBleHRyYWN0ZWRQYWNrYWdlcyA9IGF3YWl0IGV4dHJhY3RQYWNrYWdlc0Zyb21PY3JUZXh0KG9jclBhZ2VzKTtcclxuXHJcbiAgICAvLyAzKSBOb3JtYWxpc2UgKyB2YWxpZGF0ZVxyXG4gICAgY29uc3Qgbm9ybWFsaXplZFBhY2thZ2VzOiBQYWNrYWdlUm93W10gPSBleHRyYWN0ZWRQYWNrYWdlcy5tYXAoKHBrZykgPT5cclxuICAgICAgbm9ybWFsaXplUGFja2FnZVJvdyhwa2cpXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHsgdmFsaWRQYWNrYWdlcywgcGFja2FnZXNXaXRoV2FybmluZ3MsIGludmFsaWRQYWNrYWdlcyB9ID1cclxuICAgICAgdmFsaWRhdGVQYWNrYWdlQmF0Y2gobm9ybWFsaXplZFBhY2thZ2VzKTtcclxuXHJcbiAgICBjb25zdCBzdW1tYXJ5ID0ge1xyXG4gICAgICB0b3RhbDogbm9ybWFsaXplZFBhY2thZ2VzLmxlbmd0aCxcclxuICAgICAgdmFsaWQ6IHZhbGlkUGFja2FnZXMubGVuZ3RoLFxyXG4gICAgICB3aXRoV2FybmluZ3M6IHBhY2thZ2VzV2l0aFdhcm5pbmdzLmxlbmd0aCxcclxuICAgICAgaW52YWxpZDogaW52YWxpZFBhY2thZ2VzLmxlbmd0aCxcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcmVzcG9uc2VCb2R5ID0ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBiYXRjaF9pZDogYmF0Y2hJZCxcclxuICAgICAgZmlsZXM6IGZpbGVzTWV0YSxcclxuICAgICAgcGFja2FnZXM6IG5vcm1hbGl6ZWRQYWNrYWdlcyxcclxuICAgICAgc3VtbWFyeSxcclxuICAgIH07XHJcblxyXG4gICAgLy8gNCkg4pyFIFBlcnNpc3QgYSBwcmV0dHktcHJpbnRlZCBKU09OIHNuYXBzaG90IHRvIC4vb2NyX291dHB1dHMvPGJhdGNoX2lkPi5qc29uXHJcbiAgICBhd2FpdCBwZXJzaXN0T2NyUmVzdWx0KGJhdGNoSWQsIHJlc3BvbnNlQm9keSk7XHJcblxyXG4gICAgLy8gNSkgUmV0dXJuIEpTT04gcmVzcG9uc2UgYXMgdXN1YWxcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXNwb25zZUJvZHksIHsgc3RhdHVzOiAyMDAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcihcIk9DUiBtZW51IHByb2Nlc3NpbmcgZmFpbGVkOlwiLCBlcnJvcik7XHJcbiAgICBjb25zdCBtZXNzYWdlID1cclxuICAgICAgZXJyb3I/Lm1lc3NhZ2UgfHwgXCJPQ1IgLyBBSSBleHRyYWN0aW9uIGZhaWxlZC4gUGxlYXNlIHRyeSBhZ2Fpbi5cIjtcclxuXHJcbiAgICBjb25zdCBzdGF0dXMgPSB0eXBlb2YgZXJyb3I/LnN0YXR1cyA9PT0gXCJudW1iZXJcIiA/IGVycm9yLnN0YXR1cyA6IDUwMDtcclxuXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlLFxyXG4gICAgICB9LFxyXG4gICAgICB7IHN0YXR1cyB9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vIEhlbHBlcjogU2F2ZSBPQ1IgcmVzdWx0IGFzIHByZXR0eS1wcmludGVkIEpTT05cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbmFzeW5jIGZ1bmN0aW9uIHBlcnNpc3RPY3JSZXN1bHQoYmF0Y2hJZDogc3RyaW5nLCBkYXRhOiBhbnkpIHtcclxuICB0cnkge1xyXG4gICAgLy8gRW5zdXJlIC4vb2NyX291dHB1dHMgZXhpc3RzXHJcbiAgICBta2RpclN5bmMoT0NSX09VVFBVVF9ESVIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xyXG5cclxuICAgIC8vIEZpbGUgbmFtZTogPGJhdGNoX2lkPi5qc29uXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGpvaW4oT0NSX09VVFBVVF9ESVIsIGAke2JhdGNoSWR9Lmpzb25gKTtcclxuXHJcbiAgICAvLyBQcmV0dHktcHJpbnRlZCBKU09OIHdpdGggMi1zcGFjZSBpbmRlbnRcclxuICAgIGNvbnN0IGpzb24gPSBKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAyKTtcclxuXHJcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUoZmlsZVBhdGgsIGpzb24sIFwidXRmOFwiKTtcclxuICAgIGNvbnNvbGUubG9nKGBbT0NSXSBTYXZlZCBKU09OIHNuYXBzaG90IOKGkiAke2ZpbGVQYXRofWApO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgLy8gRG9uJ3QgY3Jhc2ggdGhlIHJlcXVlc3QgaWYgZmlsZSB3cml0aW5nIGZhaWxzIOKAkyBqdXN0IGxvZyBpdFxyXG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBwZXJzaXN0IE9DUiBKU09OIHJlc3VsdDpcIiwgZXJyKTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImhhbmRsZVVwbG9hZEFuZEV4dHJhY3RPY3IiLCJleHRyYWN0UGFja2FnZXNGcm9tT2NyVGV4dCIsIm5vcm1hbGl6ZVBhY2thZ2VSb3ciLCJ2YWxpZGF0ZVBhY2thZ2VCYXRjaCIsInByb21pc2VzIiwiZnMiLCJta2RpclN5bmMiLCJqb2luIiwiT0NSX09VVFBVVF9ESVIiLCJwcm9jZXNzIiwiY3dkIiwicnVudGltZSIsIlBPU1QiLCJyZXEiLCJiYXRjaElkIiwib2NyUGFnZXMiLCJmaWxlc01ldGEiLCJleHRyYWN0ZWRQYWNrYWdlcyIsIm5vcm1hbGl6ZWRQYWNrYWdlcyIsIm1hcCIsInBrZyIsInZhbGlkUGFja2FnZXMiLCJwYWNrYWdlc1dpdGhXYXJuaW5ncyIsImludmFsaWRQYWNrYWdlcyIsInN1bW1hcnkiLCJ0b3RhbCIsImxlbmd0aCIsInZhbGlkIiwid2l0aFdhcm5pbmdzIiwiaW52YWxpZCIsInJlc3BvbnNlQm9keSIsInN1Y2Nlc3MiLCJiYXRjaF9pZCIsImZpbGVzIiwicGFja2FnZXMiLCJwZXJzaXN0T2NyUmVzdWx0IiwianNvbiIsInN0YXR1cyIsImVycm9yIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJkYXRhIiwicmVjdXJzaXZlIiwiZmlsZVBhdGgiLCJKU09OIiwic3RyaW5naWZ5Iiwid3JpdGVGaWxlIiwibG9nIiwiZXJyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/ocr-menus/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/validation.ts":
/*!*******************************!*\
  !*** ./src/lib/validation.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getFieldError: () => (/* binding */ getFieldError),\n/* harmony export */   isFieldInvalid: () => (/* binding */ isFieldInvalid),\n/* harmony export */   matchHospitalName: () => (/* binding */ matchHospitalName),\n/* harmony export */   matchTreatmentName: () => (/* binding */ matchTreatmentName),\n/* harmony export */   matchingReferenceData: () => (/* binding */ matchingReferenceData),\n/* harmony export */   validateAllRows: () => (/* binding */ validateAllRows),\n/* harmony export */   validateRow: () => (/* binding */ validateRow)\n/* harmony export */ });\n// src/lib/validation.ts\n// Shared validation + fuzzy matching for Clinic Menu OCR â†’ CSV\n/* -------------------------------------------------------------------------- */ /*  Curated reference data (hospital & treatment names)                       */ /* -------------------------------------------------------------------------- */ const HOSPITAL_NAMES = [\n    \"Bumrungrad Intl\",\n    \"Mery Plastic Surgery\",\n    \"Pruksa Clinic\",\n    \"SLC hospital\",\n    \"Panacee Medical Center\",\n    \"The Square Clinic\",\n    \"Vethjani Hospital\",\n    \"Phuket Plastic Surgery Institute\",\n    \"Wansiri Hospital\",\n    \"Prince Court\",\n    \"Raffles Medical\",\n    \"Sunway Medical Center\",\n    \"Thomson Hospital\",\n    \"China Medical University Hospital - ä¸­åœ‹é†«è—¥å¤§å­¸é™„è¨­é†«é™¢\"\n];\nconst TREATMENT_NAMES = [\n    \"Health Checkup\",\n    \"Cancer Screening\",\n    \"MRI Scan\",\n    \"CT Scan\",\n    \"PET-CT Scan\",\n    \"Blood Test\",\n    \"Cardiac Screening\",\n    \"Hip & Knee Replacement\",\n    \"Spinal Surgery\",\n    \"Brain Tumor Surgery\",\n    \"Heart Valve Repair\",\n    \"Kidney Transplant\",\n    \"Liver Transplant\",\n    \"LASIK Surgery\",\n    \"Cataract Surgery\",\n    \"Glaucoma Surgery\",\n    \"Gastric Sleeve\",\n    \"Gastric Bypass\",\n    \"Endoscopic Sleeve Gastroplasty\",\n    \"Gender-Affirming Surgery\",\n    \"Pacemaker Implantation\",\n    \"Prostate Surgery\",\n    \"Vasectomy Reversal\",\n    \"Hysterectomy\",\n    \"Fibroid Removal\",\n    \"Corneal Transplant\",\n    \"Deep Brain Stimulation (DBS)\",\n    \"Epilepsy Surgery\",\n    \"Spinal Cord Surgery\",\n    \"Facial Plastic Surgery\",\n    \"Breast Augmentation\",\n    \"Rhinoplasty\",\n    \"Liposuction\",\n    \"Botox Treatment\",\n    \"Dermal Fillers\",\n    \"Hair Transplant\",\n    \"Laser Resurfacing\",\n    \"Buccal Fat Removal\",\n    \"Chin Augmentation\",\n    \"Teeth Whitening\",\n    \"Veneer\",\n    \"Dental Implants\",\n    \"Root Canal\",\n    \"IVF (In Vitro Fertilization)\",\n    \"IUI (Intrauterine Insemination)\",\n    \"Egg Freezing\",\n    \"HRT (Hormone Replacement Therapy)\",\n    \"Chemotherapy\",\n    \"Radiation Therapy\",\n    \"Immunotherapy\",\n    \"Proton Therapy\",\n    \"Detox Retreats\",\n    \"IV Therapy\",\n    \"Anti-Aging Therapy\",\n    \"Physiotherapy\",\n    \"Acupuncture\",\n    \"Ayurveda\",\n    \"Thai Massage\"\n];\nconst MIN_HOSPITAL_SCORE = 0.72;\nconst MIN_TREATMENT_SCORE = 0.7;\nconst matchingReferenceData = {\n    hospitals: HOSPITAL_NAMES,\n    treatments: TREATMENT_NAMES\n};\n/* -------------------------------------------------------------------------- */ /*  Fuzzy matching helpers (Levenshtein-based)                                */ /* -------------------------------------------------------------------------- */ function normalize(value) {\n    return value.toLowerCase().replace(/[^a-z0-9]+/g, \"\").trim();\n}\nfunction levenshtein(a, b) {\n    if (a === b) return 0;\n    if (!a.length) return b.length;\n    if (!b.length) return a.length;\n    const matrix = Array.from({\n        length: a.length + 1\n    }, (_, i)=>Array.from({\n            length: b.length + 1\n        }, (_, j)=>i === 0 ? j : j === 0 ? i : 0));\n    for(let i = 1; i <= a.length; i++){\n        for(let j = 1; j <= b.length; j++){\n            if (a[i - 1] === b[j - 1]) {\n                matrix[i][j] = matrix[i - 1][j - 1];\n            } else {\n                matrix[i][j] = Math.min(matrix[i - 1][j], matrix[i][j - 1], matrix[i - 1][j - 1]) + 1;\n            }\n        }\n    }\n    return matrix[a.length][b.length];\n}\nfunction similarityScore(source, candidate) {\n    if (!source || !candidate) return 0;\n    const normalizedSource = normalize(source);\n    const normalizedCandidate = normalize(candidate);\n    if (!normalizedSource.length || !normalizedCandidate.length) return 0;\n    const distance = levenshtein(normalizedSource, normalizedCandidate);\n    const longest = Math.max(normalizedSource.length, normalizedCandidate.length);\n    return 1 - distance / longest;\n}\n/**\n * Fuzzy match a raw hospital name against the curated list.\n */ function matchHospitalName(raw) {\n    if (!raw?.trim()) {\n        return {\n            value: null,\n            score: 0\n        };\n    }\n    let bestMatch = {\n        value: null,\n        score: 0\n    };\n    for (const hospital of HOSPITAL_NAMES){\n        const score = similarityScore(raw, hospital);\n        if (score > bestMatch.score) {\n            bestMatch = {\n                value: hospital,\n                score\n            };\n        }\n    }\n    if (bestMatch.score < MIN_HOSPITAL_SCORE) {\n        return {\n            value: null,\n            score: bestMatch.score\n        };\n    }\n    return bestMatch;\n}\n/**\n * Fuzzy match a raw treatment name against the curated list.\n */ function matchTreatmentName(raw) {\n    if (!raw?.trim()) {\n        return {\n            value: null,\n            score: 0\n        };\n    }\n    let bestMatch = {\n        value: null,\n        score: 0\n    };\n    for (const treatment of TREATMENT_NAMES){\n        const score = similarityScore(raw, treatment);\n        if (score > bestMatch.score) {\n            bestMatch = {\n                value: treatment,\n                score\n            };\n        }\n    }\n    if (bestMatch.score < MIN_TREATMENT_SCORE) {\n        return {\n            value: null,\n            score: bestMatch.score\n        };\n    }\n    return bestMatch;\n}\n/* -------------------------------------------------------------------------- */ /*  Client-side row validation (for the table UI)                             */ /* -------------------------------------------------------------------------- */ const REQUIRED_FIELDS = [\n    \"title\",\n    \"hospital_name\",\n    \"treatment_name\",\n    \"price\",\n    \"currency\"\n];\nfunction validateRow(row) {\n    const errors = [];\n    // Required: title\n    if (!row.title?.trim()) {\n        errors.push({\n            field: \"title\",\n            message: \"Title is required\"\n        });\n    }\n    // Required: hospital_name\n    if (!row.hospital_name?.trim()) {\n        errors.push({\n            field: \"hospital_name\",\n            message: \"Hospital name is required\"\n        });\n    }\n    // Required: treatment_name\n    if (!row.treatment_name?.trim()) {\n        errors.push({\n            field: \"treatment_name\",\n            message: \"Treatment name is required\"\n        });\n    }\n    // Required: price\n    if (row.price === null || row.price === undefined) {\n        errors.push({\n            field: \"price\",\n            message: \"Price is required\"\n        });\n    } else if (isNaN(Number(row.price)) || Number(row.price) < 0) {\n        errors.push({\n            field: \"price\",\n            message: \"Price must be a valid positive number\"\n        });\n    }\n    // Required: currency\n    if (!row.currency?.trim()) {\n        errors.push({\n            field: \"currency\",\n            message: \"Currency is required\"\n        });\n    }\n    // Optional: commission 0â€“100\n    if (row.commission !== null && row.commission !== undefined) {\n        const num = Number(row.commission);\n        if (isNaN(num) || num < 0 || num > 100) {\n            errors.push({\n                field: \"commission\",\n                message: \"Commission must be between 0 and 100\"\n            });\n        }\n    }\n    // Optional: original_price >= 0\n    if (row.original_price !== null && row.original_price !== undefined) {\n        const num = Number(row.original_price);\n        if (isNaN(num) || num < 0) {\n            errors.push({\n                field: \"original_price\",\n                message: \"Original price must be a valid positive number\"\n            });\n        }\n    }\n    return {\n        rowId: row.id || \"\",\n        isValid: errors.length === 0,\n        errors\n    };\n}\nfunction validateAllRows(rows) {\n    const validations = new Map();\n    let valid = 0;\n    let invalid = 0;\n    let withWarnings = 0;\n    rows.forEach((row, index)=>{\n        // Generate a stable row key even if backend did not send an id\n        const rowId = row.id ?? `row_${index}`;\n        // Run validation on the row; RowValidation.rowId will be overwritten below\n        const baseValidation = validateRow(row);\n        const validation = {\n            ...baseValidation,\n            rowId\n        };\n        validations.set(rowId, validation);\n        if (validation.isValid) {\n            valid++;\n        } else {\n            invalid++;\n        }\n        if (row._meta?.warnings && row._meta.warnings.length > 0) {\n            withWarnings++;\n        }\n    });\n    return {\n        validations,\n        summary: {\n            valid,\n            invalid,\n            withWarnings\n        }\n    };\n}\nfunction getFieldError(validations, rowId, field) {\n    const rowValidation = validations.get(rowId);\n    if (!rowValidation) return undefined;\n    const error = rowValidation.errors.find((e)=>e.field === field);\n    return error?.message;\n}\nfunction isFieldInvalid(validations, rowId, field) {\n    return !!getFieldError(validations, rowId, field);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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eEIsSUFBSStCLEtBQUssRUFBRUMsWUFBWWhDLElBQUkrQixLQUFLLENBQUNDLFFBQVEsQ0FBQzFELE1BQU0sR0FBRyxHQUFHO1lBQ3hEbUQ7UUFDRjtJQUNGO0lBRUEsT0FBTztRQUNMSjtRQUNBWSxTQUFTO1lBQUVWO1lBQU9DO1lBQVNDO1FBQWE7SUFDMUM7QUFDRjtBQUNPLFNBQVNTLGNBQ2RiLFdBQXVDLEVBQ3ZDTCxLQUFhLEVBQ2JaLEtBQWE7SUFFYixNQUFNK0IsZ0JBQWdCZCxZQUFZZSxHQUFHLENBQUNwQjtJQUN0QyxJQUFJLENBQUNtQixlQUFlLE9BQU8xQjtJQUMzQixNQUFNNEIsUUFBUUYsY0FBY2xDLE1BQU0sQ0FBQ3FDLElBQUksQ0FBQyxDQUFDQyxJQUFNQSxFQUFFbkMsS0FBSyxLQUFLQTtJQUMzRCxPQUFPaUMsT0FBT2hDO0FBQ2hCO0FBRU8sU0FBU21DLGVBQ2RuQixXQUF1QyxFQUN2Q0wsS0FBYSxFQUNiWixLQUFhO0lBRWIsT0FBTyxDQUFDLENBQUM4QixjQUFjYixhQUFhTCxPQUFPWjtBQUM3QyIsInNvdXJjZXMiOlsid2VicGFjazovL2xlbWVkaWNhLWNsaW5pYy1vY3IvLi9zcmMvbGliL3ZhbGlkYXRpb24udHM/NDYwZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvbGliL3ZhbGlkYXRpb24udHNcbi8vIFNoYXJlZCB2YWxpZGF0aW9uICsgZnV6enkgbWF0Y2hpbmcgZm9yIENsaW5pYyBNZW51IE9DUiDihpIgQ1NWXG5cbmltcG9ydCB0eXBlIHsgUGFja2FnZVJvdywgUm93VmFsaWRhdGlvbiwgVmFsaWRhdGlvbkVycm9yIH0gZnJvbSBcIkAvbGliL3R5cGVzL29jclwiO1xuXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuLyogIEN1cmF0ZWQgcmVmZXJlbmNlIGRhdGEgKGhvc3BpdGFsICYgdHJlYXRtZW50IG5hbWVzKSAgICAgICAgICAgICAgICAgICAgICAgKi9cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvbnN0IEhPU1BJVEFMX05BTUVTID0gW1xuICBcIkJ1bXJ1bmdyYWQgSW50bFwiLFxuICBcIk1lcnkgUGxhc3RpYyBTdXJnZXJ5XCIsXG4gIFwiUHJ1a3NhIENsaW5pY1wiLFxuICBcIlNMQyBob3NwaXRhbFwiLFxuICBcIlBhbmFjZWUgTWVkaWNhbCBDZW50ZXJcIixcbiAgXCJUaGUgU3F1YXJlIENsaW5pY1wiLFxuICBcIlZldGhqYW5pIEhvc3BpdGFsXCIsXG4gIFwiUGh1a2V0IFBsYXN0aWMgU3VyZ2VyeSBJbnN0aXR1dGVcIixcbiAgXCJXYW5zaXJpIEhvc3BpdGFsXCIsXG4gIFwiUHJpbmNlIENvdXJ0XCIsXG4gIFwiUmFmZmxlcyBNZWRpY2FsXCIsXG4gIFwiU3Vud2F5IE1lZGljYWwgQ2VudGVyXCIsXG4gIFwiVGhvbXNvbiBIb3NwaXRhbFwiLFxuICBcIkNoaW5hIE1lZGljYWwgVW5pdmVyc2l0eSBIb3NwaXRhbCAtIOS4reWci+mGq+iXpeWkp+WtuOmZhOioremGq+mZolwiLFxuXTtcblxuY29uc3QgVFJFQVRNRU5UX05BTUVTID0gW1xuICBcIkhlYWx0aCBDaGVja3VwXCIsXG4gIFwiQ2FuY2VyIFNjcmVlbmluZ1wiLFxuICBcIk1SSSBTY2FuXCIsXG4gIFwiQ1QgU2NhblwiLFxuICBcIlBFVC1DVCBTY2FuXCIsXG4gIFwiQmxvb2QgVGVzdFwiLFxuICBcIkNhcmRpYWMgU2NyZWVuaW5nXCIsXG4gIFwiSGlwICYgS25lZSBSZXBsYWNlbWVudFwiLFxuICBcIlNwaW5hbCBTdXJnZXJ5XCIsXG4gIFwiQnJhaW4gVHVtb3IgU3VyZ2VyeVwiLFxuICBcIkhlYXJ0IFZhbHZlIFJlcGFpclwiLFxuICBcIktpZG5leSBUcmFuc3BsYW50XCIsXG4gIFwiTGl2ZXIgVHJhbnNwbGFudFwiLFxuICBcIkxBU0lLIFN1cmdlcnlcIixcbiAgXCJDYXRhcmFjdCBTdXJnZXJ5XCIsXG4gIFwiR2xhdWNvbWEgU3VyZ2VyeVwiLFxuICBcIkdhc3RyaWMgU2xlZXZlXCIsXG4gIFwiR2FzdHJpYyBCeXBhc3NcIixcbiAgXCJFbmRvc2NvcGljIFNsZWV2ZSBHYXN0cm9wbGFzdHlcIixcbiAgXCJHZW5kZXItQWZmaXJtaW5nIFN1cmdlcnlcIixcbiAgXCJQYWNlbWFrZXIgSW1wbGFudGF0aW9uXCIsXG4gIFwiUHJvc3RhdGUgU3VyZ2VyeVwiLFxuICBcIlZhc2VjdG9teSBSZXZlcnNhbFwiLFxuICBcIkh5c3RlcmVjdG9teVwiLFxuICBcIkZpYnJvaWQgUmVtb3ZhbFwiLFxuICBcIkNvcm5lYWwgVHJhbnNwbGFudFwiLFxuICBcIkRlZXAgQnJhaW4gU3RpbXVsYXRpb24gKERCUylcIixcbiAgXCJFcGlsZXBzeSBTdXJnZXJ5XCIsXG4gIFwiU3BpbmFsIENvcmQgU3VyZ2VyeVwiLFxuICBcIkZhY2lhbCBQbGFzdGljIFN1cmdlcnlcIixcbiAgXCJCcmVhc3QgQXVnbWVudGF0aW9uXCIsXG4gIFwiUmhpbm9wbGFzdHlcIixcbiAgXCJMaXBvc3VjdGlvblwiLFxuICBcIkJvdG94IFRyZWF0bWVudFwiLFxuICBcIkRlcm1hbCBGaWxsZXJzXCIsXG4gIFwiSGFpciBUcmFuc3BsYW50XCIsXG4gIFwiTGFzZXIgUmVzdXJmYWNpbmdcIixcbiAgXCJCdWNjYWwgRmF0IFJlbW92YWxcIixcbiAgXCJDaGluIEF1Z21lbnRhdGlvblwiLFxuICBcIlRlZXRoIFdoaXRlbmluZ1wiLFxuICBcIlZlbmVlclwiLFxuICBcIkRlbnRhbCBJbXBsYW50c1wiLFxuICBcIlJvb3QgQ2FuYWxcIixcbiAgXCJJVkYgKEluIFZpdHJvIEZlcnRpbGl6YXRpb24pXCIsXG4gIFwiSVVJIChJbnRyYXV0ZXJpbmUgSW5zZW1pbmF0aW9uKVwiLFxuICBcIkVnZyBGcmVlemluZ1wiLFxuICBcIkhSVCAoSG9ybW9uZSBSZXBsYWNlbWVudCBUaGVyYXB5KVwiLFxuICBcIkNoZW1vdGhlcmFweVwiLFxuICBcIlJhZGlhdGlvbiBUaGVyYXB5XCIsXG4gIFwiSW1tdW5vdGhlcmFweVwiLFxuICBcIlByb3RvbiBUaGVyYXB5XCIsXG4gIFwiRGV0b3ggUmV0cmVhdHNcIixcbiAgXCJJViBUaGVyYXB5XCIsXG4gIFwiQW50aS1BZ2luZyBUaGVyYXB5XCIsXG4gIFwiUGh5c2lvdGhlcmFweVwiLFxuICBcIkFjdXB1bmN0dXJlXCIsXG4gIFwiQXl1cnZlZGFcIixcbiAgXCJUaGFpIE1hc3NhZ2VcIixcbl07XG5cbmNvbnN0IE1JTl9IT1NQSVRBTF9TQ09SRSA9IDAuNzI7XG5jb25zdCBNSU5fVFJFQVRNRU5UX1NDT1JFID0gMC43O1xuXG5leHBvcnQgY29uc3QgbWF0Y2hpbmdSZWZlcmVuY2VEYXRhID0ge1xuICBob3NwaXRhbHM6IEhPU1BJVEFMX05BTUVTLFxuICB0cmVhdG1lbnRzOiBUUkVBVE1FTlRfTkFNRVMsXG59O1xuXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuLyogIEZ1enp5IG1hdGNoaW5nIGhlbHBlcnMgKExldmVuc2h0ZWluLWJhc2VkKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZSh2YWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIHZhbHVlLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW15hLXowLTldKy9nLCBcIlwiKS50cmltKCk7XG59XG5cbmZ1bmN0aW9uIGxldmVuc2h0ZWluKGE6IHN0cmluZywgYjogc3RyaW5nKTogbnVtYmVyIHtcbiAgaWYgKGEgPT09IGIpIHJldHVybiAwO1xuICBpZiAoIWEubGVuZ3RoKSByZXR1cm4gYi5sZW5ndGg7XG4gIGlmICghYi5sZW5ndGgpIHJldHVybiBhLmxlbmd0aDtcblxuICBjb25zdCBtYXRyaXg6IG51bWJlcltdW10gPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiBhLmxlbmd0aCArIDEgfSwgKF8sIGkpID0+XG4gICAgQXJyYXkuZnJvbSh7IGxlbmd0aDogYi5sZW5ndGggKyAxIH0sIChfLCBqKSA9PiAoaSA9PT0gMCA/IGogOiBqID09PSAwID8gaSA6IDApKSxcbiAgKTtcblxuICBmb3IgKGxldCBpID0gMTsgaSA8PSBhLmxlbmd0aDsgaSsrKSB7XG4gICAgZm9yIChsZXQgaiA9IDE7IGogPD0gYi5sZW5ndGg7IGorKykge1xuICAgICAgaWYgKGFbaSAtIDFdID09PSBiW2ogLSAxXSkge1xuICAgICAgICBtYXRyaXhbaV1bal0gPSBtYXRyaXhbaSAtIDFdW2ogLSAxXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1hdHJpeFtpXVtqXSA9XG4gICAgICAgICAgTWF0aC5taW4obWF0cml4W2kgLSAxXVtqXSwgbWF0cml4W2ldW2ogLSAxXSwgbWF0cml4W2kgLSAxXVtqIC0gMV0pICsgMTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gbWF0cml4W2EubGVuZ3RoXVtiLmxlbmd0aF07XG59XG5cbmZ1bmN0aW9uIHNpbWlsYXJpdHlTY29yZShzb3VyY2U6IHN0cmluZywgY2FuZGlkYXRlOiBzdHJpbmcpOiBudW1iZXIge1xuICBpZiAoIXNvdXJjZSB8fCAhY2FuZGlkYXRlKSByZXR1cm4gMDtcbiAgY29uc3Qgbm9ybWFsaXplZFNvdXJjZSA9IG5vcm1hbGl6ZShzb3VyY2UpO1xuICBjb25zdCBub3JtYWxpemVkQ2FuZGlkYXRlID0gbm9ybWFsaXplKGNhbmRpZGF0ZSk7XG4gIGlmICghbm9ybWFsaXplZFNvdXJjZS5sZW5ndGggfHwgIW5vcm1hbGl6ZWRDYW5kaWRhdGUubGVuZ3RoKSByZXR1cm4gMDtcbiAgY29uc3QgZGlzdGFuY2UgPSBsZXZlbnNodGVpbihub3JtYWxpemVkU291cmNlLCBub3JtYWxpemVkQ2FuZGlkYXRlKTtcbiAgY29uc3QgbG9uZ2VzdCA9IE1hdGgubWF4KG5vcm1hbGl6ZWRTb3VyY2UubGVuZ3RoLCBub3JtYWxpemVkQ2FuZGlkYXRlLmxlbmd0aCk7XG4gIHJldHVybiAxIC0gZGlzdGFuY2UgLyBsb25nZXN0O1xufVxuXG4vKipcbiAqIEZ1enp5IG1hdGNoIGEgcmF3IGhvc3BpdGFsIG5hbWUgYWdhaW5zdCB0aGUgY3VyYXRlZCBsaXN0LlxuICovXG5leHBvcnQgZnVuY3Rpb24gbWF0Y2hIb3NwaXRhbE5hbWUocmF3OiBzdHJpbmcpOiB7IHZhbHVlOiBzdHJpbmcgfCBudWxsOyBzY29yZTogbnVtYmVyIH0ge1xuICBpZiAoIXJhdz8udHJpbSgpKSB7XG4gICAgcmV0dXJuIHsgdmFsdWU6IG51bGwsIHNjb3JlOiAwIH07XG4gIH1cblxuICBsZXQgYmVzdE1hdGNoOiB7IHZhbHVlOiBzdHJpbmcgfCBudWxsOyBzY29yZTogbnVtYmVyIH0gPSB7IHZhbHVlOiBudWxsLCBzY29yZTogMCB9O1xuXG4gIGZvciAoY29uc3QgaG9zcGl0YWwgb2YgSE9TUElUQUxfTkFNRVMpIHtcbiAgICBjb25zdCBzY29yZSA9IHNpbWlsYXJpdHlTY29yZShyYXcsIGhvc3BpdGFsKTtcbiAgICBpZiAoc2NvcmUgPiBiZXN0TWF0Y2guc2NvcmUpIHtcbiAgICAgIGJlc3RNYXRjaCA9IHsgdmFsdWU6IGhvc3BpdGFsLCBzY29yZSB9O1xuICAgIH1cbiAgfVxuXG4gIGlmIChiZXN0TWF0Y2guc2NvcmUgPCBNSU5fSE9TUElUQUxfU0NPUkUpIHtcbiAgICByZXR1cm4geyB2YWx1ZTogbnVsbCwgc2NvcmU6IGJlc3RNYXRjaC5zY29yZSB9O1xuICB9XG5cbiAgcmV0dXJuIGJlc3RNYXRjaDtcbn1cblxuLyoqXG4gKiBGdXp6eSBtYXRjaCBhIHJhdyB0cmVhdG1lbnQgbmFtZSBhZ2FpbnN0IHRoZSBjdXJhdGVkIGxpc3QuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtYXRjaFRyZWF0bWVudE5hbWUocmF3OiBzdHJpbmcpOiB7IHZhbHVlOiBzdHJpbmcgfCBudWxsOyBzY29yZTogbnVtYmVyIH0ge1xuICBpZiAoIXJhdz8udHJpbSgpKSB7XG4gICAgcmV0dXJuIHsgdmFsdWU6IG51bGwsIHNjb3JlOiAwIH07XG4gIH1cblxuICBsZXQgYmVzdE1hdGNoOiB7IHZhbHVlOiBzdHJpbmcgfCBudWxsOyBzY29yZTogbnVtYmVyIH0gPSB7IHZhbHVlOiBudWxsLCBzY29yZTogMCB9O1xuXG4gIGZvciAoY29uc3QgdHJlYXRtZW50IG9mIFRSRUFUTUVOVF9OQU1FUykge1xuICAgIGNvbnN0IHNjb3JlID0gc2ltaWxhcml0eVNjb3JlKHJhdywgdHJlYXRtZW50KTtcbiAgICBpZiAoc2NvcmUgPiBiZXN0TWF0Y2guc2NvcmUpIHtcbiAgICAgIGJlc3RNYXRjaCA9IHsgdmFsdWU6IHRyZWF0bWVudCwgc2NvcmUgfTtcbiAgICB9XG4gIH1cblxuICBpZiAoYmVzdE1hdGNoLnNjb3JlIDwgTUlOX1RSRUFUTUVOVF9TQ09SRSkge1xuICAgIHJldHVybiB7IHZhbHVlOiBudWxsLCBzY29yZTogYmVzdE1hdGNoLnNjb3JlIH07XG4gIH1cblxuICByZXR1cm4gYmVzdE1hdGNoO1xufVxuXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuLyogIENsaWVudC1zaWRlIHJvdyB2YWxpZGF0aW9uIChmb3IgdGhlIHRhYmxlIFVJKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvbnN0IFJFUVVJUkVEX0ZJRUxEUzogKGtleW9mIFBhY2thZ2VSb3cpW10gPSBbXG4gIFwidGl0bGVcIixcbiAgXCJob3NwaXRhbF9uYW1lXCIsXG4gIFwidHJlYXRtZW50X25hbWVcIixcbiAgXCJwcmljZVwiLFxuICBcImN1cnJlbmN5XCIsXG5dO1xuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVSb3cocm93OiBQYWNrYWdlUm93KTogUm93VmFsaWRhdGlvbiB7XG4gIGNvbnN0IGVycm9yczogVmFsaWRhdGlvbkVycm9yW10gPSBbXTtcblxuICAvLyBSZXF1aXJlZDogdGl0bGVcbiAgaWYgKCFyb3cudGl0bGU/LnRyaW0oKSkge1xuICAgIGVycm9ycy5wdXNoKHsgZmllbGQ6IFwidGl0bGVcIiwgbWVzc2FnZTogXCJUaXRsZSBpcyByZXF1aXJlZFwiIH0pO1xuICB9XG5cbiAgLy8gUmVxdWlyZWQ6IGhvc3BpdGFsX25hbWVcbiAgaWYgKCFyb3cuaG9zcGl0YWxfbmFtZT8udHJpbSgpKSB7XG4gICAgZXJyb3JzLnB1c2goeyBmaWVsZDogXCJob3NwaXRhbF9uYW1lXCIsIG1lc3NhZ2U6IFwiSG9zcGl0YWwgbmFtZSBpcyByZXF1aXJlZFwiIH0pO1xuICB9XG5cbiAgLy8gUmVxdWlyZWQ6IHRyZWF0bWVudF9uYW1lXG4gIGlmICghcm93LnRyZWF0bWVudF9uYW1lPy50cmltKCkpIHtcbiAgICBlcnJvcnMucHVzaCh7IGZpZWxkOiBcInRyZWF0bWVudF9uYW1lXCIsIG1lc3NhZ2U6IFwiVHJlYXRtZW50IG5hbWUgaXMgcmVxdWlyZWRcIiB9KTtcbiAgfVxuXG4gIC8vIFJlcXVpcmVkOiBwcmljZVxuICBpZiAocm93LnByaWNlID09PSBudWxsIHx8IHJvdy5wcmljZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgZXJyb3JzLnB1c2goeyBmaWVsZDogXCJwcmljZVwiLCBtZXNzYWdlOiBcIlByaWNlIGlzIHJlcXVpcmVkXCIgfSk7XG4gIH0gZWxzZSBpZiAoaXNOYU4oTnVtYmVyKHJvdy5wcmljZSkpIHx8IE51bWJlcihyb3cucHJpY2UpIDwgMCkge1xuICAgIGVycm9ycy5wdXNoKHtcbiAgICAgIGZpZWxkOiBcInByaWNlXCIsXG4gICAgICBtZXNzYWdlOiBcIlByaWNlIG11c3QgYmUgYSB2YWxpZCBwb3NpdGl2ZSBudW1iZXJcIixcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFJlcXVpcmVkOiBjdXJyZW5jeVxuICBpZiAoIXJvdy5jdXJyZW5jeT8udHJpbSgpKSB7XG4gICAgZXJyb3JzLnB1c2goeyBmaWVsZDogXCJjdXJyZW5jeVwiLCBtZXNzYWdlOiBcIkN1cnJlbmN5IGlzIHJlcXVpcmVkXCIgfSk7XG4gIH1cblxuICAvLyBPcHRpb25hbDogY29tbWlzc2lvbiAw4oCTMTAwXG4gIGlmIChyb3cuY29tbWlzc2lvbiAhPT0gbnVsbCAmJiByb3cuY29tbWlzc2lvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgY29uc3QgbnVtID0gTnVtYmVyKHJvdy5jb21taXNzaW9uKTtcbiAgICBpZiAoaXNOYU4obnVtKSB8fCBudW0gPCAwIHx8IG51bSA+IDEwMCkge1xuICAgICAgZXJyb3JzLnB1c2goe1xuICAgICAgICBmaWVsZDogXCJjb21taXNzaW9uXCIsXG4gICAgICAgIG1lc3NhZ2U6IFwiQ29tbWlzc2lvbiBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTAwXCIsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvLyBPcHRpb25hbDogb3JpZ2luYWxfcHJpY2UgPj0gMFxuICBpZiAocm93Lm9yaWdpbmFsX3ByaWNlICE9PSBudWxsICYmIHJvdy5vcmlnaW5hbF9wcmljZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgY29uc3QgbnVtID0gTnVtYmVyKHJvdy5vcmlnaW5hbF9wcmljZSk7XG4gICAgaWYgKGlzTmFOKG51bSkgfHwgbnVtIDwgMCkge1xuICAgICAgZXJyb3JzLnB1c2goe1xuICAgICAgICBmaWVsZDogXCJvcmlnaW5hbF9wcmljZVwiLFxuICAgICAgICBtZXNzYWdlOiBcIk9yaWdpbmFsIHByaWNlIG11c3QgYmUgYSB2YWxpZCBwb3NpdGl2ZSBudW1iZXJcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgcm93SWQ6IHJvdy5pZCB8fCBcIlwiLFxuICAgIGlzVmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsXG4gICAgZXJyb3JzLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVBbGxSb3dzKHJvd3M6IFBhY2thZ2VSb3dbXSk6IHtcbiAgdmFsaWRhdGlvbnM6IE1hcDxzdHJpbmcsIFJvd1ZhbGlkYXRpb24+O1xuICBzdW1tYXJ5OiB7IHZhbGlkOiBudW1iZXI7IGludmFsaWQ6IG51bWJlcjsgd2l0aFdhcm5pbmdzOiBudW1iZXIgfTtcbn0ge1xuICBjb25zdCB2YWxpZGF0aW9ucyA9IG5ldyBNYXA8c3RyaW5nLCBSb3dWYWxpZGF0aW9uPigpO1xuICBsZXQgdmFsaWQgPSAwO1xuICBsZXQgaW52YWxpZCA9IDA7XG4gIGxldCB3aXRoV2FybmluZ3MgPSAwO1xuXG4gIHJvd3MuZm9yRWFjaCgocm93LCBpbmRleCkgPT4ge1xuICAgIC8vIEdlbmVyYXRlIGEgc3RhYmxlIHJvdyBrZXkgZXZlbiBpZiBiYWNrZW5kIGRpZCBub3Qgc2VuZCBhbiBpZFxuICAgIGNvbnN0IHJvd0lkID0gcm93LmlkID8/IGByb3dfJHtpbmRleH1gO1xuXG4gICAgLy8gUnVuIHZhbGlkYXRpb24gb24gdGhlIHJvdzsgUm93VmFsaWRhdGlvbi5yb3dJZCB3aWxsIGJlIG92ZXJ3cml0dGVuIGJlbG93XG4gICAgY29uc3QgYmFzZVZhbGlkYXRpb24gPSB2YWxpZGF0ZVJvdyhyb3cpO1xuXG4gICAgY29uc3QgdmFsaWRhdGlvbjogUm93VmFsaWRhdGlvbiA9IHtcbiAgICAgIC4uLmJhc2VWYWxpZGF0aW9uLFxuICAgICAgcm93SWQsXG4gICAgfTtcblxuICAgIHZhbGlkYXRpb25zLnNldChyb3dJZCwgdmFsaWRhdGlvbik7XG5cbiAgICBpZiAodmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICB2YWxpZCsrO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbnZhbGlkKys7XG4gICAgfVxuXG4gICAgaWYgKHJvdy5fbWV0YT8ud2FybmluZ3MgJiYgcm93Ll9tZXRhLndhcm5pbmdzLmxlbmd0aCA+IDApIHtcbiAgICAgIHdpdGhXYXJuaW5ncysrO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICB2YWxpZGF0aW9ucyxcbiAgICBzdW1tYXJ5OiB7IHZhbGlkLCBpbnZhbGlkLCB3aXRoV2FybmluZ3MgfSxcbiAgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWVsZEVycm9yKFxuICB2YWxpZGF0aW9uczogTWFwPHN0cmluZywgUm93VmFsaWRhdGlvbj4sXG4gIHJvd0lkOiBzdHJpbmcsXG4gIGZpZWxkOiBzdHJpbmcsXG4pOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICBjb25zdCByb3dWYWxpZGF0aW9uID0gdmFsaWRhdGlvbnMuZ2V0KHJvd0lkKTtcbiAgaWYgKCFyb3dWYWxpZGF0aW9uKSByZXR1cm4gdW5kZWZpbmVkO1xuICBjb25zdCBlcnJvciA9IHJvd1ZhbGlkYXRpb24uZXJyb3JzLmZpbmQoKGUpID0+IGUuZmllbGQgPT09IGZpZWxkKTtcbiAgcmV0dXJuIGVycm9yPy5tZXNzYWdlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNGaWVsZEludmFsaWQoXG4gIHZhbGlkYXRpb25zOiBNYXA8c3RyaW5nLCBSb3dWYWxpZGF0aW9uPixcbiAgcm93SWQ6IHN0cmluZyxcbiAgZmllbGQ6IHN0cmluZyxcbik6IGJvb2xlYW4ge1xuICByZXR1cm4gISFnZXRGaWVsZEVycm9yKHZhbGlkYXRpb25zLCByb3dJZCwgZmllbGQpO1xufVxuIl0sIm5hbWVzIjpbIkhPU1BJVEFMX05BTUVTIiwiVFJFQVRNRU5UX05BTUVTIiwiTUlOX0hPU1BJVEFMX1NDT1JFIiwiTUlOX1RSRUFUTUVOVF9TQ09SRSIsIm1hdGNoaW5nUmVmZXJlbmNlRGF0YSIsImhvc3BpdGFscyIsInRyZWF0bWVudHMiLCJub3JtYWxpemUiLCJ2YWx1ZSIsInRvTG93ZXJDYXNlIiwicmVwbGFjZSIsInRyaW0iLCJsZXZlbnNodGVpbiIsImEiLCJiIiwibGVuZ3RoIiwibWF0cml4IiwiQXJyYXkiLCJmcm9tIiwiXyIsImkiLCJqIiwiTWF0aCIsIm1pbiIsInNpbWlsYXJpdHlTY29yZSIsInNvdXJjZSIsImNhbmRpZGF0ZSIsIm5vcm1hbGl6ZWRTb3VyY2UiLCJub3JtYWxpemVkQ2FuZGlkYXRlIiwiZGlzdGFuY2UiLCJsb25nZXN0IiwibWF4IiwibWF0Y2hIb3NwaXRhbE5hbWUiLCJyYXciLCJzY29yZSIsImJlc3RNYXRjaCIsImhvc3BpdGFsIiwibWF0Y2hUcmVhdG1lbnROYW1lIiwidHJlYXRtZW50IiwiUkVRVUlSRURfRklFTERTIiwidmFsaWRhdGVSb3ciLCJyb3ciLCJlcnJvcnMiLCJ0aXRsZSIsInB1c2giLCJmaWVsZCIsIm1lc3NhZ2UiLCJob3NwaXRhbF9uYW1lIiwidHJlYXRtZW50X25hbWUiLCJwcmljZSIsInVuZGVmaW5lZCIsImlzTmFOIiwiTnVtYmVyIiwiY3VycmVuY3kiLCJjb21taXNzaW9uIiwibnVtIiwib3JpZ2luYWxfcHJpY2UiLCJyb3dJZCIsImlkIiwiaXNWYWxpZCIsInZhbGlkYXRlQWxsUm93cyIsInJvd3MiLCJ2YWxpZGF0aW9ucyIsIk1hcCIsInZhbGlkIiwiaW52YWxpZCIsIndpdGhXYXJuaW5ncyIsImZvckVhY2giLCJpbmRleCIsImJhc2VWYWxpZGF0aW9uIiwidmFsaWRhdGlvbiIsInNldCIsIl9tZXRhIiwid2FybmluZ3MiLCJzdW1tYXJ5IiwiZ2V0RmllbGRFcnJvciIsInJvd1ZhbGlkYXRpb24iLCJnZXQiLCJlcnJvciIsImZpbmQiLCJlIiwiaXNGaWVsZEludmFsaWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/validation.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/aiExtractor.ts":
/*!*************************************!*\
  !*** ./src/services/aiExtractor.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   extractPackagesFromOcrText: () => (/* binding */ extractPackagesFromOcrText)\n/* harmony export */ });\n/* harmony import */ var _bedrockClient__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./bedrockClient */ \"(rsc)/./src/services/bedrockClient.ts\");\n/* harmony import */ var _normalizer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./normalizer */ \"(rsc)/./src/services/normalizer.ts\");\n// src/services/aiExtractor.ts\n\n\n/**\r\n * extractPackagesFromOcrText\r\n * --------------------------\r\n * Groups OCR pages per file, calls Bedrock once per file, and merges\r\n * all packages. This avoids one huge prompt across multiple files.\r\n */ async function extractPackagesFromOcrText(ocrPages) {\n    if (!ocrPages.length) {\n        return [];\n    }\n    // Group pages by fileId so each Bedrock call only sees one menu/file\n    const pagesByFile = new Map();\n    for (const page of ocrPages){\n        if (!pagesByFile.has(page.fileId)) {\n            pagesByFile.set(page.fileId, []);\n        }\n        pagesByFile.get(page.fileId).push(page);\n    }\n    const allPackages = [];\n    for (const [fileId, pages] of pagesByFile.entries()){\n        // sort pages for that file\n        const orderedPages = [\n            ...pages\n        ].sort((a, b)=>a.pageNumber - b.pageNumber);\n        const prompt = buildPromptForSingleFile(orderedPages);\n        logPromptStats(fileId, prompt);\n        const rawResponse = await (0,_bedrockClient__WEBPACK_IMPORTED_MODULE_0__.callBedrockForExtraction)(prompt, {\n            maxTokens: 6000,\n            temperature: 0.1\n        });\n        const cleaned = sanitizeModelResponse(rawResponse);\n        let parsed;\n        try {\n            parsed = JSON.parse(cleaned || \"{}\");\n        } catch (err) {\n            console.error(\"[Bedrock OCR] Non-JSON output preview:\", rawResponse.slice(0, 500));\n            console.error(\"[Bedrock OCR] Cleaned preview:\", cleaned.slice(0, 500));\n            throw new Error(\"Bedrock returned invalid JSON for OCR extraction.\");\n        }\n        const packages = Array.isArray(parsed?.packages) ? parsed.packages : [];\n        const fileName = orderedPages[0]?.fileName ?? \"unknown-file\";\n        const normalizedForFile = packages.map((row, index)=>{\n            const normalized = (0,_normalizer__WEBPACK_IMPORTED_MODULE_1__.normalizePackageRow)(row);\n            // Ensure _meta exists and has at least source_file/source_page\n            const safeMeta = {\n                ...normalized._meta || {},\n                source_file: normalized._meta?.source_file || fileName\n            };\n            return {\n                ...normalized,\n                id: normalized.id || `pkg_${fileId}_${index}_${Date.now()}`,\n                _meta: safeMeta\n            };\n        });\n        allPackages.push(...normalizedForFile);\n    }\n    return allPackages;\n}\n/**\r\n * buildPromptForSingleFile\r\n * ------------------------\r\n * Build a prompt for ONE file only (may still be multi-page).\r\n */ function buildPromptForSingleFile(pages) {\n    const ordered = [\n        ...pages\n    ].sort((a, b)=>a.pageNumber - b.pageNumber);\n    const mainFileName = ordered[0]?.fileName ?? \"Unknown file\";\n    const joinedPages = ordered.map((page)=>`--- PAGE ${page.pageNumber} (${page.fileName}) ---\\n${page.rawText}\\n`).join(\"\\n\");\n    return `\r\nYou are a backend extraction worker. Convert clinic menu OCR text into structured JSON for bulk CSV upload.\r\n\r\nIMPORTANT: This is a **tool call**, not a chat.  \r\n- Do NOT ask questions.  \r\n- Do NOT explain your reasoning.  \r\n- Do NOT comment on missing pages or placeholders.  \r\n- **Return ONLY a single JSON object** as described below.\r\n\r\nFILE CONTEXT\r\n------------\r\n- FILE NAME: \"${mainFileName}\"\r\n- TOTAL PAGES: ${ordered.length}\r\n\r\nSome pages may be empty or have weak OCR; just skip non-usable text without commenting on it.\r\n\r\nGLOBAL EXTRACTION RULES\r\n-----------------------\r\n1. Scan ALL pages and ALL lines that contain text.\r\n2. **EVERY clearly priced item is a separate package**, even inside sections like:\r\n   - IV drips (e.g. \"Signature Drip\", \"Express IV Drips\", \"Premium IV Drips\")\r\n   - Vitamin drips / injections\r\n   - Session-based services (Compression Therapy, Red Light Therapy, Hyperbaric Oxygen Therapy, Infrared Sauna, etc.)\r\n3. A line/block is a package if it has:\r\n   - a name/title, AND\r\n   - a price (e.g. \"Â£100\", \"Â£25\", \"RM 1,500\").\r\n4. Section headings with NO price are NOT packages.\r\n5. Do NOT ignore non-English or bilingual lines; Chinese/Thai-only packages are still valid.\r\n6. If you are unsure whether something is a package, **prefer to include it** with low confidence instead of silently dropping it.\r\n\r\nDENSE MENUS\r\n----------------\r\nFor dense text like:\r\n\r\n  Signature Drip ... Â£450\r\n  Limitless Drip ... Â£850\r\n  Hydration Drip Â£100 Sodium Chloride + Bicarbonate + ...\r\n  MultiVit Drip Â£125 Basic Hydration + B Complex + 2g Vitamin C\r\n  ...\r\n\r\nYou must:\r\n- Treat each **\"name ... Â£price\"** as its own package.\r\n- Use price tokens (Â£100, Â£125, Â£150, Â£175, Â£200, Â£225, Â£450, Â£850, etc.) as strong boundaries between packages.\r\n- Use the text immediately around the name as:\r\n  - title       â†’ main package name (e.g. \"Hydration Drip\", \"Energy Drip (Myers Cocktail)\")\r\n  - description/details/includes â†’ compositions, ingredients, or extra info.\r\n\r\nSERVICE + SESSION BUNDLES\r\n-------------------------\r\nFor bundles like:\r\n\r\n  Compression Therapy ...\r\n  Intro Session (first time only) Â£10\r\n  1 Session Â£25\r\n  5 Sessions Â£110\r\n  10 Sessions Â£190\r\n\r\n  Red Light Therapy from Â£55\r\n  1 x Session Â£55\r\n  5 x Sessions Â£220\r\n  ...\r\n\r\nYou must:\r\n- Create a separate package for each **session + price** line.\r\n  Example titles:\r\n  - \"Compression Therapy â€“ Intro Session (20 min)\"\r\n  - \"Compression Therapy â€“ 5 Sessions\"\r\n  - \"Red Light Therapy â€“ 10 Sessions\"\r\n  - \"Hyperbaric Oxygen Therapy â€“ 60 Minute 5 Sessions\"\r\n- Put exact prices into \\`price\\`.\r\n- Put durations like \"20 mins\", \"60 mins\" into \\`duration\\` when clear.\r\n- If duration is ambiguous, still emit the package, but lower \\`_meta.confidence_score\\` and add a warning.\r\n\r\nLOW-CONFIDENCE / AMBIGUOUS ITEMS\r\n--------------------------------\r\nIf text likely represents a purchasable drip, injection, session, or add-on but the boundaries are fuzzy:\r\n\r\n- STILL create a package.\r\n- Set \\`_meta.confidence_score\\` to a low value (e.g. 0.3â€“0.6).\r\n- Add warnings such as:\r\n  - \"Low confidence segmentation: package boundaries may be incorrect\"\r\n  - \"Title and description may be mixed from neighbouring items\"\r\n  - \"Price attached with low confidence\"\r\n\r\nOnly ignore obvious non-package text: disclaimers, general marketing copy, headings with no price, etc.\r\n\r\nOUTPUT FORMAT (STRICT)\r\n----------------------\r\nReturn **only** a single JSON object with this exact shape (no markdown, no comments):\r\n\r\n{\r\n  \"packages\": [ { ... }, ... ]\r\n}\r\n\r\nEach package object MUST include ALL of the following keys:\r\n\r\n- title: string\r\n- description: string\r\n- details: string\r\n- hospital_name: string\r\n- treatment_name: string\r\n- sub_treatments: string\r\n- price: number | null\r\n- original_price: number | null\r\n- currency: \"USD\" | \"THB\" | \"EUR\" | \"GBP\" | \"SGD\" | \"MYR\" | \"KRW\" | \"CNY\"\r\n- duration: string\r\n- treatment_category: string\r\n- anaesthesia: string\r\n- commission: number | null\r\n- featured: boolean\r\n- status: \"active\" | \"inactive\"\r\n- doctor_name: string\r\n- is_le_package: boolean\r\n- includes: string\r\n- image_file_id: string | null\r\n- hospital_location: string\r\n- category: string\r\n- hospital_country: string\r\n- translation_title: string\r\n- translation_description: string\r\n- translation_details: string\r\n- translation: string\r\n- _meta: {\r\n    source_file: string,\r\n    source_page: number,\r\n    confidence_score: number,\r\n    warnings: string[]\r\n  }\r\n\r\nDEFAULTS WHEN UNKNOWN\r\n---------------------\r\nIf any value is unknown or not present in the OCR text:\r\n- Use \"\" for strings.\r\n- Use null for numeric fields (price, original_price, commission).\r\n- Use false for booleans (featured, is_le_package) unless clearly true.\r\n- Use \"active\" for status if unclear.\r\n- _meta.source_file = the file name for that page.\r\n- _meta.source_page = the page number.\r\n- _meta.confidence_score between 0.0 and 1.0 (your best guess).\r\n\r\nLANGUAGE & TRANSLATION\r\n----------------------\r\n- If the package text is already in ENGLISH:\r\n  - Keep title/description/details in English.\r\n  - translation_title / translation_description / translation_details = \"\".\r\n  - translation = \"\" or \"EN\".\r\n- If the package text is NOT English (e.g. Chinese, Thai):\r\n  - Keep the original language in title/description/details.\r\n  - Provide ENGLISH translations:\r\n    - translation_title: title â†’ ENGLISH\r\n    - translation_description: description â†’ ENGLISH\r\n    - translation_details: details â†’ ENGLISH\r\n  - translation = short language code, e.g. \"ZH\", \"TH->ZH\".\r\n- If the text is unreadable:\r\n  - leave translation_* = \"\"\r\n  - add a warning like \"OCR text unreadable for this package\".\r\n\r\nCANONICAL TREATMENT NAMES\r\n-------------------------\r\nWhen you infer or normalize treatment_name, you MUST prefer the following\r\ncanonical names whenever they clearly match the menu context. Use these exact\r\nstrings (including capitalization and spacing) where appropriate:\r\n\r\nDiagnostics:\r\n- \"Health Checkup\"\r\n- \"Cancer Screening\"\r\n- \"MRI Scan\"\r\n- \"CT Scan\"\r\n- \"PET-CT Scan\"\r\n- \"Blood Test\"\r\n- \"Cardiac Screening\"\r\n\r\nSurgery:\r\n- \"Hip & Knee Replacement\"\r\n- \"Spinal Surgery\"\r\n- \"Brain Tumor Surgery\"\r\n- \"Heart Valve Repair\"\r\n- \"Kidney Transplant\"\r\n- \"Liver Transplant\"\r\n- \"LASIK Surgery\"\r\n- \"Cataract Surgery\"\r\n- \"Glaucoma Surgery\"\r\n- \"Gastric Sleeve\"\r\n- \"Gastric Bypass\"\r\n- \"Endoscopic Sleeve Gastroplasty\"\r\n- \"Gender-Affirming Surgery\"\r\n- \"Pacemaker Implantation\"\r\n- \"Prostate Surgery\"\r\n- \"Vasectomy Reversal\"\r\n- \"Hysterectomy\"\r\n- \"Fibroid Removal\"\r\n- \"Corneal Transplant\"\r\n- \"Deep Brain Stimulation (DBS)\"\r\n- \"Epilepsy Surgery\"\r\n- \"Spinal Cord Surgery\"\r\n\r\nCosmetic & Plastic Surgery:\r\n- \"Facial Plastic Surgery\"\r\n- \"Breast Augmentation\"\r\n- \"Rhinoplasty\"\r\n- \"Liposuction\"\r\n- \"Botox Treatment\"\r\n- \"Dermal Fillers\"\r\n- \"Hair Transplant\"\r\n- \"Laser Resurfacing\"\r\n- \"Buccal Fat Removal\"\r\n- \"Chin Augmentation\"\r\n- \"Teeth Whitening\"\r\n- \"Veneer\"\r\n\r\nTreatment:\r\n- \"Dental Implants\"\r\n- \"Root Canal\"\r\n- \"IVF (In Vitro Fertilization)\"\r\n- \"IUI (Intrauterine Insemination)\"\r\n- \"Egg Freezing\"\r\n- \"HRT (Hormone Replacement Therapy)\"\r\n\r\nOncology:\r\n- \"Chemotherapy\"\r\n- \"Radiation Therapy\"\r\n- \"Immunotherapy\"\r\n- \"Proton Therapy\"\r\n\r\nWellness:\r\n- \"Detox Retreats\"\r\n- \"IV Therapy\"\r\n- \"Anti-Aging Therapy\"\r\n- \"Physiotherapy\"\r\n\r\nTraditional Medicine:\r\n- \"Acupuncture\"\r\n- \"Ayurveda\"\r\n- \"Thai Massage\"\r\n\r\nRules:\r\n- If a menu item clearly matches one of the above, set treatment_name to that exact string.\r\n- If no canonical name fits, use the closest treatment_name match.\r\n\r\nFIELD MAPPING HINTS\r\n-------------------\r\n- Each distinct line or block with a price (e.g. \"Hydration Drip Â£100\") is its own package.\r\n- Use the local price symbol or context to infer currency, e.g.:\r\n    - \"Â£\" â†’ GBP\r\n    - \"RM\" â†’ MYR\r\n    - \"à¸¿\" â†’ THB\r\n    - \"S$\" â†’ SGD\r\n    - \"$\" with US context â†’ USD\r\n- treatment_name: use a canonical name from the list above whenever possible.\r\n- sub_treatments: comma-separated sub-focuses (e.g. \"Hydration,Skin Rejuvenation\").\r\n- includes: formatted inclusions like \"Consultation,Drip,Follow Up\".\r\n\r\n_Example warnings in _meta.warnings_:\r\n- \"Hospital not recognized: â€¦\"\r\n- \"Treatment not recognized: â€¦\"\r\n- \"Missing price for package â€¦\"\r\n- \"Currency not recognized\"\r\n- \"Low confidence segmentation: package boundaries may be incorrect\"\r\n\r\nRemember: **Do not output anything except the JSON object**.\r\n\r\nOCR TEXT (THIS FILE ONLY, BY PAGE)\r\n----------------------------------\r\n${joinedPages}\r\n`;\n}\n/**\r\n * sanitizeModelResponse\r\n * ---------------------\r\n * 1. Strips obvious markdown fences (``` / ```json).\r\n * 2. Trims leading/trailing noise outside the FIRST '{' and LAST '}'.\r\n */ function sanitizeModelResponse(value) {\n    if (!value) return \"\";\n    let cleaned = value.trim();\n    // Strip common markdown fences like ```json ... ```\n    cleaned = cleaned.replace(/^```json\\s*/i, \"\").replace(/^```\\s*/i, \"\").replace(/```$/i, \"\").trim();\n    // If it already looks like JSON (starts with { or [ and ends with } or ])\n    // just return it as-is.\n    if (/^[\\[{]/.test(cleaned) && /[\\]}]$/.test(cleaned)) {\n        return cleaned;\n    }\n    // Fallback: grab from first '{' or '[' to last '}' or ']'\n    const firstCurly = cleaned.indexOf(\"{\");\n    const lastCurly = cleaned.lastIndexOf(\"}\");\n    const firstSquare = cleaned.indexOf(\"[\");\n    const lastSquare = cleaned.lastIndexOf(\"]\");\n    const starts = [\n        firstCurly,\n        firstSquare\n    ].filter((i)=>i !== -1);\n    const ends = [\n        lastCurly,\n        lastSquare\n    ].filter((i)=>i !== -1);\n    if (!starts.length || !ends.length) {\n        // Nothing better to do â€“ return as-is and let JSON.parse throw for logging\n        return cleaned;\n    }\n    const start = Math.min(...starts);\n    const end = Math.max(...ends);\n    return cleaned.slice(start, end + 1).trim();\n}\n/**\r\n * logPromptStats\r\n * --------------\r\n * Light logging so you can see if youâ€™re hitting silly prompt sizes.\r\n */ function logPromptStats(fileId, prompt) {\n    const charCount = prompt.length;\n    const approxTokens = Math.round(charCount / 4); // rough-ish\n    console.log(`[Bedrock OCR] Prompt for file ${fileId}: ${charCount} chars (~${approxTokens} tokens)`);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFXRztLQUFXLENBQUNFLE1BQU0sQ0FBQyxDQUFDQyxJQUFNQSxNQUFNLENBQUM7SUFFMUQsSUFBSSxDQUFDRixPQUFPL0QsTUFBTSxJQUFJLENBQUNrRSxLQUFLbEUsTUFBTSxFQUFFO1FBQ2xDLDJFQUEyRTtRQUMzRSxPQUFPdUI7SUFDVDtJQUVBLE1BQU00QyxRQUFRQyxLQUFLQyxHQUFHLElBQUlOO0lBQzFCLE1BQU1PLE1BQU1GLEtBQUtHLEdBQUcsSUFBSUw7SUFFeEIsT0FBTzNDLFFBQVFRLEtBQUssQ0FBQ29DLE9BQU9HLE1BQU0sR0FBR2hCLElBQUk7QUFDM0M7QUFFQTs7OztDQUlDLEdBQ0QsU0FBU25DLGVBQWVkLE1BQWMsRUFBRVksTUFBYztJQUNwRCxNQUFNdUQsWUFBWXZELE9BQU9qQixNQUFNO0lBQy9CLE1BQU15RSxlQUFlTCxLQUFLTSxLQUFLLENBQUNGLFlBQVksSUFBSSxZQUFZO0lBQzVEM0MsUUFBUThDLEdBQUcsQ0FDVCxDQUFDLDhCQUE4QixFQUFFdEUsT0FBTyxFQUFFLEVBQUVtRSxVQUFVLFNBQVMsRUFBRUMsYUFBYSxRQUFRLENBQUM7QUFFM0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9sZW1lZGljYS1jbGluaWMtb2NyLy4vc3JjL3NlcnZpY2VzL2FpRXh0cmFjdG9yLnRzP2ZmNjAiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZpY2VzL2FpRXh0cmFjdG9yLnRzXHJcbmltcG9ydCB0eXBlIHsgUGFja2FnZVJvdywgT2NyUGFnZSB9IGZyb20gXCJAL2xpYi90eXBlcy9vY3JcIjtcclxuaW1wb3J0IHsgY2FsbEJlZHJvY2tGb3JFeHRyYWN0aW9uIH0gZnJvbSBcIi4vYmVkcm9ja0NsaWVudFwiO1xyXG5pbXBvcnQgeyBub3JtYWxpemVQYWNrYWdlUm93IH0gZnJvbSBcIi4vbm9ybWFsaXplclwiO1xyXG5cclxuLyoqXHJcbiAqIGV4dHJhY3RQYWNrYWdlc0Zyb21PY3JUZXh0XHJcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAqIEdyb3VwcyBPQ1IgcGFnZXMgcGVyIGZpbGUsIGNhbGxzIEJlZHJvY2sgb25jZSBwZXIgZmlsZSwgYW5kIG1lcmdlc1xyXG4gKiBhbGwgcGFja2FnZXMuIFRoaXMgYXZvaWRzIG9uZSBodWdlIHByb21wdCBhY3Jvc3MgbXVsdGlwbGUgZmlsZXMuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXh0cmFjdFBhY2thZ2VzRnJvbU9jclRleHQoXHJcbiAgb2NyUGFnZXM6IE9jclBhZ2VbXVxyXG4pOiBQcm9taXNlPFBhY2thZ2VSb3dbXT4ge1xyXG4gIGlmICghb2NyUGFnZXMubGVuZ3RoKSB7XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG5cclxuICAvLyBHcm91cCBwYWdlcyBieSBmaWxlSWQgc28gZWFjaCBCZWRyb2NrIGNhbGwgb25seSBzZWVzIG9uZSBtZW51L2ZpbGVcclxuICBjb25zdCBwYWdlc0J5RmlsZSA9IG5ldyBNYXA8c3RyaW5nLCBPY3JQYWdlW10+KCk7XHJcbiAgZm9yIChjb25zdCBwYWdlIG9mIG9jclBhZ2VzKSB7XHJcbiAgICBpZiAoIXBhZ2VzQnlGaWxlLmhhcyhwYWdlLmZpbGVJZCkpIHtcclxuICAgICAgcGFnZXNCeUZpbGUuc2V0KHBhZ2UuZmlsZUlkLCBbXSk7XHJcbiAgICB9XHJcbiAgICBwYWdlc0J5RmlsZS5nZXQocGFnZS5maWxlSWQpIS5wdXNoKHBhZ2UpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgYWxsUGFja2FnZXM6IFBhY2thZ2VSb3dbXSA9IFtdO1xyXG5cclxuICBmb3IgKGNvbnN0IFtmaWxlSWQsIHBhZ2VzXSBvZiBwYWdlc0J5RmlsZS5lbnRyaWVzKCkpIHtcclxuICAgIC8vIHNvcnQgcGFnZXMgZm9yIHRoYXQgZmlsZVxyXG4gICAgY29uc3Qgb3JkZXJlZFBhZ2VzID0gWy4uLnBhZ2VzXS5zb3J0KChhLCBiKSA9PiBhLnBhZ2VOdW1iZXIgLSBiLnBhZ2VOdW1iZXIpO1xyXG5cclxuICAgIGNvbnN0IHByb21wdCA9IGJ1aWxkUHJvbXB0Rm9yU2luZ2xlRmlsZShvcmRlcmVkUGFnZXMpO1xyXG4gICAgbG9nUHJvbXB0U3RhdHMoZmlsZUlkLCBwcm9tcHQpO1xyXG5cclxuICAgIGNvbnN0IHJhd1Jlc3BvbnNlID0gYXdhaXQgY2FsbEJlZHJvY2tGb3JFeHRyYWN0aW9uKHByb21wdCwge1xyXG4gICAgICBtYXhUb2tlbnM6IDYwMDAsXHJcbiAgICAgIHRlbXBlcmF0dXJlOiAwLjEsXHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBjbGVhbmVkID0gc2FuaXRpemVNb2RlbFJlc3BvbnNlKHJhd1Jlc3BvbnNlKTtcclxuXHJcbiAgICBsZXQgcGFyc2VkOiBhbnk7XHJcbiAgICB0cnkge1xyXG4gICAgICBwYXJzZWQgPSBKU09OLnBhcnNlKGNsZWFuZWQgfHwgXCJ7fVwiKTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiW0JlZHJvY2sgT0NSXSBOb24tSlNPTiBvdXRwdXQgcHJldmlldzpcIiwgcmF3UmVzcG9uc2Uuc2xpY2UoMCwgNTAwKSk7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbQmVkcm9jayBPQ1JdIENsZWFuZWQgcHJldmlldzpcIiwgY2xlYW5lZC5zbGljZSgwLCA1MDApKTtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQmVkcm9jayByZXR1cm5lZCBpbnZhbGlkIEpTT04gZm9yIE9DUiBleHRyYWN0aW9uLlwiKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwYWNrYWdlczogYW55W10gPSBBcnJheS5pc0FycmF5KHBhcnNlZD8ucGFja2FnZXMpID8gcGFyc2VkLnBhY2thZ2VzIDogW107XHJcblxyXG4gICAgY29uc3QgZmlsZU5hbWUgPSBvcmRlcmVkUGFnZXNbMF0/LmZpbGVOYW1lID8/IFwidW5rbm93bi1maWxlXCI7XHJcblxyXG4gICAgY29uc3Qgbm9ybWFsaXplZEZvckZpbGUgPSBwYWNrYWdlcy5tYXAoKHJvdywgaW5kZXgpID0+IHtcclxuICAgICAgY29uc3Qgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZVBhY2thZ2VSb3cocm93KTtcclxuXHJcbiAgICAgIC8vIEVuc3VyZSBfbWV0YSBleGlzdHMgYW5kIGhhcyBhdCBsZWFzdCBzb3VyY2VfZmlsZS9zb3VyY2VfcGFnZVxyXG4gICAgICBjb25zdCBzYWZlTWV0YSA9IHtcclxuICAgICAgICAuLi4obm9ybWFsaXplZC5fbWV0YSB8fCB7fSksXHJcbiAgICAgICAgc291cmNlX2ZpbGU6IG5vcm1hbGl6ZWQuX21ldGE/LnNvdXJjZV9maWxlIHx8IGZpbGVOYW1lLFxyXG4gICAgICAgIC8vIGRvbid0IGd1ZXNzIHBhZ2UsIGJ1dCBpZiBtb2RlbCBkaWRuJ3Qgc2V0IGl0IHdlIGxlYXZlIGl0IHVuZGVmaW5lZFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAuLi5ub3JtYWxpemVkLFxyXG4gICAgICAgIGlkOiBub3JtYWxpemVkLmlkIHx8IGBwa2dfJHtmaWxlSWR9XyR7aW5kZXh9XyR7RGF0ZS5ub3coKX1gLFxyXG4gICAgICAgIF9tZXRhOiBzYWZlTWV0YSxcclxuICAgICAgfSBhcyBQYWNrYWdlUm93O1xyXG4gICAgfSk7XHJcblxyXG4gICAgYWxsUGFja2FnZXMucHVzaCguLi5ub3JtYWxpemVkRm9yRmlsZSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gYWxsUGFja2FnZXM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBidWlsZFByb21wdEZvclNpbmdsZUZpbGVcclxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAqIEJ1aWxkIGEgcHJvbXB0IGZvciBPTkUgZmlsZSBvbmx5IChtYXkgc3RpbGwgYmUgbXVsdGktcGFnZSkuXHJcbiAqL1xyXG5mdW5jdGlvbiBidWlsZFByb21wdEZvclNpbmdsZUZpbGUocGFnZXM6IE9jclBhZ2VbXSk6IHN0cmluZyB7XHJcbiAgY29uc3Qgb3JkZXJlZCA9IFsuLi5wYWdlc10uc29ydCgoYSwgYikgPT4gYS5wYWdlTnVtYmVyIC0gYi5wYWdlTnVtYmVyKTtcclxuICBjb25zdCBtYWluRmlsZU5hbWUgPSBvcmRlcmVkWzBdPy5maWxlTmFtZSA/PyBcIlVua25vd24gZmlsZVwiO1xyXG5cclxuICBjb25zdCBqb2luZWRQYWdlcyA9IG9yZGVyZWRcclxuICAgIC5tYXAoXHJcbiAgICAgIChwYWdlKSA9PlxyXG4gICAgICAgIGAtLS0gUEFHRSAke3BhZ2UucGFnZU51bWJlcn0gKCR7cGFnZS5maWxlTmFtZX0pIC0tLVxcbiR7cGFnZS5yYXdUZXh0fVxcbmBcclxuICAgIClcclxuICAgIC5qb2luKFwiXFxuXCIpO1xyXG5cclxuICByZXR1cm4gYFxyXG5Zb3UgYXJlIGEgYmFja2VuZCBleHRyYWN0aW9uIHdvcmtlci4gQ29udmVydCBjbGluaWMgbWVudSBPQ1IgdGV4dCBpbnRvIHN0cnVjdHVyZWQgSlNPTiBmb3IgYnVsayBDU1YgdXBsb2FkLlxyXG5cclxuSU1QT1JUQU5UOiBUaGlzIGlzIGEgKip0b29sIGNhbGwqKiwgbm90IGEgY2hhdC4gIFxyXG4tIERvIE5PVCBhc2sgcXVlc3Rpb25zLiAgXHJcbi0gRG8gTk9UIGV4cGxhaW4geW91ciByZWFzb25pbmcuICBcclxuLSBEbyBOT1QgY29tbWVudCBvbiBtaXNzaW5nIHBhZ2VzIG9yIHBsYWNlaG9sZGVycy4gIFxyXG4tICoqUmV0dXJuIE9OTFkgYSBzaW5nbGUgSlNPTiBvYmplY3QqKiBhcyBkZXNjcmliZWQgYmVsb3cuXHJcblxyXG5GSUxFIENPTlRFWFRcclxuLS0tLS0tLS0tLS0tXHJcbi0gRklMRSBOQU1FOiBcIiR7bWFpbkZpbGVOYW1lfVwiXHJcbi0gVE9UQUwgUEFHRVM6ICR7b3JkZXJlZC5sZW5ndGh9XHJcblxyXG5Tb21lIHBhZ2VzIG1heSBiZSBlbXB0eSBvciBoYXZlIHdlYWsgT0NSOyBqdXN0IHNraXAgbm9uLXVzYWJsZSB0ZXh0IHdpdGhvdXQgY29tbWVudGluZyBvbiBpdC5cclxuXHJcbkdMT0JBTCBFWFRSQUNUSU9OIFJVTEVTXHJcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbjEuIFNjYW4gQUxMIHBhZ2VzIGFuZCBBTEwgbGluZXMgdGhhdCBjb250YWluIHRleHQuXHJcbjIuICoqRVZFUlkgY2xlYXJseSBwcmljZWQgaXRlbSBpcyBhIHNlcGFyYXRlIHBhY2thZ2UqKiwgZXZlbiBpbnNpZGUgc2VjdGlvbnMgbGlrZTpcclxuICAgLSBJViBkcmlwcyAoZS5nLiBcIlNpZ25hdHVyZSBEcmlwXCIsIFwiRXhwcmVzcyBJViBEcmlwc1wiLCBcIlByZW1pdW0gSVYgRHJpcHNcIilcclxuICAgLSBWaXRhbWluIGRyaXBzIC8gaW5qZWN0aW9uc1xyXG4gICAtIFNlc3Npb24tYmFzZWQgc2VydmljZXMgKENvbXByZXNzaW9uIFRoZXJhcHksIFJlZCBMaWdodCBUaGVyYXB5LCBIeXBlcmJhcmljIE94eWdlbiBUaGVyYXB5LCBJbmZyYXJlZCBTYXVuYSwgZXRjLilcclxuMy4gQSBsaW5lL2Jsb2NrIGlzIGEgcGFja2FnZSBpZiBpdCBoYXM6XHJcbiAgIC0gYSBuYW1lL3RpdGxlLCBBTkRcclxuICAgLSBhIHByaWNlIChlLmcuIFwiwqMxMDBcIiwgXCLCozI1XCIsIFwiUk0gMSw1MDBcIikuXHJcbjQuIFNlY3Rpb24gaGVhZGluZ3Mgd2l0aCBOTyBwcmljZSBhcmUgTk9UIHBhY2thZ2VzLlxyXG41LiBEbyBOT1QgaWdub3JlIG5vbi1FbmdsaXNoIG9yIGJpbGluZ3VhbCBsaW5lczsgQ2hpbmVzZS9UaGFpLW9ubHkgcGFja2FnZXMgYXJlIHN0aWxsIHZhbGlkLlxyXG42LiBJZiB5b3UgYXJlIHVuc3VyZSB3aGV0aGVyIHNvbWV0aGluZyBpcyBhIHBhY2thZ2UsICoqcHJlZmVyIHRvIGluY2x1ZGUgaXQqKiB3aXRoIGxvdyBjb25maWRlbmNlIGluc3RlYWQgb2Ygc2lsZW50bHkgZHJvcHBpbmcgaXQuXHJcblxyXG5ERU5TRSBNRU5VU1xyXG4tLS0tLS0tLS0tLS0tLS0tXHJcbkZvciBkZW5zZSB0ZXh0IGxpa2U6XHJcblxyXG4gIFNpZ25hdHVyZSBEcmlwIC4uLiDCozQ1MFxyXG4gIExpbWl0bGVzcyBEcmlwIC4uLiDCozg1MFxyXG4gIEh5ZHJhdGlvbiBEcmlwIMKjMTAwIFNvZGl1bSBDaGxvcmlkZSArIEJpY2FyYm9uYXRlICsgLi4uXHJcbiAgTXVsdGlWaXQgRHJpcCDCozEyNSBCYXNpYyBIeWRyYXRpb24gKyBCIENvbXBsZXggKyAyZyBWaXRhbWluIENcclxuICAuLi5cclxuXHJcbllvdSBtdXN0OlxyXG4tIFRyZWF0IGVhY2ggKipcIm5hbWUgLi4uIMKjcHJpY2VcIioqIGFzIGl0cyBvd24gcGFja2FnZS5cclxuLSBVc2UgcHJpY2UgdG9rZW5zICjCozEwMCwgwqMxMjUsIMKjMTUwLCDCozE3NSwgwqMyMDAsIMKjMjI1LCDCozQ1MCwgwqM4NTAsIGV0Yy4pIGFzIHN0cm9uZyBib3VuZGFyaWVzIGJldHdlZW4gcGFja2FnZXMuXHJcbi0gVXNlIHRoZSB0ZXh0IGltbWVkaWF0ZWx5IGFyb3VuZCB0aGUgbmFtZSBhczpcclxuICAtIHRpdGxlICAgICAgIOKGkiBtYWluIHBhY2thZ2UgbmFtZSAoZS5nLiBcIkh5ZHJhdGlvbiBEcmlwXCIsIFwiRW5lcmd5IERyaXAgKE15ZXJzIENvY2t0YWlsKVwiKVxyXG4gIC0gZGVzY3JpcHRpb24vZGV0YWlscy9pbmNsdWRlcyDihpIgY29tcG9zaXRpb25zLCBpbmdyZWRpZW50cywgb3IgZXh0cmEgaW5mby5cclxuXHJcblNFUlZJQ0UgKyBTRVNTSU9OIEJVTkRMRVNcclxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5Gb3IgYnVuZGxlcyBsaWtlOlxyXG5cclxuICBDb21wcmVzc2lvbiBUaGVyYXB5IC4uLlxyXG4gIEludHJvIFNlc3Npb24gKGZpcnN0IHRpbWUgb25seSkgwqMxMFxyXG4gIDEgU2Vzc2lvbiDCozI1XHJcbiAgNSBTZXNzaW9ucyDCozExMFxyXG4gIDEwIFNlc3Npb25zIMKjMTkwXHJcblxyXG4gIFJlZCBMaWdodCBUaGVyYXB5IGZyb20gwqM1NVxyXG4gIDEgeCBTZXNzaW9uIMKjNTVcclxuICA1IHggU2Vzc2lvbnMgwqMyMjBcclxuICAuLi5cclxuXHJcbllvdSBtdXN0OlxyXG4tIENyZWF0ZSBhIHNlcGFyYXRlIHBhY2thZ2UgZm9yIGVhY2ggKipzZXNzaW9uICsgcHJpY2UqKiBsaW5lLlxyXG4gIEV4YW1wbGUgdGl0bGVzOlxyXG4gIC0gXCJDb21wcmVzc2lvbiBUaGVyYXB5IOKAkyBJbnRybyBTZXNzaW9uICgyMCBtaW4pXCJcclxuICAtIFwiQ29tcHJlc3Npb24gVGhlcmFweSDigJMgNSBTZXNzaW9uc1wiXHJcbiAgLSBcIlJlZCBMaWdodCBUaGVyYXB5IOKAkyAxMCBTZXNzaW9uc1wiXHJcbiAgLSBcIkh5cGVyYmFyaWMgT3h5Z2VuIFRoZXJhcHkg4oCTIDYwIE1pbnV0ZSA1IFNlc3Npb25zXCJcclxuLSBQdXQgZXhhY3QgcHJpY2VzIGludG8gXFxgcHJpY2VcXGAuXHJcbi0gUHV0IGR1cmF0aW9ucyBsaWtlIFwiMjAgbWluc1wiLCBcIjYwIG1pbnNcIiBpbnRvIFxcYGR1cmF0aW9uXFxgIHdoZW4gY2xlYXIuXHJcbi0gSWYgZHVyYXRpb24gaXMgYW1iaWd1b3VzLCBzdGlsbCBlbWl0IHRoZSBwYWNrYWdlLCBidXQgbG93ZXIgXFxgX21ldGEuY29uZmlkZW5jZV9zY29yZVxcYCBhbmQgYWRkIGEgd2FybmluZy5cclxuXHJcbkxPVy1DT05GSURFTkNFIC8gQU1CSUdVT1VTIElURU1TXHJcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbklmIHRleHQgbGlrZWx5IHJlcHJlc2VudHMgYSBwdXJjaGFzYWJsZSBkcmlwLCBpbmplY3Rpb24sIHNlc3Npb24sIG9yIGFkZC1vbiBidXQgdGhlIGJvdW5kYXJpZXMgYXJlIGZ1enp5OlxyXG5cclxuLSBTVElMTCBjcmVhdGUgYSBwYWNrYWdlLlxyXG4tIFNldCBcXGBfbWV0YS5jb25maWRlbmNlX3Njb3JlXFxgIHRvIGEgbG93IHZhbHVlIChlLmcuIDAuM+KAkzAuNikuXHJcbi0gQWRkIHdhcm5pbmdzIHN1Y2ggYXM6XHJcbiAgLSBcIkxvdyBjb25maWRlbmNlIHNlZ21lbnRhdGlvbjogcGFja2FnZSBib3VuZGFyaWVzIG1heSBiZSBpbmNvcnJlY3RcIlxyXG4gIC0gXCJUaXRsZSBhbmQgZGVzY3JpcHRpb24gbWF5IGJlIG1peGVkIGZyb20gbmVpZ2hib3VyaW5nIGl0ZW1zXCJcclxuICAtIFwiUHJpY2UgYXR0YWNoZWQgd2l0aCBsb3cgY29uZmlkZW5jZVwiXHJcblxyXG5Pbmx5IGlnbm9yZSBvYnZpb3VzIG5vbi1wYWNrYWdlIHRleHQ6IGRpc2NsYWltZXJzLCBnZW5lcmFsIG1hcmtldGluZyBjb3B5LCBoZWFkaW5ncyB3aXRoIG5vIHByaWNlLCBldGMuXHJcblxyXG5PVVRQVVQgRk9STUFUIChTVFJJQ1QpXHJcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuUmV0dXJuICoqb25seSoqIGEgc2luZ2xlIEpTT04gb2JqZWN0IHdpdGggdGhpcyBleGFjdCBzaGFwZSAobm8gbWFya2Rvd24sIG5vIGNvbW1lbnRzKTpcclxuXHJcbntcclxuICBcInBhY2thZ2VzXCI6IFsgeyAuLi4gfSwgLi4uIF1cclxufVxyXG5cclxuRWFjaCBwYWNrYWdlIG9iamVjdCBNVVNUIGluY2x1ZGUgQUxMIG9mIHRoZSBmb2xsb3dpbmcga2V5czpcclxuXHJcbi0gdGl0bGU6IHN0cmluZ1xyXG4tIGRlc2NyaXB0aW9uOiBzdHJpbmdcclxuLSBkZXRhaWxzOiBzdHJpbmdcclxuLSBob3NwaXRhbF9uYW1lOiBzdHJpbmdcclxuLSB0cmVhdG1lbnRfbmFtZTogc3RyaW5nXHJcbi0gc3ViX3RyZWF0bWVudHM6IHN0cmluZ1xyXG4tIHByaWNlOiBudW1iZXIgfCBudWxsXHJcbi0gb3JpZ2luYWxfcHJpY2U6IG51bWJlciB8IG51bGxcclxuLSBjdXJyZW5jeTogXCJVU0RcIiB8IFwiVEhCXCIgfCBcIkVVUlwiIHwgXCJHQlBcIiB8IFwiU0dEXCIgfCBcIk1ZUlwiIHwgXCJLUldcIiB8IFwiQ05ZXCJcclxuLSBkdXJhdGlvbjogc3RyaW5nXHJcbi0gdHJlYXRtZW50X2NhdGVnb3J5OiBzdHJpbmdcclxuLSBhbmFlc3RoZXNpYTogc3RyaW5nXHJcbi0gY29tbWlzc2lvbjogbnVtYmVyIHwgbnVsbFxyXG4tIGZlYXR1cmVkOiBib29sZWFuXHJcbi0gc3RhdHVzOiBcImFjdGl2ZVwiIHwgXCJpbmFjdGl2ZVwiXHJcbi0gZG9jdG9yX25hbWU6IHN0cmluZ1xyXG4tIGlzX2xlX3BhY2thZ2U6IGJvb2xlYW5cclxuLSBpbmNsdWRlczogc3RyaW5nXHJcbi0gaW1hZ2VfZmlsZV9pZDogc3RyaW5nIHwgbnVsbFxyXG4tIGhvc3BpdGFsX2xvY2F0aW9uOiBzdHJpbmdcclxuLSBjYXRlZ29yeTogc3RyaW5nXHJcbi0gaG9zcGl0YWxfY291bnRyeTogc3RyaW5nXHJcbi0gdHJhbnNsYXRpb25fdGl0bGU6IHN0cmluZ1xyXG4tIHRyYW5zbGF0aW9uX2Rlc2NyaXB0aW9uOiBzdHJpbmdcclxuLSB0cmFuc2xhdGlvbl9kZXRhaWxzOiBzdHJpbmdcclxuLSB0cmFuc2xhdGlvbjogc3RyaW5nXHJcbi0gX21ldGE6IHtcclxuICAgIHNvdXJjZV9maWxlOiBzdHJpbmcsXHJcbiAgICBzb3VyY2VfcGFnZTogbnVtYmVyLFxyXG4gICAgY29uZmlkZW5jZV9zY29yZTogbnVtYmVyLFxyXG4gICAgd2FybmluZ3M6IHN0cmluZ1tdXHJcbiAgfVxyXG5cclxuREVGQVVMVFMgV0hFTiBVTktOT1dOXHJcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5JZiBhbnkgdmFsdWUgaXMgdW5rbm93biBvciBub3QgcHJlc2VudCBpbiB0aGUgT0NSIHRleHQ6XHJcbi0gVXNlIFwiXCIgZm9yIHN0cmluZ3MuXHJcbi0gVXNlIG51bGwgZm9yIG51bWVyaWMgZmllbGRzIChwcmljZSwgb3JpZ2luYWxfcHJpY2UsIGNvbW1pc3Npb24pLlxyXG4tIFVzZSBmYWxzZSBmb3IgYm9vbGVhbnMgKGZlYXR1cmVkLCBpc19sZV9wYWNrYWdlKSB1bmxlc3MgY2xlYXJseSB0cnVlLlxyXG4tIFVzZSBcImFjdGl2ZVwiIGZvciBzdGF0dXMgaWYgdW5jbGVhci5cclxuLSBfbWV0YS5zb3VyY2VfZmlsZSA9IHRoZSBmaWxlIG5hbWUgZm9yIHRoYXQgcGFnZS5cclxuLSBfbWV0YS5zb3VyY2VfcGFnZSA9IHRoZSBwYWdlIG51bWJlci5cclxuLSBfbWV0YS5jb25maWRlbmNlX3Njb3JlIGJldHdlZW4gMC4wIGFuZCAxLjAgKHlvdXIgYmVzdCBndWVzcykuXHJcblxyXG5MQU5HVUFHRSAmIFRSQU5TTEFUSU9OXHJcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuLSBJZiB0aGUgcGFja2FnZSB0ZXh0IGlzIGFscmVhZHkgaW4gRU5HTElTSDpcclxuICAtIEtlZXAgdGl0bGUvZGVzY3JpcHRpb24vZGV0YWlscyBpbiBFbmdsaXNoLlxyXG4gIC0gdHJhbnNsYXRpb25fdGl0bGUgLyB0cmFuc2xhdGlvbl9kZXNjcmlwdGlvbiAvIHRyYW5zbGF0aW9uX2RldGFpbHMgPSBcIlwiLlxyXG4gIC0gdHJhbnNsYXRpb24gPSBcIlwiIG9yIFwiRU5cIi5cclxuLSBJZiB0aGUgcGFja2FnZSB0ZXh0IGlzIE5PVCBFbmdsaXNoIChlLmcuIENoaW5lc2UsIFRoYWkpOlxyXG4gIC0gS2VlcCB0aGUgb3JpZ2luYWwgbGFuZ3VhZ2UgaW4gdGl0bGUvZGVzY3JpcHRpb24vZGV0YWlscy5cclxuICAtIFByb3ZpZGUgRU5HTElTSCB0cmFuc2xhdGlvbnM6XHJcbiAgICAtIHRyYW5zbGF0aW9uX3RpdGxlOiB0aXRsZSDihpIgRU5HTElTSFxyXG4gICAgLSB0cmFuc2xhdGlvbl9kZXNjcmlwdGlvbjogZGVzY3JpcHRpb24g4oaSIEVOR0xJU0hcclxuICAgIC0gdHJhbnNsYXRpb25fZGV0YWlsczogZGV0YWlscyDihpIgRU5HTElTSFxyXG4gIC0gdHJhbnNsYXRpb24gPSBzaG9ydCBsYW5ndWFnZSBjb2RlLCBlLmcuIFwiWkhcIiwgXCJUSC0+WkhcIi5cclxuLSBJZiB0aGUgdGV4dCBpcyB1bnJlYWRhYmxlOlxyXG4gIC0gbGVhdmUgdHJhbnNsYXRpb25fKiA9IFwiXCJcclxuICAtIGFkZCBhIHdhcm5pbmcgbGlrZSBcIk9DUiB0ZXh0IHVucmVhZGFibGUgZm9yIHRoaXMgcGFja2FnZVwiLlxyXG5cclxuQ0FOT05JQ0FMIFRSRUFUTUVOVCBOQU1FU1xyXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbldoZW4geW91IGluZmVyIG9yIG5vcm1hbGl6ZSB0cmVhdG1lbnRfbmFtZSwgeW91IE1VU1QgcHJlZmVyIHRoZSBmb2xsb3dpbmdcclxuY2Fub25pY2FsIG5hbWVzIHdoZW5ldmVyIHRoZXkgY2xlYXJseSBtYXRjaCB0aGUgbWVudSBjb250ZXh0LiBVc2UgdGhlc2UgZXhhY3Rcclxuc3RyaW5ncyAoaW5jbHVkaW5nIGNhcGl0YWxpemF0aW9uIGFuZCBzcGFjaW5nKSB3aGVyZSBhcHByb3ByaWF0ZTpcclxuXHJcbkRpYWdub3N0aWNzOlxyXG4tIFwiSGVhbHRoIENoZWNrdXBcIlxyXG4tIFwiQ2FuY2VyIFNjcmVlbmluZ1wiXHJcbi0gXCJNUkkgU2NhblwiXHJcbi0gXCJDVCBTY2FuXCJcclxuLSBcIlBFVC1DVCBTY2FuXCJcclxuLSBcIkJsb29kIFRlc3RcIlxyXG4tIFwiQ2FyZGlhYyBTY3JlZW5pbmdcIlxyXG5cclxuU3VyZ2VyeTpcclxuLSBcIkhpcCAmIEtuZWUgUmVwbGFjZW1lbnRcIlxyXG4tIFwiU3BpbmFsIFN1cmdlcnlcIlxyXG4tIFwiQnJhaW4gVHVtb3IgU3VyZ2VyeVwiXHJcbi0gXCJIZWFydCBWYWx2ZSBSZXBhaXJcIlxyXG4tIFwiS2lkbmV5IFRyYW5zcGxhbnRcIlxyXG4tIFwiTGl2ZXIgVHJhbnNwbGFudFwiXHJcbi0gXCJMQVNJSyBTdXJnZXJ5XCJcclxuLSBcIkNhdGFyYWN0IFN1cmdlcnlcIlxyXG4tIFwiR2xhdWNvbWEgU3VyZ2VyeVwiXHJcbi0gXCJHYXN0cmljIFNsZWV2ZVwiXHJcbi0gXCJHYXN0cmljIEJ5cGFzc1wiXHJcbi0gXCJFbmRvc2NvcGljIFNsZWV2ZSBHYXN0cm9wbGFzdHlcIlxyXG4tIFwiR2VuZGVyLUFmZmlybWluZyBTdXJnZXJ5XCJcclxuLSBcIlBhY2VtYWtlciBJbXBsYW50YXRpb25cIlxyXG4tIFwiUHJvc3RhdGUgU3VyZ2VyeVwiXHJcbi0gXCJWYXNlY3RvbXkgUmV2ZXJzYWxcIlxyXG4tIFwiSHlzdGVyZWN0b215XCJcclxuLSBcIkZpYnJvaWQgUmVtb3ZhbFwiXHJcbi0gXCJDb3JuZWFsIFRyYW5zcGxhbnRcIlxyXG4tIFwiRGVlcCBCcmFpbiBTdGltdWxhdGlvbiAoREJTKVwiXHJcbi0gXCJFcGlsZXBzeSBTdXJnZXJ5XCJcclxuLSBcIlNwaW5hbCBDb3JkIFN1cmdlcnlcIlxyXG5cclxuQ29zbWV0aWMgJiBQbGFzdGljIFN1cmdlcnk6XHJcbi0gXCJGYWNpYWwgUGxhc3RpYyBTdXJnZXJ5XCJcclxuLSBcIkJyZWFzdCBBdWdtZW50YXRpb25cIlxyXG4tIFwiUmhpbm9wbGFzdHlcIlxyXG4tIFwiTGlwb3N1Y3Rpb25cIlxyXG4tIFwiQm90b3ggVHJlYXRtZW50XCJcclxuLSBcIkRlcm1hbCBGaWxsZXJzXCJcclxuLSBcIkhhaXIgVHJhbnNwbGFudFwiXHJcbi0gXCJMYXNlciBSZXN1cmZhY2luZ1wiXHJcbi0gXCJCdWNjYWwgRmF0IFJlbW92YWxcIlxyXG4tIFwiQ2hpbiBBdWdtZW50YXRpb25cIlxyXG4tIFwiVGVldGggV2hpdGVuaW5nXCJcclxuLSBcIlZlbmVlclwiXHJcblxyXG5UcmVhdG1lbnQ6XHJcbi0gXCJEZW50YWwgSW1wbGFudHNcIlxyXG4tIFwiUm9vdCBDYW5hbFwiXHJcbi0gXCJJVkYgKEluIFZpdHJvIEZlcnRpbGl6YXRpb24pXCJcclxuLSBcIklVSSAoSW50cmF1dGVyaW5lIEluc2VtaW5hdGlvbilcIlxyXG4tIFwiRWdnIEZyZWV6aW5nXCJcclxuLSBcIkhSVCAoSG9ybW9uZSBSZXBsYWNlbWVudCBUaGVyYXB5KVwiXHJcblxyXG5PbmNvbG9neTpcclxuLSBcIkNoZW1vdGhlcmFweVwiXHJcbi0gXCJSYWRpYXRpb24gVGhlcmFweVwiXHJcbi0gXCJJbW11bm90aGVyYXB5XCJcclxuLSBcIlByb3RvbiBUaGVyYXB5XCJcclxuXHJcbldlbGxuZXNzOlxyXG4tIFwiRGV0b3ggUmV0cmVhdHNcIlxyXG4tIFwiSVYgVGhlcmFweVwiXHJcbi0gXCJBbnRpLUFnaW5nIFRoZXJhcHlcIlxyXG4tIFwiUGh5c2lvdGhlcmFweVwiXHJcblxyXG5UcmFkaXRpb25hbCBNZWRpY2luZTpcclxuLSBcIkFjdXB1bmN0dXJlXCJcclxuLSBcIkF5dXJ2ZWRhXCJcclxuLSBcIlRoYWkgTWFzc2FnZVwiXHJcblxyXG5SdWxlczpcclxuLSBJZiBhIG1lbnUgaXRlbSBjbGVhcmx5IG1hdGNoZXMgb25lIG9mIHRoZSBhYm92ZSwgc2V0IHRyZWF0bWVudF9uYW1lIHRvIHRoYXQgZXhhY3Qgc3RyaW5nLlxyXG4tIElmIG5vIGNhbm9uaWNhbCBuYW1lIGZpdHMsIHVzZSB0aGUgY2xvc2VzdCB0cmVhdG1lbnRfbmFtZSBtYXRjaC5cclxuXHJcbkZJRUxEIE1BUFBJTkcgSElOVFNcclxuLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4tIEVhY2ggZGlzdGluY3QgbGluZSBvciBibG9jayB3aXRoIGEgcHJpY2UgKGUuZy4gXCJIeWRyYXRpb24gRHJpcCDCozEwMFwiKSBpcyBpdHMgb3duIHBhY2thZ2UuXHJcbi0gVXNlIHRoZSBsb2NhbCBwcmljZSBzeW1ib2wgb3IgY29udGV4dCB0byBpbmZlciBjdXJyZW5jeSwgZS5nLjpcclxuICAgIC0gXCLCo1wiIOKGkiBHQlBcclxuICAgIC0gXCJSTVwiIOKGkiBNWVJcclxuICAgIC0gXCLguL9cIiDihpIgVEhCXHJcbiAgICAtIFwiUyRcIiDihpIgU0dEXHJcbiAgICAtIFwiJFwiIHdpdGggVVMgY29udGV4dCDihpIgVVNEXHJcbi0gdHJlYXRtZW50X25hbWU6IHVzZSBhIGNhbm9uaWNhbCBuYW1lIGZyb20gdGhlIGxpc3QgYWJvdmUgd2hlbmV2ZXIgcG9zc2libGUuXHJcbi0gc3ViX3RyZWF0bWVudHM6IGNvbW1hLXNlcGFyYXRlZCBzdWItZm9jdXNlcyAoZS5nLiBcIkh5ZHJhdGlvbixTa2luIFJlanV2ZW5hdGlvblwiKS5cclxuLSBpbmNsdWRlczogZm9ybWF0dGVkIGluY2x1c2lvbnMgbGlrZSBcIkNvbnN1bHRhdGlvbixEcmlwLEZvbGxvdyBVcFwiLlxyXG5cclxuX0V4YW1wbGUgd2FybmluZ3MgaW4gX21ldGEud2FybmluZ3NfOlxyXG4tIFwiSG9zcGl0YWwgbm90IHJlY29nbml6ZWQ6IOKAplwiXHJcbi0gXCJUcmVhdG1lbnQgbm90IHJlY29nbml6ZWQ6IOKAplwiXHJcbi0gXCJNaXNzaW5nIHByaWNlIGZvciBwYWNrYWdlIOKAplwiXHJcbi0gXCJDdXJyZW5jeSBub3QgcmVjb2duaXplZFwiXHJcbi0gXCJMb3cgY29uZmlkZW5jZSBzZWdtZW50YXRpb246IHBhY2thZ2UgYm91bmRhcmllcyBtYXkgYmUgaW5jb3JyZWN0XCJcclxuXHJcblJlbWVtYmVyOiAqKkRvIG5vdCBvdXRwdXQgYW55dGhpbmcgZXhjZXB0IHRoZSBKU09OIG9iamVjdCoqLlxyXG5cclxuT0NSIFRFWFQgKFRISVMgRklMRSBPTkxZLCBCWSBQQUdFKVxyXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiR7am9pbmVkUGFnZXN9XHJcbmA7XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogc2FuaXRpemVNb2RlbFJlc3BvbnNlXHJcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gKiAxLiBTdHJpcHMgb2J2aW91cyBtYXJrZG93biBmZW5jZXMgKGBgYCAvIGBgYGpzb24pLlxyXG4gKiAyLiBUcmltcyBsZWFkaW5nL3RyYWlsaW5nIG5vaXNlIG91dHNpZGUgdGhlIEZJUlNUICd7JyBhbmQgTEFTVCAnfScuXHJcbiAqL1xyXG5mdW5jdGlvbiBzYW5pdGl6ZU1vZGVsUmVzcG9uc2UodmFsdWU6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgaWYgKCF2YWx1ZSkgcmV0dXJuIFwiXCI7XHJcblxyXG4gIGxldCBjbGVhbmVkID0gdmFsdWUudHJpbSgpO1xyXG5cclxuICAvLyBTdHJpcCBjb21tb24gbWFya2Rvd24gZmVuY2VzIGxpa2UgYGBganNvbiAuLi4gYGBgXHJcbiAgY2xlYW5lZCA9IGNsZWFuZWRcclxuICAgIC5yZXBsYWNlKC9eYGBganNvblxccyovaSwgXCJcIilcclxuICAgIC5yZXBsYWNlKC9eYGBgXFxzKi9pLCBcIlwiKVxyXG4gICAgLnJlcGxhY2UoL2BgYCQvaSwgXCJcIilcclxuICAgIC50cmltKCk7XHJcblxyXG4gIC8vIElmIGl0IGFscmVhZHkgbG9va3MgbGlrZSBKU09OIChzdGFydHMgd2l0aCB7IG9yIFsgYW5kIGVuZHMgd2l0aCB9IG9yIF0pXHJcbiAgLy8ganVzdCByZXR1cm4gaXQgYXMtaXMuXHJcbiAgaWYgKC9eW1xcW3tdLy50ZXN0KGNsZWFuZWQpICYmIC9bXFxdfV0kLy50ZXN0KGNsZWFuZWQpKSB7XHJcbiAgICByZXR1cm4gY2xlYW5lZDtcclxuICB9XHJcblxyXG4gIC8vIEZhbGxiYWNrOiBncmFiIGZyb20gZmlyc3QgJ3snIG9yICdbJyB0byBsYXN0ICd9JyBvciAnXSdcclxuICBjb25zdCBmaXJzdEN1cmx5ID0gY2xlYW5lZC5pbmRleE9mKFwie1wiKTtcclxuICBjb25zdCBsYXN0Q3VybHkgPSBjbGVhbmVkLmxhc3RJbmRleE9mKFwifVwiKTtcclxuICBjb25zdCBmaXJzdFNxdWFyZSA9IGNsZWFuZWQuaW5kZXhPZihcIltcIik7XHJcbiAgY29uc3QgbGFzdFNxdWFyZSA9IGNsZWFuZWQubGFzdEluZGV4T2YoXCJdXCIpO1xyXG5cclxuICBjb25zdCBzdGFydHMgPSBbZmlyc3RDdXJseSwgZmlyc3RTcXVhcmVdLmZpbHRlcigoaSkgPT4gaSAhPT0gLTEpO1xyXG4gIGNvbnN0IGVuZHMgPSBbbGFzdEN1cmx5LCBsYXN0U3F1YXJlXS5maWx0ZXIoKGkpID0+IGkgIT09IC0xKTtcclxuXHJcbiAgaWYgKCFzdGFydHMubGVuZ3RoIHx8ICFlbmRzLmxlbmd0aCkge1xyXG4gICAgLy8gTm90aGluZyBiZXR0ZXIgdG8gZG8g4oCTIHJldHVybiBhcy1pcyBhbmQgbGV0IEpTT04ucGFyc2UgdGhyb3cgZm9yIGxvZ2dpbmdcclxuICAgIHJldHVybiBjbGVhbmVkO1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgc3RhcnQgPSBNYXRoLm1pbiguLi5zdGFydHMpO1xyXG4gIGNvbnN0IGVuZCA9IE1hdGgubWF4KC4uLmVuZHMpO1xyXG5cclxuICByZXR1cm4gY2xlYW5lZC5zbGljZShzdGFydCwgZW5kICsgMSkudHJpbSgpO1xyXG59XHJcblxyXG4vKipcclxuICogbG9nUHJvbXB0U3RhdHNcclxuICogLS0tLS0tLS0tLS0tLS1cclxuICogTGlnaHQgbG9nZ2luZyBzbyB5b3UgY2FuIHNlZSBpZiB5b3XigJlyZSBoaXR0aW5nIHNpbGx5IHByb21wdCBzaXplcy5cclxuICovXHJcbmZ1bmN0aW9uIGxvZ1Byb21wdFN0YXRzKGZpbGVJZDogc3RyaW5nLCBwcm9tcHQ6IHN0cmluZykge1xyXG4gIGNvbnN0IGNoYXJDb3VudCA9IHByb21wdC5sZW5ndGg7XHJcbiAgY29uc3QgYXBwcm94VG9rZW5zID0gTWF0aC5yb3VuZChjaGFyQ291bnQgLyA0KTsgLy8gcm91Z2gtaXNoXHJcbiAgY29uc29sZS5sb2coXHJcbiAgICBgW0JlZHJvY2sgT0NSXSBQcm9tcHQgZm9yIGZpbGUgJHtmaWxlSWR9OiAke2NoYXJDb3VudH0gY2hhcnMgKH4ke2FwcHJveFRva2Vuc30gdG9rZW5zKWBcclxuICApO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJjYWxsQmVkcm9ja0ZvckV4dHJhY3Rpb24iLCJub3JtYWxpemVQYWNrYWdlUm93IiwiZXh0cmFjdFBhY2thZ2VzRnJvbU9jclRleHQiLCJvY3JQYWdlcyIsImxlbmd0aCIsInBhZ2VzQnlGaWxlIiwiTWFwIiwicGFnZSIsImhhcyIsImZpbGVJZCIsInNldCIsImdldCIsInB1c2giLCJhbGxQYWNrYWdlcyIsInBhZ2VzIiwiZW50cmllcyIsIm9yZGVyZWRQYWdlcyIsInNvcnQiLCJhIiwiYiIsInBhZ2VOdW1iZXIiLCJwcm9tcHQiLCJidWlsZFByb21wdEZvclNpbmdsZUZpbGUiLCJsb2dQcm9tcHRTdGF0cyIsInJhd1Jlc3BvbnNlIiwibWF4VG9rZW5zIiwidGVtcGVyYXR1cmUiLCJjbGVhbmVkIiwic2FuaXRpemVNb2RlbFJlc3BvbnNlIiwicGFyc2VkIiwiSlNPTiIsInBhcnNlIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwic2xpY2UiLCJFcnJvciIsInBhY2thZ2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsZU5hbWUiLCJub3JtYWxpemVkRm9yRmlsZSIsIm1hcCIsInJvdyIsImluZGV4Iiwibm9ybWFsaXplZCIsInNhZmVNZXRhIiwiX21ldGEiLCJzb3VyY2VfZmlsZSIsImlkIiwiRGF0ZSIsIm5vdyIsIm9yZGVyZWQiLCJtYWluRmlsZU5hbWUiLCJqb2luZWRQYWdlcyIsInJhd1RleHQiLCJqb2luIiwidmFsdWUiLCJ0cmltIiwicmVwbGFjZSIsInRlc3QiLCJmaXJzdEN1cmx5IiwiaW5kZXhPZiIsImxhc3RDdXJseSIsImxhc3RJbmRleE9mIiwiZmlyc3RTcXVhcmUiLCJsYXN0U3F1YXJlIiwic3RhcnRzIiwiZmlsdGVyIiwiaSIsImVuZHMiLCJzdGFydCIsIk1hdGgiLCJtaW4iLCJlbmQiLCJtYXgiLCJjaGFyQ291bnQiLCJhcHByb3hUb2tlbnMiLCJyb3VuZCIsImxvZyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/services/aiExtractor.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/bedrockClient.ts":
/*!***************************************!*\
  !*** ./src/services/bedrockClient.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   callBedrockForExtraction: () => (/* binding */ callBedrockForExtraction)\n/* harmony export */ });\n/* harmony import */ var _aws_sdk_client_bedrock_runtime__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @aws-sdk/client-bedrock-runtime */ \"(rsc)/./node_modules/@aws-sdk/client-bedrock-runtime/dist-es/commands/InvokeModelCommand.js\");\n/* harmony import */ var _bedrock_config_ts_bedrock_config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../bedrock-config.ts/bedrock-config */ \"(rsc)/./bedrock-config.ts/bedrock-config.ts\");\n\n\n/**\r\n * Default model ID resolution (matches bedrock-config.ts pattern)\r\n * Falls back to CLAUDE_SONNET_MODEL_ID if no env var is set\r\n */ const DEFAULT_MODEL_ID = process.env.BEDROCK_LIGHT_MODEL_ID || process.env.BEDROCK_MODEL_ID || _bedrock_config_ts_bedrock_config__WEBPACK_IMPORTED_MODULE_0__.CLAUDE_SONNET_MODEL_ID;\n/**\r\n * Extracts region from an AWS ARN or returns the configured region\r\n */ function getRegionFromArn(arn) {\n    const match = arn.match(/arn:aws:bedrock:([^:]+):/);\n    return match ? match[1] : null;\n}\n/**\r\n * resolveModelId\r\n * --------------\r\n * Resolves the model identifier, applying inference profile ARN mapping\r\n * when appropriate. Matches the pattern used in processMedicalRecordWithClaude.\r\n * \r\n * If DEFAULT_MODEL_ID is already an ARN, it will be used directly.\r\n * If it's a plain model ID, it will be mapped to a profile ARN if available.\r\n */ function resolveModelId(preferred) {\n    const configuredRegion = process.env.AWS_REGION || process.env.AWS_BEDROCK_REGION || \"us-east-1\";\n    let modelId = preferred || DEFAULT_MODEL_ID;\n    // If DEFAULT_MODEL_ID is already an ARN (starts with \"arn:aws:bedrock:\"), use it directly\n    const isAlreadyArn = modelId.startsWith(\"arn:aws:bedrock:\");\n    if (isAlreadyArn) {\n        // Validate that ARN region matches configured region\n        const arnRegion = getRegionFromArn(modelId);\n        if (arnRegion && arnRegion !== configuredRegion) {\n            console.error(`\\n[Bedrock OCR] âŒ REGION MISMATCH DETECTED:\\n` + `  â€¢ Your AWS_REGION is set to: ${configuredRegion}\\n` + `  â€¢ But your inference profile ARN is for region: ${arnRegion}\\n` + `  â€¢ This WILL cause \"model identifier invalid\" errors.\\n\\n` + `SOLUTION: Change AWS_REGION in .env.local to match the ARN region:\\n` + `  AWS_REGION=${arnRegion}\\n\\n` + `Or create new inference profiles in ${configuredRegion} and update your ARNs.\\n`);\n        }\n        console.log(\"[Bedrock OCR] Using inference profile ARN:\", modelId.substring(0, 80) + \"...\");\n        return modelId;\n    }\n    // Map plain model ID â†’ inference profile ARN when appropriate (same logic as bedrock-config.ts)\n    const resolvedModelId = modelId === _bedrock_config_ts_bedrock_config__WEBPACK_IMPORTED_MODULE_0__.CLAUDE_SONNET_MODEL_ID && _bedrock_config_ts_bedrock_config__WEBPACK_IMPORTED_MODULE_0__.CLAUDE_SONNET_PROFILE_ARN ? _bedrock_config_ts_bedrock_config__WEBPACK_IMPORTED_MODULE_0__.CLAUDE_SONNET_PROFILE_ARN : modelId === _bedrock_config_ts_bedrock_config__WEBPACK_IMPORTED_MODULE_0__.CLAUDE_OPUS_MODEL_ID && _bedrock_config_ts_bedrock_config__WEBPACK_IMPORTED_MODULE_0__.CLAUDE_OPUS_PROFILE_ARN ? _bedrock_config_ts_bedrock_config__WEBPACK_IMPORTED_MODULE_0__.CLAUDE_OPUS_PROFILE_ARN : modelId;\n    // If resolved to an ARN, check region match\n    if (resolvedModelId.startsWith(\"arn:aws:bedrock:\")) {\n        const arnRegion = getRegionFromArn(resolvedModelId);\n        if (arnRegion && arnRegion !== configuredRegion) {\n            console.error(`\\n[Bedrock OCR] âŒ REGION MISMATCH DETECTED:\\n` + `  â€¢ Your AWS_REGION is set to: ${configuredRegion}\\n` + `  â€¢ But your profile ARN (from BEDROCK_PROFILE_ARN) is for region: ${arnRegion}\\n` + `  â€¢ This WILL cause \"model identifier invalid\" errors.\\n\\n` + `SOLUTION: Change AWS_REGION in .env.local to match the ARN region:\\n` + `  AWS_REGION=${arnRegion}\\n\\n` + `Or create new inference profiles in ${configuredRegion} and update your ARNs.\\n`);\n        }\n    }\n    if (!resolvedModelId || resolvedModelId.trim() === \"\") {\n        throw new Error(\"No Bedrock model configured. Set BEDROCK_LIGHT_MODEL_ID or BEDROCK_MODEL_ID in .env.local.\");\n    }\n    console.log(\"[Bedrock OCR] Using model:\", resolvedModelId);\n    return resolvedModelId;\n}\n/**\r\n * callBedrockForExtraction\r\n * ------------------------\r\n * Invokes Claude on AWS Bedrock with the provided prompt and returns\r\n * the plain-text response body. Uses the shared bedrockClient from\r\n * bedrock-config.ts to ensure region and credentials match the working\r\n * medical records processing code.\r\n *\r\n * Matches the Anthropic payload format and model resolution pattern\r\n * from processMedicalRecordWithClaude.\r\n */ async function callBedrockForExtraction(prompt, options) {\n    let resolvedModelId;\n    try {\n        // Resolve model ID first (throws if missing)\n        resolvedModelId = resolveModelId(options?.modelId);\n        const maxTokens = options?.maxTokens ?? 4000;\n        const temperature = options?.temperature ?? 0.2;\n        const input = {\n            modelId: resolvedModelId,\n            contentType: \"application/json\",\n            accept: \"application/json\",\n            body: JSON.stringify({\n                anthropic_version: \"bedrock-2023-05-31\",\n                max_tokens: maxTokens,\n                temperature,\n                messages: [\n                    {\n                        role: \"user\",\n                        content: prompt\n                    }\n                ]\n            })\n        };\n        const command = new _aws_sdk_client_bedrock_runtime__WEBPACK_IMPORTED_MODULE_1__.InvokeModelCommand(input);\n        const response = await _bedrock_config_ts_bedrock_config__WEBPACK_IMPORTED_MODULE_0__.bedrockClient.send(command);\n        // Convert raw response into text (same pattern as bedrock-config.ts)\n        const rawText = await (async ()=>{\n            const body = response.body;\n            if (typeof body?.transformToByteArray === \"function\") {\n                return new TextDecoder().decode(await body.transformToByteArray());\n            }\n            if (body instanceof Uint8Array) {\n                return new TextDecoder().decode(body);\n            }\n            return String(body ?? \"\");\n        })();\n        const responseBody = JSON.parse(rawText || \"{}\");\n        const claudeText = responseBody?.content?.[0]?.text || \"\";\n        return claudeText;\n    } catch (error) {\n        const msg = error instanceof Error ? error.message : \"Unknown error\";\n        // Include resolved model ID in validation error logs for debugging\n        if (msg.includes(\"ValidationException\")) {\n            console.error(\"[Bedrock OCR] Validation error for model:\", resolvedModelId || \"unknown\", error);\n        }\n        // Re-throw with context (matches bedrock-config.ts error handling)\n        if (msg.includes(\"UnrecognizedClientException\") || msg.includes(\"InvalidSignatureException\")) {\n            throw new Error(\"AWS Bedrock authentication failed.\");\n        }\n        if (msg.includes(\"ValidationException\")) {\n            throw new Error(\"AWS Bedrock validation error: \" + msg);\n        }\n        if (msg.includes(\"ModelNotReadyException\") || msg.includes(\"ThrottlingException\")) {\n            throw new Error(\"AWS Bedrock temporarily unavailable.\");\n        }\n        if (msg.includes(\"AccessDeniedException\")) {\n            throw new Error(\"Permission denied for AWS Bedrock.\");\n        }\n        throw new Error(\"Bedrock extraction failed: \" + msg);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvYmVkcm9ja0NsaWVudC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBcUU7QUFPckI7QUFFaEQ7OztDQUdDLEdBQ0QsTUFBTU0sbUJBQ0pDLFFBQVFDLEdBQUcsQ0FBQ0Msc0JBQXNCLElBQ2xDRixRQUFRQyxHQUFHLENBQUNFLGdCQUFnQixJQUM1QlAscUZBQXNCQTtBQUV4Qjs7Q0FFQyxHQUNELFNBQVNRLGlCQUFpQkMsR0FBVztJQUNuQyxNQUFNQyxRQUFRRCxJQUFJQyxLQUFLLENBQUM7SUFDeEIsT0FBT0EsUUFBUUEsS0FBSyxDQUFDLEVBQUUsR0FBRztBQUM1QjtBQUVBOzs7Ozs7OztDQVFDLEdBQ0QsU0FBU0MsZUFBZUMsU0FBa0I7SUFDeEMsTUFBTUMsbUJBQW1CVCxRQUFRQyxHQUFHLENBQUNTLFVBQVUsSUFBSVYsUUFBUUMsR0FBRyxDQUFDVSxrQkFBa0IsSUFBSTtJQUNyRixJQUFJQyxVQUFVSixhQUFhVDtJQUUzQiwwRkFBMEY7SUFDMUYsTUFBTWMsZUFBZUQsUUFBUUUsVUFBVSxDQUFDO0lBRXhDLElBQUlELGNBQWM7UUFDaEIscURBQXFEO1FBQ3JELE1BQU1FLFlBQVlYLGlCQUFpQlE7UUFDbkMsSUFBSUcsYUFBYUEsY0FBY04sa0JBQWtCO1lBQy9DTyxRQUFRQyxLQUFLLENBQ1gsQ0FBQyw2Q0FBNkMsQ0FBQyxHQUMvQyxDQUFDLCtCQUErQixFQUFFUixpQkFBaUIsRUFBRSxDQUFDLEdBQ3RELENBQUMsa0RBQWtELEVBQUVNLFVBQVUsRUFBRSxDQUFDLEdBQ2xFLENBQUMsMERBQTBELENBQUMsR0FDNUQsQ0FBQyxvRUFBb0UsQ0FBQyxHQUN0RSxDQUFDLGFBQWEsRUFBRUEsVUFBVSxJQUFJLENBQUMsR0FDL0IsQ0FBQyxvQ0FBb0MsRUFBRU4saUJBQWlCLHdCQUF3QixDQUFDO1FBRXJGO1FBQ0FPLFFBQVFFLEdBQUcsQ0FBQyw4Q0FBOENOLFFBQVFPLFNBQVMsQ0FBQyxHQUFHLE1BQU07UUFDckYsT0FBT1A7SUFDVDtJQUVBLGdHQUFnRztJQUNoRyxNQUFNUSxrQkFDSlIsWUFBWWhCLHFGQUFzQkEsSUFBSUUsd0ZBQXlCQSxHQUMzREEsd0ZBQXlCQSxHQUN6QmMsWUFBWWpCLG1GQUFvQkEsSUFBSUUsc0ZBQXVCQSxHQUMzREEsc0ZBQXVCQSxHQUN2QmU7SUFFTiw0Q0FBNEM7SUFDNUMsSUFBSVEsZ0JBQWdCTixVQUFVLENBQUMscUJBQXFCO1FBQ2xELE1BQU1DLFlBQVlYLGlCQUFpQmdCO1FBQ25DLElBQUlMLGFBQWFBLGNBQWNOLGtCQUFrQjtZQUMvQ08sUUFBUUMsS0FBSyxDQUNYLENBQUMsNkNBQTZDLENBQUMsR0FDL0MsQ0FBQywrQkFBK0IsRUFBRVIsaUJBQWlCLEVBQUUsQ0FBQyxHQUN0RCxDQUFDLG1FQUFtRSxFQUFFTSxVQUFVLEVBQUUsQ0FBQyxHQUNuRixDQUFDLDBEQUEwRCxDQUFDLEdBQzVELENBQUMsb0VBQW9FLENBQUMsR0FDdEUsQ0FBQyxhQUFhLEVBQUVBLFVBQVUsSUFBSSxDQUFDLEdBQy9CLENBQUMsb0NBQW9DLEVBQUVOLGlCQUFpQix3QkFBd0IsQ0FBQztRQUVyRjtJQUNGO0lBRUEsSUFBSSxDQUFDVyxtQkFBbUJBLGdCQUFnQkMsSUFBSSxPQUFPLElBQUk7UUFDckQsTUFBTSxJQUFJQyxNQUNSO0lBRUo7SUFFQU4sUUFBUUUsR0FBRyxDQUFDLDhCQUE4QkU7SUFDMUMsT0FBT0E7QUFDVDtBQUVBOzs7Ozs7Ozs7O0NBVUMsR0FDTSxlQUFlRyx5QkFDcEJDLE1BQWMsRUFDZEMsT0FBd0U7SUFFeEUsSUFBSUw7SUFFSixJQUFJO1FBQ0YsNkNBQTZDO1FBQzdDQSxrQkFBa0JiLGVBQWVrQixTQUFTYjtRQUMxQyxNQUFNYyxZQUFZRCxTQUFTQyxhQUFhO1FBQ3hDLE1BQU1DLGNBQWNGLFNBQVNFLGVBQWU7UUFFNUMsTUFBTUMsUUFBUTtZQUNaaEIsU0FBU1E7WUFDVFMsYUFBYTtZQUNiQyxRQUFRO1lBQ1JDLE1BQU1DLEtBQUtDLFNBQVMsQ0FBQztnQkFDbkJDLG1CQUFtQjtnQkFDbkJDLFlBQVlUO2dCQUNaQztnQkFDQVMsVUFBVTtvQkFBQzt3QkFBRUMsTUFBTTt3QkFBUUMsU0FBU2Q7b0JBQU87aUJBQUU7WUFDL0M7UUFDRjtRQUVBLE1BQU1lLFVBQVUsSUFBSTlDLCtFQUFrQkEsQ0FBQ21DO1FBQ3ZDLE1BQU1ZLFdBQVcsTUFBTTlDLDRFQUFhQSxDQUFDK0MsSUFBSSxDQUFDRjtRQUUxQyxxRUFBcUU7UUFDckUsTUFBTUcsVUFBVSxNQUFNLENBQUM7WUFDckIsTUFBTVgsT0FBWSxTQUFrQkEsSUFBSTtZQUN4QyxJQUFJLE9BQU9BLE1BQU1ZLHlCQUF5QixZQUFZO2dCQUNwRCxPQUFPLElBQUlDLGNBQWNDLE1BQU0sQ0FBQyxNQUFNZCxLQUFLWSxvQkFBb0I7WUFDakU7WUFDQSxJQUFJWixnQkFBZ0JlLFlBQVk7Z0JBQzlCLE9BQU8sSUFBSUYsY0FBY0MsTUFBTSxDQUFDZDtZQUNsQztZQUNBLE9BQU9nQixPQUFPaEIsUUFBUTtRQUN4QjtRQUVBLE1BQU1pQixlQUFlaEIsS0FBS2lCLEtBQUssQ0FBQ1AsV0FBVztRQUMzQyxNQUFNUSxhQUFhRixjQUFjVixTQUFTLENBQUMsRUFBRSxFQUFFYSxRQUFRO1FBRXZELE9BQU9EO0lBQ1QsRUFBRSxPQUFPakMsT0FBTztRQUNkLE1BQU1tQyxNQUFNbkMsaUJBQWlCSyxRQUFRTCxNQUFNb0MsT0FBTyxHQUFHO1FBRXJELG1FQUFtRTtRQUNuRSxJQUFJRCxJQUFJRSxRQUFRLENBQUMsd0JBQXdCO1lBQ3ZDdEMsUUFBUUMsS0FBSyxDQUFDLDZDQUE2Q0csbUJBQW1CLFdBQVdIO1FBQzNGO1FBRUEsbUVBQW1FO1FBQ25FLElBQUltQyxJQUFJRSxRQUFRLENBQUMsa0NBQWtDRixJQUFJRSxRQUFRLENBQUMsOEJBQThCO1lBQzVGLE1BQU0sSUFBSWhDLE1BQU07UUFDbEI7UUFDQSxJQUFJOEIsSUFBSUUsUUFBUSxDQUFDLHdCQUF3QjtZQUN2QyxNQUFNLElBQUloQyxNQUFNLG1DQUFtQzhCO1FBQ3JEO1FBQ0EsSUFBSUEsSUFBSUUsUUFBUSxDQUFDLDZCQUE2QkYsSUFBSUUsUUFBUSxDQUFDLHdCQUF3QjtZQUNqRixNQUFNLElBQUloQyxNQUFNO1FBQ2xCO1FBQ0EsSUFBSThCLElBQUlFLFFBQVEsQ0FBQywwQkFBMEI7WUFDekMsTUFBTSxJQUFJaEMsTUFBTTtRQUNsQjtRQUVBLE1BQU0sSUFBSUEsTUFBTSxnQ0FBZ0M4QjtJQUNsRDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGVtZWRpY2EtY2xpbmljLW9jci8uL3NyYy9zZXJ2aWNlcy9iZWRyb2NrQ2xpZW50LnRzPzA3YTQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW52b2tlTW9kZWxDb21tYW5kIH0gZnJvbSBcIkBhd3Mtc2RrL2NsaWVudC1iZWRyb2NrLXJ1bnRpbWVcIjtcclxuaW1wb3J0IHtcclxuICBiZWRyb2NrQ2xpZW50LFxyXG4gIENMQVVERV9PUFVTX01PREVMX0lELFxyXG4gIENMQVVERV9TT05ORVRfTU9ERUxfSUQsXHJcbiAgQ0xBVURFX09QVVNfUFJPRklMRV9BUk4sXHJcbiAgQ0xBVURFX1NPTk5FVF9QUk9GSUxFX0FSTixcclxufSBmcm9tIFwiLi4vLi4vYmVkcm9jay1jb25maWcudHMvYmVkcm9jay1jb25maWdcIjtcclxuXHJcbi8qKlxyXG4gKiBEZWZhdWx0IG1vZGVsIElEIHJlc29sdXRpb24gKG1hdGNoZXMgYmVkcm9jay1jb25maWcudHMgcGF0dGVybilcclxuICogRmFsbHMgYmFjayB0byBDTEFVREVfU09OTkVUX01PREVMX0lEIGlmIG5vIGVudiB2YXIgaXMgc2V0XHJcbiAqL1xyXG5jb25zdCBERUZBVUxUX01PREVMX0lEID1cclxuICBwcm9jZXNzLmVudi5CRURST0NLX0xJR0hUX01PREVMX0lEIHx8XHJcbiAgcHJvY2Vzcy5lbnYuQkVEUk9DS19NT0RFTF9JRCB8fFxyXG4gIENMQVVERV9TT05ORVRfTU9ERUxfSUQ7XHJcblxyXG4vKipcclxuICogRXh0cmFjdHMgcmVnaW9uIGZyb20gYW4gQVdTIEFSTiBvciByZXR1cm5zIHRoZSBjb25maWd1cmVkIHJlZ2lvblxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0UmVnaW9uRnJvbUFybihhcm46IHN0cmluZyk6IHN0cmluZyB8IG51bGwge1xyXG4gIGNvbnN0IG1hdGNoID0gYXJuLm1hdGNoKC9hcm46YXdzOmJlZHJvY2s6KFteOl0rKTovKTtcclxuICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSA6IG51bGw7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiByZXNvbHZlTW9kZWxJZFxyXG4gKiAtLS0tLS0tLS0tLS0tLVxyXG4gKiBSZXNvbHZlcyB0aGUgbW9kZWwgaWRlbnRpZmllciwgYXBwbHlpbmcgaW5mZXJlbmNlIHByb2ZpbGUgQVJOIG1hcHBpbmdcclxuICogd2hlbiBhcHByb3ByaWF0ZS4gTWF0Y2hlcyB0aGUgcGF0dGVybiB1c2VkIGluIHByb2Nlc3NNZWRpY2FsUmVjb3JkV2l0aENsYXVkZS5cclxuICogXHJcbiAqIElmIERFRkFVTFRfTU9ERUxfSUQgaXMgYWxyZWFkeSBhbiBBUk4sIGl0IHdpbGwgYmUgdXNlZCBkaXJlY3RseS5cclxuICogSWYgaXQncyBhIHBsYWluIG1vZGVsIElELCBpdCB3aWxsIGJlIG1hcHBlZCB0byBhIHByb2ZpbGUgQVJOIGlmIGF2YWlsYWJsZS5cclxuICovXHJcbmZ1bmN0aW9uIHJlc29sdmVNb2RlbElkKHByZWZlcnJlZD86IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgY29uc3QgY29uZmlndXJlZFJlZ2lvbiA9IHByb2Nlc3MuZW52LkFXU19SRUdJT04gfHwgcHJvY2Vzcy5lbnYuQVdTX0JFRFJPQ0tfUkVHSU9OIHx8IFwidXMtZWFzdC0xXCI7XHJcbiAgbGV0IG1vZGVsSWQgPSBwcmVmZXJyZWQgfHwgREVGQVVMVF9NT0RFTF9JRDtcclxuXHJcbiAgLy8gSWYgREVGQVVMVF9NT0RFTF9JRCBpcyBhbHJlYWR5IGFuIEFSTiAoc3RhcnRzIHdpdGggXCJhcm46YXdzOmJlZHJvY2s6XCIpLCB1c2UgaXQgZGlyZWN0bHlcclxuICBjb25zdCBpc0FscmVhZHlBcm4gPSBtb2RlbElkLnN0YXJ0c1dpdGgoXCJhcm46YXdzOmJlZHJvY2s6XCIpO1xyXG5cclxuICBpZiAoaXNBbHJlYWR5QXJuKSB7XHJcbiAgICAvLyBWYWxpZGF0ZSB0aGF0IEFSTiByZWdpb24gbWF0Y2hlcyBjb25maWd1cmVkIHJlZ2lvblxyXG4gICAgY29uc3QgYXJuUmVnaW9uID0gZ2V0UmVnaW9uRnJvbUFybihtb2RlbElkKTtcclxuICAgIGlmIChhcm5SZWdpb24gJiYgYXJuUmVnaW9uICE9PSBjb25maWd1cmVkUmVnaW9uKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXHJcbiAgICAgICAgYFxcbltCZWRyb2NrIE9DUl0g4p2MIFJFR0lPTiBNSVNNQVRDSCBERVRFQ1RFRDpcXG5gICtcclxuICAgICAgICBgICDigKIgWW91ciBBV1NfUkVHSU9OIGlzIHNldCB0bzogJHtjb25maWd1cmVkUmVnaW9ufVxcbmAgK1xyXG4gICAgICAgIGAgIOKAoiBCdXQgeW91ciBpbmZlcmVuY2UgcHJvZmlsZSBBUk4gaXMgZm9yIHJlZ2lvbjogJHthcm5SZWdpb259XFxuYCArXHJcbiAgICAgICAgYCAg4oCiIFRoaXMgV0lMTCBjYXVzZSBcIm1vZGVsIGlkZW50aWZpZXIgaW52YWxpZFwiIGVycm9ycy5cXG5cXG5gICtcclxuICAgICAgICBgU09MVVRJT046IENoYW5nZSBBV1NfUkVHSU9OIGluIC5lbnYubG9jYWwgdG8gbWF0Y2ggdGhlIEFSTiByZWdpb246XFxuYCArXHJcbiAgICAgICAgYCAgQVdTX1JFR0lPTj0ke2FyblJlZ2lvbn1cXG5cXG5gICtcclxuICAgICAgICBgT3IgY3JlYXRlIG5ldyBpbmZlcmVuY2UgcHJvZmlsZXMgaW4gJHtjb25maWd1cmVkUmVnaW9ufSBhbmQgdXBkYXRlIHlvdXIgQVJOcy5cXG5gXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZyhcIltCZWRyb2NrIE9DUl0gVXNpbmcgaW5mZXJlbmNlIHByb2ZpbGUgQVJOOlwiLCBtb2RlbElkLnN1YnN0cmluZygwLCA4MCkgKyBcIi4uLlwiKTtcclxuICAgIHJldHVybiBtb2RlbElkO1xyXG4gIH1cclxuXHJcbiAgLy8gTWFwIHBsYWluIG1vZGVsIElEIOKGkiBpbmZlcmVuY2UgcHJvZmlsZSBBUk4gd2hlbiBhcHByb3ByaWF0ZSAoc2FtZSBsb2dpYyBhcyBiZWRyb2NrLWNvbmZpZy50cylcclxuICBjb25zdCByZXNvbHZlZE1vZGVsSWQgPVxyXG4gICAgbW9kZWxJZCA9PT0gQ0xBVURFX1NPTk5FVF9NT0RFTF9JRCAmJiBDTEFVREVfU09OTkVUX1BST0ZJTEVfQVJOXHJcbiAgICAgID8gQ0xBVURFX1NPTk5FVF9QUk9GSUxFX0FSTlxyXG4gICAgICA6IG1vZGVsSWQgPT09IENMQVVERV9PUFVTX01PREVMX0lEICYmIENMQVVERV9PUFVTX1BST0ZJTEVfQVJOXHJcbiAgICAgID8gQ0xBVURFX09QVVNfUFJPRklMRV9BUk5cclxuICAgICAgOiBtb2RlbElkO1xyXG5cclxuICAvLyBJZiByZXNvbHZlZCB0byBhbiBBUk4sIGNoZWNrIHJlZ2lvbiBtYXRjaFxyXG4gIGlmIChyZXNvbHZlZE1vZGVsSWQuc3RhcnRzV2l0aChcImFybjphd3M6YmVkcm9jazpcIikpIHtcclxuICAgIGNvbnN0IGFyblJlZ2lvbiA9IGdldFJlZ2lvbkZyb21Bcm4ocmVzb2x2ZWRNb2RlbElkKTtcclxuICAgIGlmIChhcm5SZWdpb24gJiYgYXJuUmVnaW9uICE9PSBjb25maWd1cmVkUmVnaW9uKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXHJcbiAgICAgICAgYFxcbltCZWRyb2NrIE9DUl0g4p2MIFJFR0lPTiBNSVNNQVRDSCBERVRFQ1RFRDpcXG5gICtcclxuICAgICAgICBgICDigKIgWW91ciBBV1NfUkVHSU9OIGlzIHNldCB0bzogJHtjb25maWd1cmVkUmVnaW9ufVxcbmAgK1xyXG4gICAgICAgIGAgIOKAoiBCdXQgeW91ciBwcm9maWxlIEFSTiAoZnJvbSBCRURST0NLX1BST0ZJTEVfQVJOKSBpcyBmb3IgcmVnaW9uOiAke2FyblJlZ2lvbn1cXG5gICtcclxuICAgICAgICBgICDigKIgVGhpcyBXSUxMIGNhdXNlIFwibW9kZWwgaWRlbnRpZmllciBpbnZhbGlkXCIgZXJyb3JzLlxcblxcbmAgK1xyXG4gICAgICAgIGBTT0xVVElPTjogQ2hhbmdlIEFXU19SRUdJT04gaW4gLmVudi5sb2NhbCB0byBtYXRjaCB0aGUgQVJOIHJlZ2lvbjpcXG5gICtcclxuICAgICAgICBgICBBV1NfUkVHSU9OPSR7YXJuUmVnaW9ufVxcblxcbmAgK1xyXG4gICAgICAgIGBPciBjcmVhdGUgbmV3IGluZmVyZW5jZSBwcm9maWxlcyBpbiAke2NvbmZpZ3VyZWRSZWdpb259IGFuZCB1cGRhdGUgeW91ciBBUk5zLlxcbmBcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlmICghcmVzb2x2ZWRNb2RlbElkIHx8IHJlc29sdmVkTW9kZWxJZC50cmltKCkgPT09IFwiXCIpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihcclxuICAgICAgXCJObyBCZWRyb2NrIG1vZGVsIGNvbmZpZ3VyZWQuIFNldCBCRURST0NLX0xJR0hUX01PREVMX0lEIG9yIEJFRFJPQ0tfTU9ERUxfSUQgaW4gLmVudi5sb2NhbC5cIlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGNvbnNvbGUubG9nKFwiW0JlZHJvY2sgT0NSXSBVc2luZyBtb2RlbDpcIiwgcmVzb2x2ZWRNb2RlbElkKTtcclxuICByZXR1cm4gcmVzb2x2ZWRNb2RlbElkO1xyXG59XHJcblxyXG4vKipcclxuICogY2FsbEJlZHJvY2tGb3JFeHRyYWN0aW9uXHJcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gKiBJbnZva2VzIENsYXVkZSBvbiBBV1MgQmVkcm9jayB3aXRoIHRoZSBwcm92aWRlZCBwcm9tcHQgYW5kIHJldHVybnNcclxuICogdGhlIHBsYWluLXRleHQgcmVzcG9uc2UgYm9keS4gVXNlcyB0aGUgc2hhcmVkIGJlZHJvY2tDbGllbnQgZnJvbVxyXG4gKiBiZWRyb2NrLWNvbmZpZy50cyB0byBlbnN1cmUgcmVnaW9uIGFuZCBjcmVkZW50aWFscyBtYXRjaCB0aGUgd29ya2luZ1xyXG4gKiBtZWRpY2FsIHJlY29yZHMgcHJvY2Vzc2luZyBjb2RlLlxyXG4gKlxyXG4gKiBNYXRjaGVzIHRoZSBBbnRocm9waWMgcGF5bG9hZCBmb3JtYXQgYW5kIG1vZGVsIHJlc29sdXRpb24gcGF0dGVyblxyXG4gKiBmcm9tIHByb2Nlc3NNZWRpY2FsUmVjb3JkV2l0aENsYXVkZS5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYWxsQmVkcm9ja0ZvckV4dHJhY3Rpb24oXHJcbiAgcHJvbXB0OiBzdHJpbmcsXHJcbiAgb3B0aW9ucz86IHsgbW9kZWxJZD86IHN0cmluZzsgbWF4VG9rZW5zPzogbnVtYmVyOyB0ZW1wZXJhdHVyZT86IG51bWJlciB9XHJcbik6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgbGV0IHJlc29sdmVkTW9kZWxJZDogc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICAvLyBSZXNvbHZlIG1vZGVsIElEIGZpcnN0ICh0aHJvd3MgaWYgbWlzc2luZylcclxuICAgIHJlc29sdmVkTW9kZWxJZCA9IHJlc29sdmVNb2RlbElkKG9wdGlvbnM/Lm1vZGVsSWQpO1xyXG4gICAgY29uc3QgbWF4VG9rZW5zID0gb3B0aW9ucz8ubWF4VG9rZW5zID8/IDQwMDA7XHJcbiAgICBjb25zdCB0ZW1wZXJhdHVyZSA9IG9wdGlvbnM/LnRlbXBlcmF0dXJlID8/IDAuMjtcclxuXHJcbiAgICBjb25zdCBpbnB1dCA9IHtcclxuICAgICAgbW9kZWxJZDogcmVzb2x2ZWRNb2RlbElkLFxyXG4gICAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgIGFjY2VwdDogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBhbnRocm9waWNfdmVyc2lvbjogXCJiZWRyb2NrLTIwMjMtMDUtMzFcIixcclxuICAgICAgICBtYXhfdG9rZW5zOiBtYXhUb2tlbnMsXHJcbiAgICAgICAgdGVtcGVyYXR1cmUsXHJcbiAgICAgICAgbWVzc2FnZXM6IFt7IHJvbGU6IFwidXNlclwiLCBjb250ZW50OiBwcm9tcHQgfV0sXHJcbiAgICAgIH0pLFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEludm9rZU1vZGVsQ29tbWFuZChpbnB1dCk7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGJlZHJvY2tDbGllbnQuc2VuZChjb21tYW5kKTtcclxuXHJcbiAgICAvLyBDb252ZXJ0IHJhdyByZXNwb25zZSBpbnRvIHRleHQgKHNhbWUgcGF0dGVybiBhcyBiZWRyb2NrLWNvbmZpZy50cylcclxuICAgIGNvbnN0IHJhd1RleHQgPSBhd2FpdCAoYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBib2R5OiBhbnkgPSAocmVzcG9uc2UgYXMgYW55KS5ib2R5O1xyXG4gICAgICBpZiAodHlwZW9mIGJvZHk/LnRyYW5zZm9ybVRvQnl0ZUFycmF5ID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGF3YWl0IGJvZHkudHJhbnNmb3JtVG9CeXRlQXJyYXkoKSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShib2R5KTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gU3RyaW5nKGJvZHkgPz8gXCJcIik7XHJcbiAgICB9KSgpO1xyXG5cclxuICAgIGNvbnN0IHJlc3BvbnNlQm9keSA9IEpTT04ucGFyc2UocmF3VGV4dCB8fCBcInt9XCIpO1xyXG4gICAgY29uc3QgY2xhdWRlVGV4dCA9IHJlc3BvbnNlQm9keT8uY29udGVudD8uWzBdPy50ZXh0IHx8IFwiXCI7XHJcblxyXG4gICAgcmV0dXJuIGNsYXVkZVRleHQ7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnN0IG1zZyA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCI7XHJcbiAgICBcclxuICAgIC8vIEluY2x1ZGUgcmVzb2x2ZWQgbW9kZWwgSUQgaW4gdmFsaWRhdGlvbiBlcnJvciBsb2dzIGZvciBkZWJ1Z2dpbmdcclxuICAgIGlmIChtc2cuaW5jbHVkZXMoXCJWYWxpZGF0aW9uRXhjZXB0aW9uXCIpKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbQmVkcm9jayBPQ1JdIFZhbGlkYXRpb24gZXJyb3IgZm9yIG1vZGVsOlwiLCByZXNvbHZlZE1vZGVsSWQgfHwgXCJ1bmtub3duXCIsIGVycm9yKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSZS10aHJvdyB3aXRoIGNvbnRleHQgKG1hdGNoZXMgYmVkcm9jay1jb25maWcudHMgZXJyb3IgaGFuZGxpbmcpXHJcbiAgICBpZiAobXNnLmluY2x1ZGVzKFwiVW5yZWNvZ25pemVkQ2xpZW50RXhjZXB0aW9uXCIpIHx8IG1zZy5pbmNsdWRlcyhcIkludmFsaWRTaWduYXR1cmVFeGNlcHRpb25cIikpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQVdTIEJlZHJvY2sgYXV0aGVudGljYXRpb24gZmFpbGVkLlwiKTtcclxuICAgIH1cclxuICAgIGlmIChtc2cuaW5jbHVkZXMoXCJWYWxpZGF0aW9uRXhjZXB0aW9uXCIpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkFXUyBCZWRyb2NrIHZhbGlkYXRpb24gZXJyb3I6IFwiICsgbXNnKTtcclxuICAgIH1cclxuICAgIGlmIChtc2cuaW5jbHVkZXMoXCJNb2RlbE5vdFJlYWR5RXhjZXB0aW9uXCIpIHx8IG1zZy5pbmNsdWRlcyhcIlRocm90dGxpbmdFeGNlcHRpb25cIikpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQVdTIEJlZHJvY2sgdGVtcG9yYXJpbHkgdW5hdmFpbGFibGUuXCIpO1xyXG4gICAgfVxyXG4gICAgaWYgKG1zZy5pbmNsdWRlcyhcIkFjY2Vzc0RlbmllZEV4Y2VwdGlvblwiKSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQZXJtaXNzaW9uIGRlbmllZCBmb3IgQVdTIEJlZHJvY2suXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIHRocm93IG5ldyBFcnJvcihcIkJlZHJvY2sgZXh0cmFjdGlvbiBmYWlsZWQ6IFwiICsgbXNnKTtcclxuICB9XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6WyJJbnZva2VNb2RlbENvbW1hbmQiLCJiZWRyb2NrQ2xpZW50IiwiQ0xBVURFX09QVVNfTU9ERUxfSUQiLCJDTEFVREVfU09OTkVUX01PREVMX0lEIiwiQ0xBVURFX09QVVNfUFJPRklMRV9BUk4iLCJDTEFVREVfU09OTkVUX1BST0ZJTEVfQVJOIiwiREVGQVVMVF9NT0RFTF9JRCIsInByb2Nlc3MiLCJlbnYiLCJCRURST0NLX0xJR0hUX01PREVMX0lEIiwiQkVEUk9DS19NT0RFTF9JRCIsImdldFJlZ2lvbkZyb21Bcm4iLCJhcm4iLCJtYXRjaCIsInJlc29sdmVNb2RlbElkIiwicHJlZmVycmVkIiwiY29uZmlndXJlZFJlZ2lvbiIsIkFXU19SRUdJT04iLCJBV1NfQkVEUk9DS19SRUdJT04iLCJtb2RlbElkIiwiaXNBbHJlYWR5QXJuIiwic3RhcnRzV2l0aCIsImFyblJlZ2lvbiIsImNvbnNvbGUiLCJlcnJvciIsImxvZyIsInN1YnN0cmluZyIsInJlc29sdmVkTW9kZWxJZCIsInRyaW0iLCJFcnJvciIsImNhbGxCZWRyb2NrRm9yRXh0cmFjdGlvbiIsInByb21wdCIsIm9wdGlvbnMiLCJtYXhUb2tlbnMiLCJ0ZW1wZXJhdHVyZSIsImlucHV0IiwiY29udGVudFR5cGUiLCJhY2NlcHQiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFudGhyb3BpY192ZXJzaW9uIiwibWF4X3Rva2VucyIsIm1lc3NhZ2VzIiwicm9sZSIsImNvbnRlbnQiLCJjb21tYW5kIiwicmVzcG9uc2UiLCJzZW5kIiwicmF3VGV4dCIsInRyYW5zZm9ybVRvQnl0ZUFycmF5IiwiVGV4dERlY29kZXIiLCJkZWNvZGUiLCJVaW50OEFycmF5IiwiU3RyaW5nIiwicmVzcG9uc2VCb2R5IiwicGFyc2UiLCJjbGF1ZGVUZXh0IiwidGV4dCIsIm1zZyIsIm1lc3NhZ2UiLCJpbmNsdWRlcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/services/bedrockClient.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/normalizer.ts":
/*!************************************!*\
  !*** ./src/services/normalizer.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   normalizePackageRow: () => (/* binding */ normalizePackageRow),\n/* harmony export */   validatePackageBatch: () => (/* binding */ validatePackageBatch)\n/* harmony export */ });\n/* harmony import */ var _lib_validation__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/validation */ \"(rsc)/./src/lib/validation.ts\");\n\nconst REQUIRED_FIELDS = [\n    \"title\",\n    \"hospital_name\",\n    \"treatment_name\",\n    \"price\",\n    \"currency\"\n];\nconst ALLOWED_CURRENCIES = [\n    \"USD\",\n    \"THB\",\n    \"EUR\",\n    \"GBP\",\n    \"SGD\",\n    \"MYR\",\n    \"KRW\"\n];\n/**\r\n * normalizePackageRow\r\n * -------------------\r\n * Cleans and normalizes a partially filled PackageRow object.\r\n * - Trims string fields and normalizes currency codes\r\n * - Parses numeric fields (price, original_price, commission)\r\n * - Applies default booleans/status values\r\n * - Runs fuzzy matching helpers and captures warnings\r\n */ function normalizePackageRow(row) {\n    const warnings = [\n        ...row._meta?.warnings ?? []\n    ];\n    const matcher = {\n        ...row._meta?.matcher ?? {}\n    };\n    const sanitized = {\n        title: normalizeString(row.title),\n        description: normalizeOptional(row.description),\n        details: normalizeOptional(row.details),\n        hospital_name: normalizeString(row.hospital_name),\n        treatment_name: normalizeString(row.treatment_name),\n        sub_treatments: normalizeOptional(row.sub_treatments),\n        price: parseNumber(row.price, \"price\", warnings),\n        original_price: parseOptionalNumber(row.original_price, \"original_price\", warnings),\n        currency: normalizeCurrency(row.currency, warnings),\n        duration: normalizeOptional(row.duration),\n        treatment_category: normalizeOptional(row.treatment_category),\n        anaesthesia: normalizeOptional(row.anaesthesia),\n        commission: parseOptionalNumber(row.commission, \"commission\", warnings),\n        featured: normalizeBoolean(row.featured, false),\n        status: normalizeStatus(row.status, warnings),\n        doctor_name: normalizeOptional(row.doctor_name),\n        is_le_package: normalizeBoolean(row.is_le_package, false),\n        includes: normalizeOptional(row.includes),\n        image_file_id: normalizeOptional(row.image_file_id),\n        hospital_location: normalizeOptional(row.hospital_location),\n        category: normalizeOptional(row.category),\n        hospital_country: normalizeOptional(row.hospital_country),\n        translation_title: normalizeOptional(row.translation_title),\n        translation_description: normalizeOptional(row.translation_description),\n        translation_details: normalizeOptional(row.translation_details),\n        translation: normalizeOptional(row.translation),\n        _meta: {\n            ...row._meta,\n            warnings,\n            matcher\n        }\n    };\n    applyMatching(\"hospital\", sanitized, matcher, warnings);\n    applyMatching(\"treatment\", sanitized, matcher, warnings);\n    return sanitized;\n}\n/**\r\n * validatePackageBatch\r\n * --------------------\r\n * Splits a list of PackageRow objects into valid / warning / invalid buckets.\r\n */ function validatePackageBatch(rows) {\n    const validPackages = [];\n    const packagesWithWarnings = [];\n    const invalidPackages = [];\n    for (const row of rows){\n        const missingRequired = REQUIRED_FIELDS.filter((field)=>{\n            if (field === \"price\") {\n                return row.price === null || row.price === undefined;\n            }\n            return !row[field]?.toString().trim();\n        });\n        if (missingRequired.length) {\n            row._meta = {\n                ...row._meta,\n                warnings: [\n                    ...row._meta?.warnings ?? [],\n                    `Missing required fields: ${missingRequired.join(\", \")}`\n                ]\n            };\n            invalidPackages.push(row);\n            continue;\n        }\n        const hasWarnings = (row._meta?.warnings ?? []).length > 0;\n        if (hasWarnings) {\n            packagesWithWarnings.push(row);\n        } else {\n            validPackages.push(row);\n        }\n    }\n    return {\n        validPackages,\n        packagesWithWarnings,\n        invalidPackages\n    };\n}\nfunction normalizeString(value) {\n    return (value ?? \"\").trim();\n}\nfunction normalizeOptional(value) {\n    const trimmed = (value ?? \"\").trim();\n    return trimmed.length ? trimmed : undefined;\n}\nfunction parseNumber(value, field, warnings) {\n    if (value === null || value === undefined || value === \"\") {\n        warnings.push(`${field} missing; set to null`);\n        return null;\n    }\n    const parsed = Number(value);\n    if (Number.isNaN(parsed)) {\n        warnings.push(`${field} is not a number; set to null`);\n        return null;\n    }\n    return parsed;\n}\nfunction parseOptionalNumber(value, field, warnings) {\n    if (value === null || value === undefined || value === \"\") {\n        return undefined;\n    }\n    const parsed = Number(value);\n    if (Number.isNaN(parsed)) {\n        warnings.push(`${field} is not a number; set to null`);\n        return null;\n    }\n    return parsed;\n}\nfunction normalizeCurrency(value, warnings) {\n    if (!value) {\n        warnings.push(\"currency missing; defaulting to USD\");\n        return \"USD\";\n    }\n    const upper = value.trim().toUpperCase().replace(\"à¸¿\", \"THB\");\n    if (!ALLOWED_CURRENCIES.includes(upper)) {\n        warnings.push(`currency ${value} not supported; defaulting to USD`);\n        return \"USD\";\n    }\n    return upper;\n}\nfunction normalizeBoolean(value, fallback) {\n    if (typeof value === \"boolean\") return value;\n    if (typeof value === \"string\") {\n        const normalized = value.toLowerCase();\n        if ([\n            \"true\",\n            \"1\",\n            \"yes\"\n        ].includes(normalized)) return true;\n        if ([\n            \"false\",\n            \"0\",\n            \"no\"\n        ].includes(normalized)) return false;\n    }\n    if (typeof value === \"number\") {\n        return value === 1;\n    }\n    return fallback;\n}\nfunction normalizeStatus(value, warnings) {\n    if (value === \"active\" || value === \"inactive\") {\n        return value;\n    }\n    warnings.push(\"status missing; defaulting to active\");\n    return \"active\";\n}\nfunction applyMatching(type, row, matcher, warnings) {\n    if (type === \"hospital\" && row.hospital_name) {\n        const result = (0,_lib_validation__WEBPACK_IMPORTED_MODULE_0__.matchHospitalName)(row.hospital_name);\n        matcher.hospitalScore = result.score;\n        if (result.value) {\n            row.hospital_name = result.value;\n        } else if (row.hospital_name) {\n            warnings.push(`Hospital not recognized: ${row.hospital_name}`);\n        }\n    }\n    if (type === \"treatment\" && row.treatment_name) {\n        const result = (0,_lib_validation__WEBPACK_IMPORTED_MODULE_0__.matchTreatmentName)(row.treatment_name);\n        matcher.treatmentScore = result.score;\n        if (result.value) {\n            row.treatment_name = result.value;\n        } else {\n            warnings.push(`Treatment not recognized: ${row.treatment_name}`);\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBa0I7SUFDckQsSUFBSXFELFVBQVUsWUFBWUEsVUFBVSxZQUFZO1FBQzlDLE9BQU9BO0lBQ1Q7SUFDQXJELFNBQVNtRCxJQUFJLENBQUM7SUFDZCxPQUFPO0FBQ1Q7QUFFQSxTQUFTZCxjQUNQMkIsSUFBOEIsRUFDOUJqRSxHQUFlLEVBQ2ZHLE9BQWtELEVBQ2xERixRQUFrQjtJQUVsQixJQUFJZ0UsU0FBUyxjQUFjakUsSUFBSVUsYUFBYSxFQUFFO1FBQzVDLE1BQU13RCxTQUFTdkUsa0VBQWlCQSxDQUFDSyxJQUFJVSxhQUFhO1FBQ2xEUCxRQUFRZ0UsYUFBYSxHQUFHRCxPQUFPRSxLQUFLO1FBQ3BDLElBQUlGLE9BQU9aLEtBQUssRUFBRTtZQUNoQnRELElBQUlVLGFBQWEsR0FBR3dELE9BQU9aLEtBQUs7UUFDbEMsT0FBTyxJQUFJdEQsSUFBSVUsYUFBYSxFQUFFO1lBQzVCVCxTQUFTbUQsSUFBSSxDQUFDLENBQUMseUJBQXlCLEVBQUVwRCxJQUFJVSxhQUFhLENBQUMsQ0FBQztRQUMvRDtJQUNGO0lBRUEsSUFBSXVELFNBQVMsZUFBZWpFLElBQUlXLGNBQWMsRUFBRTtRQUM5QyxNQUFNdUQsU0FBU3RFLG1FQUFrQkEsQ0FBQ0ksSUFBSVcsY0FBYztRQUNwRFIsUUFBUWtFLGNBQWMsR0FBR0gsT0FBT0UsS0FBSztRQUNyQyxJQUFJRixPQUFPWixLQUFLLEVBQUU7WUFDaEJ0RCxJQUFJVyxjQUFjLEdBQUd1RCxPQUFPWixLQUFLO1FBQ25DLE9BQU87WUFDTHJELFNBQVNtRCxJQUFJLENBQUMsQ0FBQywwQkFBMEIsRUFBRXBELElBQUlXLGNBQWMsQ0FBQyxDQUFDO1FBQ2pFO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2xlbWVkaWNhLWNsaW5pYy1vY3IvLi9zcmMvc2VydmljZXMvbm9ybWFsaXplci50cz8yNGRiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgUGFja2FnZVJvd30gZnJvbSBcIkAvbGliL3R5cGVzL29jclwiO1xyXG5pbXBvcnQgeyBtYXRjaEhvc3BpdGFsTmFtZSwgbWF0Y2hUcmVhdG1lbnROYW1lIH0gZnJvbSBcIkAvbGliL3ZhbGlkYXRpb25cIjtcclxuXHJcbmNvbnN0IFJFUVVJUkVEX0ZJRUxEUzogQXJyYXk8a2V5b2YgUGFja2FnZVJvdz4gPSBbXHJcbiAgXCJ0aXRsZVwiLFxyXG4gIFwiaG9zcGl0YWxfbmFtZVwiLFxyXG4gIFwidHJlYXRtZW50X25hbWVcIixcclxuICBcInByaWNlXCIsXHJcbiAgXCJjdXJyZW5jeVwiLFxyXG5dO1xyXG5cclxuY29uc3QgQUxMT1dFRF9DVVJSRU5DSUVTID0gW1wiVVNEXCIsIFwiVEhCXCIsIFwiRVVSXCIsIFwiR0JQXCIsIFwiU0dEXCIsIFwiTVlSXCIsIFwiS1JXXCJdO1xyXG5cclxuLyoqXHJcbiAqIG5vcm1hbGl6ZVBhY2thZ2VSb3dcclxuICogLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gKiBDbGVhbnMgYW5kIG5vcm1hbGl6ZXMgYSBwYXJ0aWFsbHkgZmlsbGVkIFBhY2thZ2VSb3cgb2JqZWN0LlxyXG4gKiAtIFRyaW1zIHN0cmluZyBmaWVsZHMgYW5kIG5vcm1hbGl6ZXMgY3VycmVuY3kgY29kZXNcclxuICogLSBQYXJzZXMgbnVtZXJpYyBmaWVsZHMgKHByaWNlLCBvcmlnaW5hbF9wcmljZSwgY29tbWlzc2lvbilcclxuICogLSBBcHBsaWVzIGRlZmF1bHQgYm9vbGVhbnMvc3RhdHVzIHZhbHVlc1xyXG4gKiAtIFJ1bnMgZnV6enkgbWF0Y2hpbmcgaGVscGVycyBhbmQgY2FwdHVyZXMgd2FybmluZ3NcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVQYWNrYWdlUm93KHJvdzogUGFydGlhbDxQYWNrYWdlUm93Pik6IFBhY2thZ2VSb3cge1xyXG4gIGNvbnN0IHdhcm5pbmdzID0gWy4uLihyb3cuX21ldGE/Lndhcm5pbmdzID8/IFtdKV07XHJcbiAgY29uc3QgbWF0Y2hlciA9IHsgLi4uKHJvdy5fbWV0YT8ubWF0Y2hlciA/PyB7fSkgfTtcclxuXHJcbiAgY29uc3Qgc2FuaXRpemVkOiBQYWNrYWdlUm93ID0ge1xyXG4gICAgdGl0bGU6IG5vcm1hbGl6ZVN0cmluZyhyb3cudGl0bGUpLFxyXG4gICAgZGVzY3JpcHRpb246IG5vcm1hbGl6ZU9wdGlvbmFsKHJvdy5kZXNjcmlwdGlvbiksXHJcbiAgICBkZXRhaWxzOiBub3JtYWxpemVPcHRpb25hbChyb3cuZGV0YWlscyksXHJcbiAgICBob3NwaXRhbF9uYW1lOiBub3JtYWxpemVTdHJpbmcocm93Lmhvc3BpdGFsX25hbWUpLFxyXG4gICAgdHJlYXRtZW50X25hbWU6IG5vcm1hbGl6ZVN0cmluZyhyb3cudHJlYXRtZW50X25hbWUpLFxyXG4gICAgc3ViX3RyZWF0bWVudHM6IG5vcm1hbGl6ZU9wdGlvbmFsKHJvdy5zdWJfdHJlYXRtZW50cyksXHJcbiAgICBwcmljZTogcGFyc2VOdW1iZXIocm93LnByaWNlLCBcInByaWNlXCIsIHdhcm5pbmdzKSxcclxuICAgIG9yaWdpbmFsX3ByaWNlOiBwYXJzZU9wdGlvbmFsTnVtYmVyKHJvdy5vcmlnaW5hbF9wcmljZSwgXCJvcmlnaW5hbF9wcmljZVwiLCB3YXJuaW5ncyksXHJcbiAgICBjdXJyZW5jeTogbm9ybWFsaXplQ3VycmVuY3kocm93LmN1cnJlbmN5LCB3YXJuaW5ncyksXHJcbiAgICBkdXJhdGlvbjogbm9ybWFsaXplT3B0aW9uYWwocm93LmR1cmF0aW9uKSxcclxuICAgIHRyZWF0bWVudF9jYXRlZ29yeTogbm9ybWFsaXplT3B0aW9uYWwocm93LnRyZWF0bWVudF9jYXRlZ29yeSksXHJcbiAgICBhbmFlc3RoZXNpYTogbm9ybWFsaXplT3B0aW9uYWwocm93LmFuYWVzdGhlc2lhKSxcclxuICAgIGNvbW1pc3Npb246IHBhcnNlT3B0aW9uYWxOdW1iZXIocm93LmNvbW1pc3Npb24sIFwiY29tbWlzc2lvblwiLCB3YXJuaW5ncyksXHJcbiAgICBmZWF0dXJlZDogbm9ybWFsaXplQm9vbGVhbihyb3cuZmVhdHVyZWQsIGZhbHNlKSxcclxuICAgIHN0YXR1czogbm9ybWFsaXplU3RhdHVzKHJvdy5zdGF0dXMsIHdhcm5pbmdzKSxcclxuICAgIGRvY3Rvcl9uYW1lOiBub3JtYWxpemVPcHRpb25hbChyb3cuZG9jdG9yX25hbWUpLFxyXG4gICAgaXNfbGVfcGFja2FnZTogbm9ybWFsaXplQm9vbGVhbihyb3cuaXNfbGVfcGFja2FnZSwgZmFsc2UpLFxyXG4gICAgaW5jbHVkZXM6IG5vcm1hbGl6ZU9wdGlvbmFsKHJvdy5pbmNsdWRlcyksXHJcbiAgICBpbWFnZV9maWxlX2lkOiBub3JtYWxpemVPcHRpb25hbChyb3cuaW1hZ2VfZmlsZV9pZCksXHJcbiAgICBob3NwaXRhbF9sb2NhdGlvbjogbm9ybWFsaXplT3B0aW9uYWwocm93Lmhvc3BpdGFsX2xvY2F0aW9uKSxcclxuICAgIGNhdGVnb3J5OiBub3JtYWxpemVPcHRpb25hbChyb3cuY2F0ZWdvcnkpLFxyXG4gICAgaG9zcGl0YWxfY291bnRyeTogbm9ybWFsaXplT3B0aW9uYWwocm93Lmhvc3BpdGFsX2NvdW50cnkpLFxyXG4gICAgdHJhbnNsYXRpb25fdGl0bGU6IG5vcm1hbGl6ZU9wdGlvbmFsKHJvdy50cmFuc2xhdGlvbl90aXRsZSksXHJcbiAgICB0cmFuc2xhdGlvbl9kZXNjcmlwdGlvbjogbm9ybWFsaXplT3B0aW9uYWwocm93LnRyYW5zbGF0aW9uX2Rlc2NyaXB0aW9uKSxcclxuICAgIHRyYW5zbGF0aW9uX2RldGFpbHM6IG5vcm1hbGl6ZU9wdGlvbmFsKHJvdy50cmFuc2xhdGlvbl9kZXRhaWxzKSxcclxuICAgIHRyYW5zbGF0aW9uOiBub3JtYWxpemVPcHRpb25hbChyb3cudHJhbnNsYXRpb24pLFxyXG4gICAgX21ldGE6IHtcclxuICAgICAgLi4ucm93Ll9tZXRhLFxyXG4gICAgICB3YXJuaW5ncyxcclxuICAgICAgbWF0Y2hlcixcclxuICAgIH0sXHJcbiAgfTtcclxuXHJcbiAgYXBwbHlNYXRjaGluZyhcImhvc3BpdGFsXCIsIHNhbml0aXplZCwgbWF0Y2hlciwgd2FybmluZ3MpO1xyXG4gIGFwcGx5TWF0Y2hpbmcoXCJ0cmVhdG1lbnRcIiwgc2FuaXRpemVkLCBtYXRjaGVyLCB3YXJuaW5ncyk7XHJcblxyXG4gIHJldHVybiBzYW5pdGl6ZWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiB2YWxpZGF0ZVBhY2thZ2VCYXRjaFxyXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gKiBTcGxpdHMgYSBsaXN0IG9mIFBhY2thZ2VSb3cgb2JqZWN0cyBpbnRvIHZhbGlkIC8gd2FybmluZyAvIGludmFsaWQgYnVja2V0cy5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVBhY2thZ2VCYXRjaChyb3dzOiBQYWNrYWdlUm93W10pOiB7XHJcbiAgdmFsaWRQYWNrYWdlczogUGFja2FnZVJvd1tdO1xyXG4gIHBhY2thZ2VzV2l0aFdhcm5pbmdzOiBQYWNrYWdlUm93W107XHJcbiAgaW52YWxpZFBhY2thZ2VzOiBQYWNrYWdlUm93W107XHJcbn0ge1xyXG4gIGNvbnN0IHZhbGlkUGFja2FnZXM6IFBhY2thZ2VSb3dbXSA9IFtdO1xyXG4gIGNvbnN0IHBhY2thZ2VzV2l0aFdhcm5pbmdzOiBQYWNrYWdlUm93W10gPSBbXTtcclxuICBjb25zdCBpbnZhbGlkUGFja2FnZXM6IFBhY2thZ2VSb3dbXSA9IFtdO1xyXG5cclxuICBmb3IgKGNvbnN0IHJvdyBvZiByb3dzKSB7XHJcbiAgICBjb25zdCBtaXNzaW5nUmVxdWlyZWQgPSBSRVFVSVJFRF9GSUVMRFMuZmlsdGVyKChmaWVsZCkgPT4ge1xyXG4gICAgICBpZiAoZmllbGQgPT09IFwicHJpY2VcIikge1xyXG4gICAgICAgIHJldHVybiByb3cucHJpY2UgPT09IG51bGwgfHwgcm93LnByaWNlID09PSB1bmRlZmluZWQ7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuICFyb3dbZmllbGRdPy50b1N0cmluZygpLnRyaW0oKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChtaXNzaW5nUmVxdWlyZWQubGVuZ3RoKSB7XHJcbiAgICAgIHJvdy5fbWV0YSA9IHtcclxuICAgICAgICAuLi5yb3cuX21ldGEsXHJcbiAgICAgICAgd2FybmluZ3M6IFtcclxuICAgICAgICAgIC4uLihyb3cuX21ldGE/Lndhcm5pbmdzID8/IFtdKSxcclxuICAgICAgICAgIGBNaXNzaW5nIHJlcXVpcmVkIGZpZWxkczogJHttaXNzaW5nUmVxdWlyZWQuam9pbihcIiwgXCIpfWAsXHJcbiAgICAgICAgXSxcclxuICAgICAgfTtcclxuICAgICAgaW52YWxpZFBhY2thZ2VzLnB1c2gocm93KTtcclxuICAgICAgY29udGludWU7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaGFzV2FybmluZ3MgPSAocm93Ll9tZXRhPy53YXJuaW5ncyA/PyBbXSkubGVuZ3RoID4gMDtcclxuICAgIGlmIChoYXNXYXJuaW5ncykge1xyXG4gICAgICBwYWNrYWdlc1dpdGhXYXJuaW5ncy5wdXNoKHJvdyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB2YWxpZFBhY2thZ2VzLnB1c2gocm93KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiB7IHZhbGlkUGFja2FnZXMsIHBhY2thZ2VzV2l0aFdhcm5pbmdzLCBpbnZhbGlkUGFja2FnZXMgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gbm9ybWFsaXplU3RyaW5nKHZhbHVlOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBzdHJpbmcge1xyXG4gIHJldHVybiAodmFsdWUgPz8gXCJcIikudHJpbSgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBub3JtYWxpemVPcHRpb25hbCh2YWx1ZTogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgY29uc3QgdHJpbW1lZCA9ICh2YWx1ZSA/PyBcIlwiKS50cmltKCk7XHJcbiAgcmV0dXJuIHRyaW1tZWQubGVuZ3RoID8gdHJpbW1lZCA6IHVuZGVmaW5lZDtcclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VOdW1iZXIodmFsdWU6IGFueSwgZmllbGQ6IHN0cmluZywgd2FybmluZ3M6IHN0cmluZ1tdKTogbnVtYmVyIHwgbnVsbCB7XHJcbiAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IFwiXCIpIHtcclxuICAgIHdhcm5pbmdzLnB1c2goYCR7ZmllbGR9IG1pc3Npbmc7IHNldCB0byBudWxsYCk7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbiAgY29uc3QgcGFyc2VkID0gTnVtYmVyKHZhbHVlKTtcclxuICBpZiAoTnVtYmVyLmlzTmFOKHBhcnNlZCkpIHtcclxuICAgIHdhcm5pbmdzLnB1c2goYCR7ZmllbGR9IGlzIG5vdCBhIG51bWJlcjsgc2V0IHRvIG51bGxgKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuICByZXR1cm4gcGFyc2VkO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwYXJzZU9wdGlvbmFsTnVtYmVyKFxyXG4gIHZhbHVlOiBhbnksXHJcbiAgZmllbGQ6IHN0cmluZyxcclxuICB3YXJuaW5nczogc3RyaW5nW11cclxuKTogbnVtYmVyIHwgbnVsbCB8IHVuZGVmaW5lZCB7XHJcbiAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IFwiXCIpIHtcclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgfVxyXG4gIGNvbnN0IHBhcnNlZCA9IE51bWJlcih2YWx1ZSk7XHJcbiAgaWYgKE51bWJlci5pc05hTihwYXJzZWQpKSB7XHJcbiAgICB3YXJuaW5ncy5wdXNoKGAke2ZpZWxkfSBpcyBub3QgYSBudW1iZXI7IHNldCB0byBudWxsYCk7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbiAgcmV0dXJuIHBhcnNlZDtcclxufVxyXG5cclxuZnVuY3Rpb24gbm9ybWFsaXplQ3VycmVuY3kodmFsdWU6IHN0cmluZyB8IHVuZGVmaW5lZCwgd2FybmluZ3M6IHN0cmluZ1tdKTogc3RyaW5nIHtcclxuICBpZiAoIXZhbHVlKSB7XHJcbiAgICB3YXJuaW5ncy5wdXNoKFwiY3VycmVuY3kgbWlzc2luZzsgZGVmYXVsdGluZyB0byBVU0RcIik7XHJcbiAgICByZXR1cm4gXCJVU0RcIjtcclxuICB9XHJcbiAgY29uc3QgdXBwZXIgPSB2YWx1ZS50cmltKCkudG9VcHBlckNhc2UoKS5yZXBsYWNlKFwi4Li/XCIsIFwiVEhCXCIpO1xyXG4gIGlmICghQUxMT1dFRF9DVVJSRU5DSUVTLmluY2x1ZGVzKHVwcGVyKSkge1xyXG4gICAgd2FybmluZ3MucHVzaChgY3VycmVuY3kgJHt2YWx1ZX0gbm90IHN1cHBvcnRlZDsgZGVmYXVsdGluZyB0byBVU0RgKTtcclxuICAgIHJldHVybiBcIlVTRFwiO1xyXG4gIH1cclxuICByZXR1cm4gdXBwZXI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG5vcm1hbGl6ZUJvb2xlYW4odmFsdWU6IGFueSwgZmFsbGJhY2s6IGJvb2xlYW4pOiBib29sZWFuIHtcclxuICBpZiAodHlwZW9mIHZhbHVlID09PSBcImJvb2xlYW5cIikgcmV0dXJuIHZhbHVlO1xyXG4gIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIHtcclxuICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSB2YWx1ZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgaWYgKFtcInRydWVcIiwgXCIxXCIsIFwieWVzXCJdLmluY2x1ZGVzKG5vcm1hbGl6ZWQpKSByZXR1cm4gdHJ1ZTtcclxuICAgIGlmIChbXCJmYWxzZVwiLCBcIjBcIiwgXCJub1wiXS5pbmNsdWRlcyhub3JtYWxpemVkKSkgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuICBpZiAodHlwZW9mIHZhbHVlID09PSBcIm51bWJlclwiKSB7XHJcbiAgICByZXR1cm4gdmFsdWUgPT09IDE7XHJcbiAgfVxyXG4gIHJldHVybiBmYWxsYmFjaztcclxufVxyXG5cclxuZnVuY3Rpb24gbm9ybWFsaXplU3RhdHVzKHZhbHVlOiBhbnksIHdhcm5pbmdzOiBzdHJpbmdbXSk6IFwiYWN0aXZlXCIgfCBcImluYWN0aXZlXCIge1xyXG4gIGlmICh2YWx1ZSA9PT0gXCJhY3RpdmVcIiB8fCB2YWx1ZSA9PT0gXCJpbmFjdGl2ZVwiKSB7XHJcbiAgICByZXR1cm4gdmFsdWU7XHJcbiAgfVxyXG4gIHdhcm5pbmdzLnB1c2goXCJzdGF0dXMgbWlzc2luZzsgZGVmYXVsdGluZyB0byBhY3RpdmVcIik7XHJcbiAgcmV0dXJuIFwiYWN0aXZlXCI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFwcGx5TWF0Y2hpbmcoXHJcbiAgdHlwZTogXCJob3NwaXRhbFwiIHwgXCJ0cmVhdG1lbnRcIixcclxuICByb3c6IFBhY2thZ2VSb3csXHJcbiAgbWF0Y2hlcjogUmVjb3JkPHN0cmluZywgbnVtYmVyIHwgbnVsbCB8IHVuZGVmaW5lZD4sXHJcbiAgd2FybmluZ3M6IHN0cmluZ1tdXHJcbikge1xyXG4gIGlmICh0eXBlID09PSBcImhvc3BpdGFsXCIgJiYgcm93Lmhvc3BpdGFsX25hbWUpIHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IG1hdGNoSG9zcGl0YWxOYW1lKHJvdy5ob3NwaXRhbF9uYW1lKTtcclxuICAgIG1hdGNoZXIuaG9zcGl0YWxTY29yZSA9IHJlc3VsdC5zY29yZTtcclxuICAgIGlmIChyZXN1bHQudmFsdWUpIHtcclxuICAgICAgcm93Lmhvc3BpdGFsX25hbWUgPSByZXN1bHQudmFsdWU7XHJcbiAgICB9IGVsc2UgaWYgKHJvdy5ob3NwaXRhbF9uYW1lKSB7XHJcbiAgICAgIHdhcm5pbmdzLnB1c2goYEhvc3BpdGFsIG5vdCByZWNvZ25pemVkOiAke3Jvdy5ob3NwaXRhbF9uYW1lfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaWYgKHR5cGUgPT09IFwidHJlYXRtZW50XCIgJiYgcm93LnRyZWF0bWVudF9uYW1lKSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBtYXRjaFRyZWF0bWVudE5hbWUocm93LnRyZWF0bWVudF9uYW1lKTtcclxuICAgIG1hdGNoZXIudHJlYXRtZW50U2NvcmUgPSByZXN1bHQuc2NvcmU7XHJcbiAgICBpZiAocmVzdWx0LnZhbHVlKSB7XHJcbiAgICAgIHJvdy50cmVhdG1lbnRfbmFtZSA9IHJlc3VsdC52YWx1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHdhcm5pbmdzLnB1c2goYFRyZWF0bWVudCBub3QgcmVjb2duaXplZDogJHtyb3cudHJlYXRtZW50X25hbWV9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4iXSwibmFtZXMiOlsibWF0Y2hIb3NwaXRhbE5hbWUiLCJtYXRjaFRyZWF0bWVudE5hbWUiLCJSRVFVSVJFRF9GSUVMRFMiLCJBTExPV0VEX0NVUlJFTkNJRVMiLCJub3JtYWxpemVQYWNrYWdlUm93Iiwicm93Iiwid2FybmluZ3MiLCJfbWV0YSIsIm1hdGNoZXIiLCJzYW5pdGl6ZWQiLCJ0aXRsZSIsIm5vcm1hbGl6ZVN0cmluZyIsImRlc2NyaXB0aW9uIiwibm9ybWFsaXplT3B0aW9uYWwiLCJkZXRhaWxzIiwiaG9zcGl0YWxfbmFtZSIsInRyZWF0bWVudF9uYW1lIiwic3ViX3RyZWF0bWVudHMiLCJwcmljZSIsInBhcnNlTnVtYmVyIiwib3JpZ2luYWxfcHJpY2UiLCJwYXJzZU9wdGlvbmFsTnVtYmVyIiwiY3VycmVuY3kiLCJub3JtYWxpemVDdXJyZW5jeSIsImR1cmF0aW9uIiwidHJlYXRtZW50X2NhdGVnb3J5IiwiYW5hZXN0aGVzaWEiLCJjb21taXNzaW9uIiwiZmVhdHVyZWQiLCJub3JtYWxpemVCb29sZWFuIiwic3RhdHVzIiwibm9ybWFsaXplU3RhdHVzIiwiZG9jdG9yX25hbWUiLCJpc19sZV9wYWNrYWdlIiwiaW5jbHVkZXMiLCJpbWFnZV9maWxlX2lkIiwiaG9zcGl0YWxfbG9jYXRpb24iLCJjYXRlZ29yeSIsImhvc3BpdGFsX2NvdW50cnkiLCJ0cmFuc2xhdGlvbl90aXRsZSIsInRyYW5zbGF0aW9uX2Rlc2NyaXB0aW9uIiwidHJhbnNsYXRpb25fZGV0YWlscyIsInRyYW5zbGF0aW9uIiwiYXBwbHlNYXRjaGluZyIsInZhbGlkYXRlUGFja2FnZUJhdGNoIiwicm93cyIsInZhbGlkUGFja2FnZXMiLCJwYWNrYWdlc1dpdGhXYXJuaW5ncyIsImludmFsaWRQYWNrYWdlcyIsIm1pc3NpbmdSZXF1aXJlZCIsImZpbHRlciIsImZpZWxkIiwidW5kZWZpbmVkIiwidG9TdHJpbmciLCJ0cmltIiwibGVuZ3RoIiwiam9pbiIsInB1c2giLCJoYXNXYXJuaW5ncyIsInZhbHVlIiwidHJpbW1lZCIsInBhcnNlZCIsIk51bWJlciIsImlzTmFOIiwidXBwZXIiLCJ0b1VwcGVyQ2FzZSIsInJlcGxhY2UiLCJmYWxsYmFjayIsIm5vcm1hbGl6ZWQiLCJ0b0xvd2VyQ2FzZSIsInR5cGUiLCJyZXN1bHQiLCJob3NwaXRhbFNjb3JlIiwic2NvcmUiLCJ0cmVhdG1lbnRTY29yZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/services/normalizer.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/ocr.ts":
/*!*****************************!*\
  !*** ./src/services/ocr.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handleUploadAndExtractOcr: () => (/* binding */ handleUploadAndExtractOcr),\n/* harmony export */   runOcrOnFiles: () => (/* binding */ runOcrOnFiles)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var tesseract_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! tesseract.js */ \"tesseract.js\");\n/* harmony import */ var tesseract_js__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(tesseract_js__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var pdf_parse__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! pdf-parse */ \"(rsc)/./node_modules/pdf-parse/index.js\");\n/* harmony import */ var pdf_parse__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(pdf_parse__WEBPACK_IMPORTED_MODULE_4__);\n\n\n\n\n\n\nconst OCR_DEBUG_DIR = (0,path__WEBPACK_IMPORTED_MODULE_1__.join)(process.cwd(), \"tmp\", \"ocr-debug\");\n// Toggle with an env var so prod isnâ€™t spammed\nconst OCR_DEBUG_ENABLED = process.env.OCR_DEBUG === \"1\";\nconst TEMP_DIR = (0,path__WEBPACK_IMPORTED_MODULE_1__.join)(process.cwd(), \"tmp\", \"ocr-uploads\");\nconst MAX_FILE_SIZE_BYTES = Number(process.env.OCR_MAX_FILE_MB || 25) * 1024 * 1024;\nconst ALLOWED_MIME_TYPES = new Set([\n    \"application/pdf\",\n    \"image/jpeg\",\n    \"image/png\",\n    \"image/heic\",\n    \"image/heif\"\n]);\n// -----------------------------------------------------------------------------\n// OCR language + timeout config\n// -----------------------------------------------------------------------------\n// Languages for Tesseract OCR.\n// IMPORTANT: More languages = heavier + slower.\nconst OCR_LANGS = \"eng+chi_sim\";\n// Max time (ms) we are willing to wait for a single OCR call.\nconst OCR_TIMEOUT_MS = Number(process.env.OCR_TIMEOUT_MS || 150000);\n/**\r\n * handleUploadAndExtractOcr\r\n * -------------------------\r\n * Accepts uploaded files from a NextRequest, validates them, writes the content\r\n * to a temp folder, runs OCR per page, and returns a list of OcrPage objects.\r\n */ async function handleUploadAndExtractOcr(req) {\n    ensureTempDirectory();\n    // ðŸ”¹ Generate the batch ID ONCE and reuse it everywhere\n    const batchId = generateFriendlyBatchId();\n    const formData = await req.formData();\n    const incomingFiles = extractFilesFromFormData(formData);\n    if (!incomingFiles.length) {\n        throw createHttpError(400, \"No file provided. Please append `file` or `files[]` to FormData.\");\n    }\n    const savedFiles = [];\n    for (const file of incomingFiles){\n        if (!ALLOWED_MIME_TYPES.has(file.type)) {\n            throw createHttpError(400, \"Unsupported file type. Please upload PDF, JPG, PNG, or HEIC.\");\n        }\n        if (file.size > MAX_FILE_SIZE_BYTES) {\n            throw createHttpError(413, `File exceeds the maximum allowed size of ${Math.round(MAX_FILE_SIZE_BYTES / (1024 * 1024))} MB.`);\n        }\n        const fileId = (0,crypto__WEBPACK_IMPORTED_MODULE_2__.randomUUID)();\n        // ðŸ”¹ Use only the last path segment (strip folder parts)\n        const originalName = file.name || `upload-${fileId}`;\n        const baseName = originalName.split(/[\\\\/]/).pop() || originalName;\n        // ðŸ”¹ Sanitize for filesystem (no weird chars / slashes)\n        const safeName = baseName.replace(/[^\\w.\\-]+/g, \"_\");\n        const tempPath = (0,path__WEBPACK_IMPORTED_MODULE_1__.join)(TEMP_DIR, `${fileId}-${safeName}`);\n        const buffer = Buffer.from(await file.arrayBuffer());\n        await fs__WEBPACK_IMPORTED_MODULE_0__.promises.writeFile(tempPath, buffer);\n        savedFiles.push({\n            fileId,\n            fileName: baseName,\n            mimeType: file.type,\n            path: tempPath\n        });\n    }\n    const ocrPages = await runOcrOnFiles(savedFiles);\n    const filesMeta = summarizeFiles(savedFiles, ocrPages);\n    // ðŸ”¹ Only valid now because batchId is defined above\n    if (OCR_DEBUG_ENABLED) {\n        await saveOcrDebugSnapshot(batchId, ocrPages);\n    }\n    return {\n        batchId,\n        ocrPages,\n        filesMeta\n    };\n}\n/**\r\n * runOcrOnFiles\r\n * --------------\r\n * Runs OCR on each page of the uploaded files and returns\r\n * OcrPage objects that retain page ordering and metadata.\r\n */ async function runOcrOnFiles(files) {\n    const pages = [];\n    for (const file of files){\n        if (file.mimeType === \"application/pdf\") {\n            const pdfPages = await runOcrOnPdf(file);\n            pages.push(...pdfPages);\n            continue;\n        }\n        // Image file: use Tesseract directly with multi-language support\n        const buffer = await fs__WEBPACK_IMPORTED_MODULE_0__.promises.readFile(file.path);\n        const text = await runTesseract(buffer);\n        pages.push({\n            fileId: file.fileId,\n            fileName: file.fileName,\n            pageNumber: 1,\n            rawText: cleanText(text)\n        });\n    }\n    return pages;\n}\n// Debugs txts\nasync function saveOcrDebugSnapshot(batchId, pages) {\n    try {\n        (0,fs__WEBPACK_IMPORTED_MODULE_0__.mkdirSync)(OCR_DEBUG_DIR, {\n            recursive: true\n        });\n        // Per-page debug files\n        for (const page of pages){\n            const safeFile = page.fileName.replace(/[^\\w.-]+/g, \"_\");\n            const debugName = `${batchId}_p${page.pageNumber}_${safeFile}.txt`;\n            const debugPath = (0,path__WEBPACK_IMPORTED_MODULE_1__.join)(OCR_DEBUG_DIR, debugName);\n            const content = `BATCH: ${batchId}\\n` + `FILE:  ${page.fileName}\\n` + `PAGE:  ${page.pageNumber}\\n` + `----------------------------------------\\n` + page.rawText;\n            await fs__WEBPACK_IMPORTED_MODULE_0__.promises.writeFile(debugPath, content, \"utf8\");\n        }\n        // Aggregated per-file debug\n        const pagesByFile = new Map();\n        for (const page of pages){\n            const key = page.fileName;\n            if (!pagesByFile.has(key)) pagesByFile.set(key, []);\n            pagesByFile.get(key).push(page);\n        }\n        for (const [fileName, filePages] of pagesByFile.entries()){\n            const safeFile = fileName.replace(/[^\\w.-]+/g, \"_\");\n            const debugName = `${batchId}_FILE_${safeFile}.txt`;\n            const debugPath = (0,path__WEBPACK_IMPORTED_MODULE_1__.join)(OCR_DEBUG_DIR, debugName);\n            const content = `BATCH: ${batchId}\\n` + `FILE:  ${fileName}\\n` + `PAGES: ${filePages.length}\\n` + `========================================\\n\\n` + filePages.sort((a, b)=>a.pageNumber - b.pageNumber).map((p)=>`--- PAGE ${p.pageNumber} ---\\n${p.rawText}\\n`).join(\"\\n\");\n            await fs__WEBPACK_IMPORTED_MODULE_0__.promises.writeFile(debugPath, content, \"utf8\");\n        }\n        console.log(`[OCR DEBUG] Saved page-level + file-level text for batch ${batchId} to ${OCR_DEBUG_DIR}`);\n    } catch (err) {\n        console.error(\"[OCR DEBUG] Failed to save snapshot:\", err);\n    }\n}\n/**\r\n * runOcrOnPdf\r\n * -----------\r\n * Uses pdf-parse to extract text per page.\r\n * If pdf-parse returns nothing, we still emit one empty page entry.\r\n */ async function runOcrOnPdf(file) {\n    const buffer = await fs__WEBPACK_IMPORTED_MODULE_0__.promises.readFile(file.path);\n    const pageTexts = [];\n    const options = {\n        pagerender: async (pageData)=>{\n            const textContent = await pageData.getTextContent();\n            const textItems = textContent.items.map((item)=>item?.str ?? \"\").join(\" \");\n            const cleaned = cleanText(textItems);\n            pageTexts.push(cleaned);\n            return cleaned;\n        }\n    };\n    const parsed = await pdf_parse__WEBPACK_IMPORTED_MODULE_4___default()(buffer, options);\n    // Fallback: if pagerender didn't push anything but parsed.text exists,\n    // split by blank lines to approximate pages/sections.\n    if (!pageTexts.length && parsed.text) {\n        parsed.text.split(/\\n{2,}/).map((chunk)=>cleanText(chunk)).filter(Boolean).forEach((chunk)=>pageTexts.push(chunk));\n    }\n    // Still nothing? Emit a single empty page\n    if (!pageTexts.length) {\n        pageTexts.push(\"\");\n    }\n    return pageTexts.map((rawText, index)=>({\n            fileId: file.fileId,\n            fileName: file.fileName,\n            pageNumber: index + 1,\n            rawText\n        }));\n}\n/**\r\n * runTesseract\r\n * ------------\r\n * Uses a Tesseract.js worker with an explicit workerPath so it\r\n * doesn't try to load from `.next/worker-script/...`.\r\n */ async function runTesseract(buffer) {\n    // ðŸ”¹ Point directly at the Node worker in node_modules\n    const worker = await (0,tesseract_js__WEBPACK_IMPORTED_MODULE_3__.createWorker)(OCR_LANGS, 1, {\n        workerPath: \"./node_modules/tesseract.js/src/worker-script/node/index.js\"\n    });\n    try {\n        await worker.load();\n        const recognizePromise = worker.recognize(buffer);\n        const timeoutPromise = new Promise((_, reject)=>{\n            setTimeout(()=>reject(new Error(`Tesseract OCR timed out after ${OCR_TIMEOUT_MS} ms (languages: ${OCR_LANGS})`)), OCR_TIMEOUT_MS);\n        });\n        const result = await Promise.race([\n            recognizePromise,\n            timeoutPromise\n        ]);\n        return result.data?.text || \"\";\n    } finally{\n        // Ensure worker is cleaned up even on timeout/error\n        try {\n            await worker.terminate();\n        } catch  {\n        // ignore\n        }\n    }\n}\n/**\r\n * cleanText\r\n * ---------\r\n * Normalizes whitespace but preserves line breaks so that menu items\r\n * remain visually separated for the LLM.\r\n */ function cleanText(text) {\n    return text.replace(/\\r\\n/g, \"\\n\") // normalise Windows line endings\n    .replace(/\\r/g, \"\\n\").replace(/[ \\t]+/g, \" \") // collapse spaces/tabs\n    .replace(/\\n{2,}/g, \"\\n\") // collapse multiple blank lines\n    .trim();\n}\nfunction ensureTempDirectory() {\n    (0,fs__WEBPACK_IMPORTED_MODULE_0__.mkdirSync)(TEMP_DIR, {\n        recursive: true\n    });\n}\nfunction extractFilesFromFormData(formData) {\n    const files = [];\n    // Single / multiple: \"file\"\n    const fileEntries = formData.getAll(\"file\");\n    for (const entry of fileEntries){\n        if (entry instanceof File) {\n            files.push(entry);\n        }\n    }\n    // Multiple: \"files\" or \"files[]\"\n    const multiples = [\n        ...formData.getAll(\"files\"),\n        ...formData.getAll(\"files[]\")\n    ];\n    for (const entry of multiples){\n        if (entry instanceof File) {\n            files.push(entry);\n        }\n    }\n    return files;\n}\nfunction summarizeFiles(files, pages) {\n    return files.map((file)=>({\n            file_id: file.fileId,\n            original_name: file.fileName,\n            page_count: pages.filter((page)=>page.fileId === file.fileId).length\n        }));\n}\nfunction createHttpError(status, message) {\n    const error = new Error(message);\n    error.status = status;\n    return error;\n}\nfunction generateFriendlyBatchId() {\n    const now = new Date();\n    const pad = (n)=>n.toString().padStart(2, \"0\");\n    const y = now.getFullYear();\n    const m = pad(now.getMonth() + 1);\n    const d = pad(now.getDate());\n    const hh = pad(now.getHours());\n    const mm = pad(now.getMinutes());\n    const ss = pad(now.getSeconds());\n    const rand = Math.random().toString(36).slice(2, 6); // 4-char slug\n    return `b_${y}${m}${d}_${hh}${mm}${ss}_${rand}`;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBRSxFQUFFZCxFQUFFLEVBQUVFLEVBQUUsRUFBRUUsRUFBRSxDQUFDLEVBQUVFLEdBQUcsRUFBRUUsR0FBRyxFQUFFRSxHQUFHLENBQUMsRUFBRUUsS0FBSyxDQUFDO0FBQ2pEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGVtZWRpY2EtY2xpbmljLW9jci8uL3NyYy9zZXJ2aWNlcy9vY3IudHM/ZDU5OCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwcm9taXNlcyBhcyBmcyB9IGZyb20gXCJmc1wiO1xyXG5pbXBvcnQgeyBta2RpclN5bmMgfSBmcm9tIFwiZnNcIjtcclxuaW1wb3J0IHsgTmV4dFJlcXVlc3QgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcclxuaW1wb3J0IHsgam9pbiB9IGZyb20gXCJwYXRoXCI7XHJcbmltcG9ydCB7IHJhbmRvbVVVSUQgfSBmcm9tIFwiY3J5cHRvXCI7XHJcbmltcG9ydCB7IGNyZWF0ZVdvcmtlciB9IGZyb20gXCJ0ZXNzZXJhY3QuanNcIjsgXHJcbmltcG9ydCBwZGZQYXJzZSBmcm9tIFwicGRmLXBhcnNlXCI7XHJcbmltcG9ydCB0eXBlIHsgT2NyUGFnZSB9IGZyb20gXCJAL2xpYi90eXBlcy9vY3JcIjtcclxuXHJcbmNvbnN0IE9DUl9ERUJVR19ESVIgPSBqb2luKHByb2Nlc3MuY3dkKCksIFwidG1wXCIsIFwib2NyLWRlYnVnXCIpO1xyXG4vLyBUb2dnbGUgd2l0aCBhbiBlbnYgdmFyIHNvIHByb2QgaXNu4oCZdCBzcGFtbWVkXHJcbmNvbnN0IE9DUl9ERUJVR19FTkFCTEVEID0gcHJvY2Vzcy5lbnYuT0NSX0RFQlVHID09PSBcIjFcIjtcclxuXHJcbmNvbnN0IFRFTVBfRElSID0gam9pbihwcm9jZXNzLmN3ZCgpLCBcInRtcFwiLCBcIm9jci11cGxvYWRzXCIpO1xyXG5jb25zdCBNQVhfRklMRV9TSVpFX0JZVEVTID1cclxuICBOdW1iZXIocHJvY2Vzcy5lbnYuT0NSX01BWF9GSUxFX01CIHx8IDI1KSAqIDEwMjQgKiAxMDI0O1xyXG5jb25zdCBBTExPV0VEX01JTUVfVFlQRVMgPSBuZXcgU2V0KFtcclxuICBcImFwcGxpY2F0aW9uL3BkZlwiLFxyXG4gIFwiaW1hZ2UvanBlZ1wiLFxyXG4gIFwiaW1hZ2UvcG5nXCIsXHJcbiAgXCJpbWFnZS9oZWljXCIsXHJcbiAgXCJpbWFnZS9oZWlmXCIsXHJcbl0pO1xyXG5cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuLy8gT0NSIGxhbmd1YWdlICsgdGltZW91dCBjb25maWdcclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuLy8gTGFuZ3VhZ2VzIGZvciBUZXNzZXJhY3QgT0NSLlxyXG4vLyBJTVBPUlRBTlQ6IE1vcmUgbGFuZ3VhZ2VzID0gaGVhdmllciArIHNsb3dlci5cclxuY29uc3QgT0NSX0xBTkdTID0gXCJlbmcrY2hpX3NpbVwiO1xyXG5cclxuLy8gTWF4IHRpbWUgKG1zKSB3ZSBhcmUgd2lsbGluZyB0byB3YWl0IGZvciBhIHNpbmdsZSBPQ1IgY2FsbC5cclxuY29uc3QgT0NSX1RJTUVPVVRfTVMgPSBOdW1iZXIocHJvY2Vzcy5lbnYuT0NSX1RJTUVPVVRfTVMgfHwgMTUwMDAwKTtcclxuXHJcbi8qKlxyXG4gKiBoYW5kbGVVcGxvYWRBbmRFeHRyYWN0T2NyXHJcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICogQWNjZXB0cyB1cGxvYWRlZCBmaWxlcyBmcm9tIGEgTmV4dFJlcXVlc3QsIHZhbGlkYXRlcyB0aGVtLCB3cml0ZXMgdGhlIGNvbnRlbnRcclxuICogdG8gYSB0ZW1wIGZvbGRlciwgcnVucyBPQ1IgcGVyIHBhZ2UsIGFuZCByZXR1cm5zIGEgbGlzdCBvZiBPY3JQYWdlIG9iamVjdHMuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlVXBsb2FkQW5kRXh0cmFjdE9jcihyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTx7XHJcbiAgYmF0Y2hJZDogc3RyaW5nO1xyXG4gIG9jclBhZ2VzOiBPY3JQYWdlW107XHJcbiAgZmlsZXNNZXRhOiB7XHJcbiAgICBmaWxlX2lkOiBzdHJpbmc7XHJcbiAgICBvcmlnaW5hbF9uYW1lOiBzdHJpbmc7XHJcbiAgICBwYWdlX2NvdW50PzogbnVtYmVyO1xyXG4gIH1bXTtcclxufT4ge1xyXG4gIGVuc3VyZVRlbXBEaXJlY3RvcnkoKTtcclxuXHJcbiAgLy8g8J+UuSBHZW5lcmF0ZSB0aGUgYmF0Y2ggSUQgT05DRSBhbmQgcmV1c2UgaXQgZXZlcnl3aGVyZVxyXG4gIGNvbnN0IGJhdGNoSWQgPSBnZW5lcmF0ZUZyaWVuZGx5QmF0Y2hJZCgpO1xyXG5cclxuICBjb25zdCBmb3JtRGF0YSA9IGF3YWl0IHJlcS5mb3JtRGF0YSgpO1xyXG4gIGNvbnN0IGluY29taW5nRmlsZXMgPSBleHRyYWN0RmlsZXNGcm9tRm9ybURhdGEoZm9ybURhdGEpO1xyXG5cclxuICBpZiAoIWluY29taW5nRmlsZXMubGVuZ3RoKSB7XHJcbiAgICB0aHJvdyBjcmVhdGVIdHRwRXJyb3IoXHJcbiAgICAgIDQwMCxcclxuICAgICAgXCJObyBmaWxlIHByb3ZpZGVkLiBQbGVhc2UgYXBwZW5kIGBmaWxlYCBvciBgZmlsZXNbXWAgdG8gRm9ybURhdGEuXCIsXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgc2F2ZWRGaWxlczogU2F2ZWRGaWxlW10gPSBbXTtcclxuXHJcbiAgZm9yIChjb25zdCBmaWxlIG9mIGluY29taW5nRmlsZXMpIHtcclxuICAgIGlmICghQUxMT1dFRF9NSU1FX1RZUEVTLmhhcyhmaWxlLnR5cGUpKSB7XHJcbiAgICAgIHRocm93IGNyZWF0ZUh0dHBFcnJvcihcclxuICAgICAgICA0MDAsXHJcbiAgICAgICAgXCJVbnN1cHBvcnRlZCBmaWxlIHR5cGUuIFBsZWFzZSB1cGxvYWQgUERGLCBKUEcsIFBORywgb3IgSEVJQy5cIixcclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIGlmIChmaWxlLnNpemUgPiBNQVhfRklMRV9TSVpFX0JZVEVTKSB7XHJcbiAgICAgIHRocm93IGNyZWF0ZUh0dHBFcnJvcihcclxuICAgICAgICA0MTMsXHJcbiAgICAgICAgYEZpbGUgZXhjZWVkcyB0aGUgbWF4aW11bSBhbGxvd2VkIHNpemUgb2YgJHtNYXRoLnJvdW5kKFxyXG4gICAgICAgICAgTUFYX0ZJTEVfU0laRV9CWVRFUyAvICgxMDI0ICogMTAyNCksXHJcbiAgICAgICAgKX0gTUIuYCxcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBmaWxlSWQgPSByYW5kb21VVUlEKCk7XHJcblxyXG4gICAgLy8g8J+UuSBVc2Ugb25seSB0aGUgbGFzdCBwYXRoIHNlZ21lbnQgKHN0cmlwIGZvbGRlciBwYXJ0cylcclxuICAgIGNvbnN0IG9yaWdpbmFsTmFtZSA9IGZpbGUubmFtZSB8fCBgdXBsb2FkLSR7ZmlsZUlkfWA7XHJcbiAgICBjb25zdCBiYXNlTmFtZSA9IG9yaWdpbmFsTmFtZS5zcGxpdCgvW1xcXFwvXS8pLnBvcCgpIHx8IG9yaWdpbmFsTmFtZTtcclxuXHJcbiAgICAvLyDwn5S5IFNhbml0aXplIGZvciBmaWxlc3lzdGVtIChubyB3ZWlyZCBjaGFycyAvIHNsYXNoZXMpXHJcbiAgICBjb25zdCBzYWZlTmFtZSA9IGJhc2VOYW1lLnJlcGxhY2UoL1teXFx3LlxcLV0rL2csIFwiX1wiKTtcclxuXHJcbiAgICBjb25zdCB0ZW1wUGF0aCA9IGpvaW4oVEVNUF9ESVIsIGAke2ZpbGVJZH0tJHtzYWZlTmFtZX1gKTtcclxuXHJcbiAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCkpO1xyXG4gICAgYXdhaXQgZnMud3JpdGVGaWxlKHRlbXBQYXRoLCBidWZmZXIpO1xyXG5cclxuICAgIHNhdmVkRmlsZXMucHVzaCh7XHJcbiAgICAgIGZpbGVJZCxcclxuICAgICAgZmlsZU5hbWU6IGJhc2VOYW1lLCAvLyBrZWVwIGEgbmljZSBkaXNwbGF5IG5hbWUgKG5vIGZvbGRlcnMpXHJcbiAgICAgIG1pbWVUeXBlOiBmaWxlLnR5cGUsXHJcbiAgICAgIHBhdGg6IHRlbXBQYXRoLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBvY3JQYWdlcyA9IGF3YWl0IHJ1bk9jck9uRmlsZXMoc2F2ZWRGaWxlcyk7XHJcbiAgY29uc3QgZmlsZXNNZXRhID0gc3VtbWFyaXplRmlsZXMoc2F2ZWRGaWxlcywgb2NyUGFnZXMpO1xyXG5cclxuICAvLyDwn5S5IE9ubHkgdmFsaWQgbm93IGJlY2F1c2UgYmF0Y2hJZCBpcyBkZWZpbmVkIGFib3ZlXHJcbiAgaWYgKE9DUl9ERUJVR19FTkFCTEVEKSB7XHJcbiAgICBhd2FpdCBzYXZlT2NyRGVidWdTbmFwc2hvdChiYXRjaElkLCBvY3JQYWdlcyk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgYmF0Y2hJZCwgLy8gcmV1c2UgdGhlIHNhbWUgYmF0Y2hJZCBoZXJlXHJcbiAgICBvY3JQYWdlcyxcclxuICAgIGZpbGVzTWV0YSxcclxuICB9O1xyXG59XHJcblxyXG50eXBlIFNhdmVkRmlsZSA9IHtcclxuICBmaWxlSWQ6IHN0cmluZztcclxuICBmaWxlTmFtZTogc3RyaW5nO1xyXG4gIG1pbWVUeXBlOiBzdHJpbmc7XHJcbiAgcGF0aDogc3RyaW5nO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIHJ1bk9jck9uRmlsZXNcclxuICogLS0tLS0tLS0tLS0tLS1cclxuICogUnVucyBPQ1Igb24gZWFjaCBwYWdlIG9mIHRoZSB1cGxvYWRlZCBmaWxlcyBhbmQgcmV0dXJuc1xyXG4gKiBPY3JQYWdlIG9iamVjdHMgdGhhdCByZXRhaW4gcGFnZSBvcmRlcmluZyBhbmQgbWV0YWRhdGEuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcnVuT2NyT25GaWxlcyhmaWxlczogU2F2ZWRGaWxlW10pOiBQcm9taXNlPE9jclBhZ2VbXT4ge1xyXG4gIGNvbnN0IHBhZ2VzOiBPY3JQYWdlW10gPSBbXTtcclxuXHJcbiAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XHJcbiAgICBpZiAoZmlsZS5taW1lVHlwZSA9PT0gXCJhcHBsaWNhdGlvbi9wZGZcIikge1xyXG4gICAgICBjb25zdCBwZGZQYWdlcyA9IGF3YWl0IHJ1bk9jck9uUGRmKGZpbGUpO1xyXG4gICAgICBwYWdlcy5wdXNoKC4uLnBkZlBhZ2VzKTtcclxuICAgICAgY29udGludWU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSW1hZ2UgZmlsZTogdXNlIFRlc3NlcmFjdCBkaXJlY3RseSB3aXRoIG11bHRpLWxhbmd1YWdlIHN1cHBvcnRcclxuICAgIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IGZzLnJlYWRGaWxlKGZpbGUucGF0aCk7XHJcbiAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcnVuVGVzc2VyYWN0KGJ1ZmZlcik7XHJcbiAgICBwYWdlcy5wdXNoKHtcclxuICAgICAgZmlsZUlkOiBmaWxlLmZpbGVJZCxcclxuICAgICAgZmlsZU5hbWU6IGZpbGUuZmlsZU5hbWUsXHJcbiAgICAgIHBhZ2VOdW1iZXI6IDEsXHJcbiAgICAgIHJhd1RleHQ6IGNsZWFuVGV4dCh0ZXh0KSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHBhZ2VzO1xyXG59XHJcblxyXG4vLyBEZWJ1Z3MgdHh0c1xyXG5hc3luYyBmdW5jdGlvbiBzYXZlT2NyRGVidWdTbmFwc2hvdChiYXRjaElkOiBzdHJpbmcsIHBhZ2VzOiBPY3JQYWdlW10pIHtcclxuICB0cnkge1xyXG4gICAgbWtkaXJTeW5jKE9DUl9ERUJVR19ESVIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xyXG5cclxuICAgIC8vIFBlci1wYWdlIGRlYnVnIGZpbGVzXHJcbiAgICBmb3IgKGNvbnN0IHBhZ2Ugb2YgcGFnZXMpIHtcclxuICAgICAgY29uc3Qgc2FmZUZpbGUgPSBwYWdlLmZpbGVOYW1lLnJlcGxhY2UoL1teXFx3Li1dKy9nLCBcIl9cIik7XHJcbiAgICAgIGNvbnN0IGRlYnVnTmFtZSA9IGAke2JhdGNoSWR9X3Ake3BhZ2UucGFnZU51bWJlcn1fJHtzYWZlRmlsZX0udHh0YDtcclxuICAgICAgY29uc3QgZGVidWdQYXRoID0gam9pbihPQ1JfREVCVUdfRElSLCBkZWJ1Z05hbWUpO1xyXG5cclxuICAgICAgY29uc3QgY29udGVudCA9XHJcbiAgICAgICAgYEJBVENIOiAke2JhdGNoSWR9XFxuYCArXHJcbiAgICAgICAgYEZJTEU6ICAke3BhZ2UuZmlsZU5hbWV9XFxuYCArXHJcbiAgICAgICAgYFBBR0U6ICAke3BhZ2UucGFnZU51bWJlcn1cXG5gICtcclxuICAgICAgICBgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxcbmAgK1xyXG4gICAgICAgIHBhZ2UucmF3VGV4dDtcclxuXHJcbiAgICAgIGF3YWl0IGZzLndyaXRlRmlsZShkZWJ1Z1BhdGgsIGNvbnRlbnQsIFwidXRmOFwiKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBZ2dyZWdhdGVkIHBlci1maWxlIGRlYnVnXHJcbiAgICBjb25zdCBwYWdlc0J5RmlsZSA9IG5ldyBNYXA8c3RyaW5nLCBPY3JQYWdlW10+KCk7XHJcbiAgICBmb3IgKGNvbnN0IHBhZ2Ugb2YgcGFnZXMpIHtcclxuICAgICAgY29uc3Qga2V5ID0gcGFnZS5maWxlTmFtZTtcclxuICAgICAgaWYgKCFwYWdlc0J5RmlsZS5oYXMoa2V5KSkgcGFnZXNCeUZpbGUuc2V0KGtleSwgW10pO1xyXG4gICAgICBwYWdlc0J5RmlsZS5nZXQoa2V5KSEucHVzaChwYWdlKTtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGNvbnN0IFtmaWxlTmFtZSwgZmlsZVBhZ2VzXSBvZiBwYWdlc0J5RmlsZS5lbnRyaWVzKCkpIHtcclxuICAgICAgY29uc3Qgc2FmZUZpbGUgPSBmaWxlTmFtZS5yZXBsYWNlKC9bXlxcdy4tXSsvZywgXCJfXCIpO1xyXG4gICAgICBjb25zdCBkZWJ1Z05hbWUgPSBgJHtiYXRjaElkfV9GSUxFXyR7c2FmZUZpbGV9LnR4dGA7XHJcbiAgICAgIGNvbnN0IGRlYnVnUGF0aCA9IGpvaW4oT0NSX0RFQlVHX0RJUiwgZGVidWdOYW1lKTtcclxuXHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPVxyXG4gICAgICAgIGBCQVRDSDogJHtiYXRjaElkfVxcbmAgK1xyXG4gICAgICAgIGBGSUxFOiAgJHtmaWxlTmFtZX1cXG5gICtcclxuICAgICAgICBgUEFHRVM6ICR7ZmlsZVBhZ2VzLmxlbmd0aH1cXG5gICtcclxuICAgICAgICBgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxcblxcbmAgK1xyXG4gICAgICAgIGZpbGVQYWdlc1xyXG4gICAgICAgICAgLnNvcnQoKGEsIGIpID0+IGEucGFnZU51bWJlciAtIGIucGFnZU51bWJlcilcclxuICAgICAgICAgIC5tYXAoKHApID0+IGAtLS0gUEFHRSAke3AucGFnZU51bWJlcn0gLS0tXFxuJHtwLnJhd1RleHR9XFxuYClcclxuICAgICAgICAgIC5qb2luKFwiXFxuXCIpO1xyXG5cclxuICAgICAgYXdhaXQgZnMud3JpdGVGaWxlKGRlYnVnUGF0aCwgY29udGVudCwgXCJ1dGY4XCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICBgW09DUiBERUJVR10gU2F2ZWQgcGFnZS1sZXZlbCArIGZpbGUtbGV2ZWwgdGV4dCBmb3IgYmF0Y2ggJHtiYXRjaElkfSB0byAke09DUl9ERUJVR19ESVJ9YCxcclxuICAgICk7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiW09DUiBERUJVR10gRmFpbGVkIHRvIHNhdmUgc25hcHNob3Q6XCIsIGVycik7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogcnVuT2NyT25QZGZcclxuICogLS0tLS0tLS0tLS1cclxuICogVXNlcyBwZGYtcGFyc2UgdG8gZXh0cmFjdCB0ZXh0IHBlciBwYWdlLlxyXG4gKiBJZiBwZGYtcGFyc2UgcmV0dXJucyBub3RoaW5nLCB3ZSBzdGlsbCBlbWl0IG9uZSBlbXB0eSBwYWdlIGVudHJ5LlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gcnVuT2NyT25QZGYoZmlsZTogU2F2ZWRGaWxlKTogUHJvbWlzZTxPY3JQYWdlW10+IHtcclxuICBjb25zdCBidWZmZXIgPSBhd2FpdCBmcy5yZWFkRmlsZShmaWxlLnBhdGgpO1xyXG4gIGNvbnN0IHBhZ2VUZXh0czogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgY29uc3Qgb3B0aW9ucyA9IHtcclxuICAgIHBhZ2VyZW5kZXI6IGFzeW5jIChwYWdlRGF0YTogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IHRleHRDb250ZW50ID0gYXdhaXQgcGFnZURhdGEuZ2V0VGV4dENvbnRlbnQoKTtcclxuICAgICAgY29uc3QgdGV4dEl0ZW1zID0gdGV4dENvbnRlbnQuaXRlbXNcclxuICAgICAgICAubWFwKChpdGVtOiB7IHN0cj86IHN0cmluZyB9KSA9PiBpdGVtPy5zdHIgPz8gXCJcIilcclxuICAgICAgICAuam9pbihcIiBcIik7XHJcbiAgICAgIGNvbnN0IGNsZWFuZWQgPSBjbGVhblRleHQodGV4dEl0ZW1zKTtcclxuICAgICAgcGFnZVRleHRzLnB1c2goY2xlYW5lZCk7XHJcbiAgICAgIHJldHVybiBjbGVhbmVkO1xyXG4gICAgfSxcclxuICB9O1xyXG5cclxuICBjb25zdCBwYXJzZWQgPSBhd2FpdCBwZGZQYXJzZShidWZmZXIsIG9wdGlvbnMgYXMgYW55KTtcclxuXHJcbiAgLy8gRmFsbGJhY2s6IGlmIHBhZ2VyZW5kZXIgZGlkbid0IHB1c2ggYW55dGhpbmcgYnV0IHBhcnNlZC50ZXh0IGV4aXN0cyxcclxuICAvLyBzcGxpdCBieSBibGFuayBsaW5lcyB0byBhcHByb3hpbWF0ZSBwYWdlcy9zZWN0aW9ucy5cclxuICBpZiAoIXBhZ2VUZXh0cy5sZW5ndGggJiYgcGFyc2VkLnRleHQpIHtcclxuICAgIHBhcnNlZC50ZXh0XHJcbiAgICAgIC5zcGxpdCgvXFxuezIsfS8pXHJcbiAgICAgIC5tYXAoKGNodW5rKSA9PiBjbGVhblRleHQoY2h1bmspKVxyXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pXHJcbiAgICAgIC5mb3JFYWNoKChjaHVuaykgPT4gcGFnZVRleHRzLnB1c2goY2h1bmspKTtcclxuICB9XHJcblxyXG4gIC8vIFN0aWxsIG5vdGhpbmc/IEVtaXQgYSBzaW5nbGUgZW1wdHkgcGFnZVxyXG4gIGlmICghcGFnZVRleHRzLmxlbmd0aCkge1xyXG4gICAgcGFnZVRleHRzLnB1c2goXCJcIik7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcGFnZVRleHRzLm1hcCgocmF3VGV4dCwgaW5kZXgpID0+ICh7XHJcbiAgICBmaWxlSWQ6IGZpbGUuZmlsZUlkLFxyXG4gICAgZmlsZU5hbWU6IGZpbGUuZmlsZU5hbWUsXHJcbiAgICBwYWdlTnVtYmVyOiBpbmRleCArIDEsXHJcbiAgICByYXdUZXh0LFxyXG4gIH0pKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIHJ1blRlc3NlcmFjdFxyXG4gKiAtLS0tLS0tLS0tLS1cclxuICogVXNlcyBhIFRlc3NlcmFjdC5qcyB3b3JrZXIgd2l0aCBhbiBleHBsaWNpdCB3b3JrZXJQYXRoIHNvIGl0XHJcbiAqIGRvZXNuJ3QgdHJ5IHRvIGxvYWQgZnJvbSBgLm5leHQvd29ya2VyLXNjcmlwdC8uLi5gLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gcnVuVGVzc2VyYWN0KGJ1ZmZlcjogQnVmZmVyKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAvLyDwn5S5IFBvaW50IGRpcmVjdGx5IGF0IHRoZSBOb2RlIHdvcmtlciBpbiBub2RlX21vZHVsZXNcclxuICBjb25zdCB3b3JrZXIgPSBhd2FpdCBjcmVhdGVXb3JrZXIoT0NSX0xBTkdTLDEse3dvcmtlclBhdGg6IFwiLi9ub2RlX21vZHVsZXMvdGVzc2VyYWN0LmpzL3NyYy93b3JrZXItc2NyaXB0L25vZGUvaW5kZXguanNcIn0pO1xyXG5cclxuXHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IHdvcmtlci5sb2FkKCk7XHJcblxyXG4gICAgY29uc3QgcmVjb2duaXplUHJvbWlzZSA9IHdvcmtlci5yZWNvZ25pemUoYnVmZmVyKTtcclxuXHJcbiAgICBjb25zdCB0aW1lb3V0UHJvbWlzZSA9IG5ldyBQcm9taXNlPG5ldmVyPigoXywgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHNldFRpbWVvdXQoXHJcbiAgICAgICAgKCkgPT5cclxuICAgICAgICAgIHJlamVjdChcclxuICAgICAgICAgICAgbmV3IEVycm9yKFxyXG4gICAgICAgICAgICAgIGBUZXNzZXJhY3QgT0NSIHRpbWVkIG91dCBhZnRlciAke09DUl9USU1FT1VUX01TfSBtcyAobGFuZ3VhZ2VzOiAke09DUl9MQU5HU30pYCxcclxuICAgICAgICAgICAgKSxcclxuICAgICAgICAgICksXHJcbiAgICAgICAgT0NSX1RJTUVPVVRfTVMsXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCByZXN1bHQ6IGFueSA9IGF3YWl0IFByb21pc2UucmFjZShbcmVjb2duaXplUHJvbWlzZSwgdGltZW91dFByb21pc2VdKTtcclxuICAgIHJldHVybiByZXN1bHQuZGF0YT8udGV4dCB8fCBcIlwiO1xyXG4gIH0gZmluYWxseSB7XHJcbiAgICAvLyBFbnN1cmUgd29ya2VyIGlzIGNsZWFuZWQgdXAgZXZlbiBvbiB0aW1lb3V0L2Vycm9yXHJcbiAgICB0cnkge1xyXG4gICAgICBhd2FpdCB3b3JrZXIudGVybWluYXRlKCk7XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgLy8gaWdub3JlXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogY2xlYW5UZXh0XHJcbiAqIC0tLS0tLS0tLVxyXG4gKiBOb3JtYWxpemVzIHdoaXRlc3BhY2UgYnV0IHByZXNlcnZlcyBsaW5lIGJyZWFrcyBzbyB0aGF0IG1lbnUgaXRlbXNcclxuICogcmVtYWluIHZpc3VhbGx5IHNlcGFyYXRlZCBmb3IgdGhlIExMTS5cclxuICovXHJcbmZ1bmN0aW9uIGNsZWFuVGV4dCh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIHJldHVybiB0ZXh0XHJcbiAgICAucmVwbGFjZSgvXFxyXFxuL2csIFwiXFxuXCIpIC8vIG5vcm1hbGlzZSBXaW5kb3dzIGxpbmUgZW5kaW5nc1xyXG4gICAgLnJlcGxhY2UoL1xcci9nLCBcIlxcblwiKVxyXG4gICAgLnJlcGxhY2UoL1sgXFx0XSsvZywgXCIgXCIpIC8vIGNvbGxhcHNlIHNwYWNlcy90YWJzXHJcbiAgICAucmVwbGFjZSgvXFxuezIsfS9nLCBcIlxcblwiKSAvLyBjb2xsYXBzZSBtdWx0aXBsZSBibGFuayBsaW5lc1xyXG4gICAgLnRyaW0oKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZW5zdXJlVGVtcERpcmVjdG9yeSgpIHtcclxuICBta2RpclN5bmMoVEVNUF9ESVIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBleHRyYWN0RmlsZXNGcm9tRm9ybURhdGEoZm9ybURhdGE6IEZvcm1EYXRhKTogRmlsZVtdIHtcclxuICBjb25zdCBmaWxlczogRmlsZVtdID0gW107XHJcblxyXG4gIC8vIFNpbmdsZSAvIG11bHRpcGxlOiBcImZpbGVcIlxyXG4gIGNvbnN0IGZpbGVFbnRyaWVzID0gZm9ybURhdGEuZ2V0QWxsKFwiZmlsZVwiKTtcclxuICBmb3IgKGNvbnN0IGVudHJ5IG9mIGZpbGVFbnRyaWVzKSB7XHJcbiAgICBpZiAoZW50cnkgaW5zdGFuY2VvZiBGaWxlKSB7XHJcbiAgICAgIGZpbGVzLnB1c2goZW50cnkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gTXVsdGlwbGU6IFwiZmlsZXNcIiBvciBcImZpbGVzW11cIlxyXG4gIGNvbnN0IG11bHRpcGxlcyA9IFsuLi5mb3JtRGF0YS5nZXRBbGwoXCJmaWxlc1wiKSwgLi4uZm9ybURhdGEuZ2V0QWxsKFwiZmlsZXNbXVwiKV07XHJcbiAgZm9yIChjb25zdCBlbnRyeSBvZiBtdWx0aXBsZXMpIHtcclxuICAgIGlmIChlbnRyeSBpbnN0YW5jZW9mIEZpbGUpIHtcclxuICAgICAgZmlsZXMucHVzaChlbnRyeSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gZmlsZXM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHN1bW1hcml6ZUZpbGVzKGZpbGVzOiBTYXZlZEZpbGVbXSwgcGFnZXM6IE9jclBhZ2VbXSkge1xyXG4gIHJldHVybiBmaWxlcy5tYXAoKGZpbGUpID0+ICh7XHJcbiAgICBmaWxlX2lkOiBmaWxlLmZpbGVJZCxcclxuICAgIG9yaWdpbmFsX25hbWU6IGZpbGUuZmlsZU5hbWUsXHJcbiAgICBwYWdlX2NvdW50OiBwYWdlcy5maWx0ZXIoKHBhZ2UpID0+IHBhZ2UuZmlsZUlkID09PSBmaWxlLmZpbGVJZCkubGVuZ3RoLFxyXG4gIH0pKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlSHR0cEVycm9yKHN0YXR1czogbnVtYmVyLCBtZXNzYWdlOiBzdHJpbmcpIHtcclxuICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihtZXNzYWdlKSBhcyBFcnJvciAmIHsgc3RhdHVzPzogbnVtYmVyIH07XHJcbiAgZXJyb3Iuc3RhdHVzID0gc3RhdHVzO1xyXG4gIHJldHVybiBlcnJvcjtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2VuZXJhdGVGcmllbmRseUJhdGNoSWQoKTogc3RyaW5nIHtcclxuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gIGNvbnN0IHBhZCA9IChuOiBudW1iZXIpID0+IG4udG9TdHJpbmcoKS5wYWRTdGFydCgyLCBcIjBcIik7XHJcblxyXG4gIGNvbnN0IHkgPSBub3cuZ2V0RnVsbFllYXIoKTtcclxuICBjb25zdCBtID0gcGFkKG5vdy5nZXRNb250aCgpICsgMSk7XHJcbiAgY29uc3QgZCA9IHBhZChub3cuZ2V0RGF0ZSgpKTtcclxuICBjb25zdCBoaCA9IHBhZChub3cuZ2V0SG91cnMoKSk7XHJcbiAgY29uc3QgbW0gPSBwYWQobm93LmdldE1pbnV0ZXMoKSk7XHJcbiAgY29uc3Qgc3MgPSBwYWQobm93LmdldFNlY29uZHMoKSk7XHJcblxyXG4gIGNvbnN0IHJhbmQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyLCA2KTsgLy8gNC1jaGFyIHNsdWdcclxuXHJcbiAgcmV0dXJuIGBiXyR7eX0ke219JHtkfV8ke2hofSR7bW19JHtzc31fJHtyYW5kfWA7XHJcbn1cclxuIl0sIm5hbWVzIjpbInByb21pc2VzIiwiZnMiLCJta2RpclN5bmMiLCJqb2luIiwicmFuZG9tVVVJRCIsImNyZWF0ZVdvcmtlciIsInBkZlBhcnNlIiwiT0NSX0RFQlVHX0RJUiIsInByb2Nlc3MiLCJjd2QiLCJPQ1JfREVCVUdfRU5BQkxFRCIsImVudiIsIk9DUl9ERUJVRyIsIlRFTVBfRElSIiwiTUFYX0ZJTEVfU0laRV9CWVRFUyIsIk51bWJlciIsIk9DUl9NQVhfRklMRV9NQiIsIkFMTE9XRURfTUlNRV9UWVBFUyIsIlNldCIsIk9DUl9MQU5HUyIsIk9DUl9USU1FT1VUX01TIiwiaGFuZGxlVXBsb2FkQW5kRXh0cmFjdE9jciIsInJlcSIsImVuc3VyZVRlbXBEaXJlY3RvcnkiLCJiYXRjaElkIiwiZ2VuZXJhdGVGcmllbmRseUJhdGNoSWQiLCJmb3JtRGF0YSIsImluY29taW5nRmlsZXMiLCJleHRyYWN0RmlsZXNGcm9tRm9ybURhdGEiLCJsZW5ndGgiLCJjcmVhdGVIdHRwRXJyb3IiLCJzYXZlZEZpbGVzIiwiZmlsZSIsImhhcyIsInR5cGUiLCJzaXplIiwiTWF0aCIsInJvdW5kIiwiZmlsZUlkIiwib3JpZ2luYWxOYW1lIiwibmFtZSIsImJhc2VOYW1lIiwic3BsaXQiLCJwb3AiLCJzYWZlTmFtZSIsInJlcGxhY2UiLCJ0ZW1wUGF0aCIsImJ1ZmZlciIsIkJ1ZmZlciIsImZyb20iLCJhcnJheUJ1ZmZlciIsIndyaXRlRmlsZSIsInB1c2giLCJmaWxlTmFtZSIsIm1pbWVUeXBlIiwicGF0aCIsIm9jclBhZ2VzIiwicnVuT2NyT25GaWxlcyIsImZpbGVzTWV0YSIsInN1bW1hcml6ZUZpbGVzIiwic2F2ZU9jckRlYnVnU25hcHNob3QiLCJmaWxlcyIsInBhZ2VzIiwicGRmUGFnZXMiLCJydW5PY3JPblBkZiIsInJlYWRGaWxlIiwidGV4dCIsInJ1blRlc3NlcmFjdCIsInBhZ2VOdW1iZXIiLCJyYXdUZXh0IiwiY2xlYW5UZXh0IiwicmVjdXJzaXZlIiwicGFnZSIsInNhZmVGaWxlIiwiZGVidWdOYW1lIiwiZGVidWdQYXRoIiwiY29udGVudCIsInBhZ2VzQnlGaWxlIiwiTWFwIiwia2V5Iiwic2V0IiwiZ2V0IiwiZmlsZVBhZ2VzIiwiZW50cmllcyIsInNvcnQiLCJhIiwiYiIsIm1hcCIsInAiLCJjb25zb2xlIiwibG9nIiwiZXJyIiwiZXJyb3IiLCJwYWdlVGV4dHMiLCJvcHRpb25zIiwicGFnZXJlbmRlciIsInBhZ2VEYXRhIiwidGV4dENvbnRlbnQiLCJnZXRUZXh0Q29udGVudCIsInRleHRJdGVtcyIsIml0ZW1zIiwiaXRlbSIsInN0ciIsImNsZWFuZWQiLCJwYXJzZWQiLCJjaHVuayIsImZpbHRlciIsIkJvb2xlYW4iLCJmb3JFYWNoIiwiaW5kZXgiLCJ3b3JrZXIiLCJ3b3JrZXJQYXRoIiwibG9hZCIsInJlY29nbml6ZVByb21pc2UiLCJyZWNvZ25pemUiLCJ0aW1lb3V0UHJvbWlzZSIsIlByb21pc2UiLCJfIiwicmVqZWN0Iiwic2V0VGltZW91dCIsIkVycm9yIiwicmVzdWx0IiwicmFjZSIsImRhdGEiLCJ0ZXJtaW5hdGUiLCJ0cmltIiwiZmlsZUVudHJpZXMiLCJnZXRBbGwiLCJlbnRyeSIsIkZpbGUiLCJtdWx0aXBsZXMiLCJmaWxlX2lkIiwib3JpZ2luYWxfbmFtZSIsInBhZ2VfY291bnQiLCJzdGF0dXMiLCJtZXNzYWdlIiwibm93IiwiRGF0ZSIsInBhZCIsIm4iLCJ0b1N0cmluZyIsInBhZFN0YXJ0IiwieSIsImdldEZ1bGxZZWFyIiwibSIsImdldE1vbnRoIiwiZCIsImdldERhdGUiLCJoaCIsImdldEhvdXJzIiwibW0iLCJnZXRNaW51dGVzIiwic3MiLCJnZXRTZWNvbmRzIiwicmFuZCIsInJhbmRvbSIsInNsaWNlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/services/ocr.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@aws-sdk","vendor-chunks/@smithy","vendor-chunks/pdf-parse","vendor-chunks/next","vendor-chunks/@aws-crypto","vendor-chunks/tslib","vendor-chunks/@aws"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Focr-menus%2Froute&page=%2Fapi%2Focr-menus%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Focr-menus%2Froute.ts&appDir=C%3A%5CUsers%5CUser%5CDocuments%5Cside_quest%5CLeMedica%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CUser%5CDocuments%5Cside_quest%5CLeMedica&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();